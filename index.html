<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="均一 x Hour of AI - 均一平台教育基金會邀請您一起推動 AI 素養教育，讓學習力再進化">
    <meta name="keywords" content="均一, Hour of AI, AI素養, 均一教育平台, AI教育, 程式教育">
    <title>均一 x Hour of AI | 均一平台教育基金會</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">

    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- Leaflet CSS for Interactive Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>

    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Q3BND056JE"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-Q3BND056JE');
    </script>

    <style>
        /* ===== CSS Custom Properties (Design Tokens) ===== */
        :root {
            /* Colors from Halo Theme */
            --color-primary-orange: #FF9F4D;
            --color-primary-blue: #3B7DD6;
            --color-primary-teal: #4DBFA3;
            --color-navy: #003D82;
            --color-yellow: #FFD166;
            --color-coral: #FF6B6B;

            /* Neutral Colors */
            --color-white: #FFFFFF;
            --color-bg-light: #F5F5F5;
            --color-bg-lighter: #FAFAFA;
            --color-text-primary: #1A1A1A;
            --color-text-secondary: #666666;
            --color-border: #E0E0E0;

            /* Spacing */
            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;
            --spacing-2xl: 4rem;
            --spacing-3xl: 6rem;

            /* Typography */
            --font-family: 'Noto Sans TC', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --font-size-xs: 0.875rem;      /* 14px - captions, hints, small UI */
            --font-size-sm: 1rem;          /* 16px - body text, buttons, labels */
            --font-size-base: 1.125rem;    /* 18px - primary body text */
            --font-size-xl: 1.5rem;        /* 24px - h4, h5, component titles */
            --font-size-2xl: 2rem;         /* 32px - h3, section subtitles */
            --font-size-3xl: 2.5rem;       /* 40px - h1, h2, section titles */

            /* Font Weight Scale */
            --font-weight-normal: 400;
            --font-weight-semibold: 600;
            --font-weight-bold: 700;

            /* Line Heights */
            --line-height-tight: 1.2;
            --line-height-normal: 1.5;
            --line-height-relaxed: 1.8;

            /* Layout */
            --container-max-width: 1200px;
            --border-radius-sm: 8px;
            --border-radius-md: 12px;
            --border-radius-lg: 20px;
            --border-radius-full: 9999px;

            /* Shadows */
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
            --shadow-xl: 0 12px 40px rgba(0, 0, 0, 0.15);

            /* Transitions */
            --transition-fast: 150ms ease;
            --transition-base: 300ms ease;
            --transition-slow: 500ms ease;
        }

        /* ===== Reset & Base Styles ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Material Icons Styling */
        .material-icons {
            font-family: 'Material Icons';
            font-weight: normal;
            font-style: normal;
            font-size: 24px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            vertical-align: middle;
            -webkit-font-smoothing: antialiased;
            text-rendering: optimizeLegibility;
        }

        .material-icons.small { font-size: var(--font-size-sm); }
        .material-icons.medium { font-size: var(--font-size-xl); }
        .material-icons.large { font-size: calc(var(--font-size-xl) * 1.5); }

        /* Typography Utility Classes */
        .text-xs { font-size: var(--font-size-xs); }
        .text-sm { font-size: var(--font-size-sm); }
        .text-base { font-size: var(--font-size-base); }
        .text-lg { font-size: var(--font-size-xl); }
        .text-xl { font-size: var(--font-size-xl); }
        .text-2xl { font-size: var(--font-size-2xl); }
        .text-3xl { font-size: var(--font-size-3xl); }

        .font-normal { font-weight: var(--font-weight-normal); }
        .font-semibold { font-weight: var(--font-weight-semibold); }
        .font-bold { font-weight: var(--font-weight-bold); }

        .leading-tight { line-height: var(--line-height-tight); }
        .leading-normal { line-height: var(--line-height-normal); }
        .leading-relaxed { line-height: var(--line-height-relaxed); }

        /* Semantic Heading Hierarchy */
        h1 {
            font-size: var(--font-size-3xl);
            font-weight: var(--font-weight-bold);
            line-height: var(--line-height-tight);
        }
        h2 {
            font-size: var(--font-size-3xl);
            font-weight: var(--font-weight-bold);
            line-height: var(--line-height-tight);
        }
        h3 {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            line-height: var(--line-height-tight);
        }
        h4 {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            line-height: var(--line-height-normal);
        }
        h5 {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-semibold);
            line-height: var(--line-height-normal);
        }
        h6 {
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-semibold);
            line-height: var(--line-height-normal);
        }
        p {
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-normal);
            line-height: var(--line-height-relaxed);
        }

        html {
            scroll-behavior: smooth;
            font-size: var(--font-size-sm);
        }

        body {
            font-family: var(--font-family);
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-normal);
            line-height: var(--line-height-relaxed);
            color: var(--color-text-primary);
            background-color: var(--color-white);
            overflow-x: hidden;
        }

        img {
            max-width: 100%;
            height: auto;
            display: block;
        }

        a {
            text-decoration: none;
            color: inherit;
            transition: all var(--transition-base);
        }

        button {
            font-family: inherit;
            font-size: inherit;
            font-weight: inherit;
            line-height: inherit;
            border: none;
            cursor: pointer;
            transition: all var(--transition-base);
        }

        input, select, textarea {
            font-family: inherit;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-normal);
            line-height: var(--line-height-normal);
            border: 2px solid var(--color-border);
            border-radius: var(--border-radius-sm);
            padding: var(--spacing-sm) var(--spacing-md);
            transition: all var(--transition-base);
            width: 100%;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--color-primary-blue);
            box-shadow: 0 0 0 3px rgba(59, 125, 214, 0.1);
        }

        /* ===== Utility Classes ===== */
        .container {
            max-width: var(--container-max-width);
            margin: 0 auto;
            padding: 0 var(--spacing-md);
        }

        .section {
            padding: var(--spacing-3xl) 0;
        }

        .section-sm {
            padding: var(--spacing-2xl) 0;
        }

        .text-center {
            text-align: center;
        }

        .hidden {
            display: none !important;
        }

        /* Fade-in Animation */
        .fade-in {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity var(--transition-slow), transform var(--transition-slow);
        }

        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* ===== Navigation ===== */
        .nav {
            position: sticky;
            top: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-sm);
            z-index: 1000;
            transition: all var(--transition-base);
        }

        .nav.scrolled {
            box-shadow: var(--shadow-md);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-sm) var(--spacing-md);
        }

        .nav-logo {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-navy);
        }

        .nav-logo span {
            color: var(--color-primary-orange);
        }

        .nav-links {
            display: flex;
            gap: var(--spacing-lg);
            list-style: none;
        }

        .nav-links a {
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-secondary);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius-sm);
        }

        .nav-links a:hover {
            color: var(--color-primary-blue);
            background: rgba(59, 125, 214, 0.05);
        }

        .nav-cta {
            background: linear-gradient(135deg, var(--color-yellow), var(--color-primary-orange));
            color: var(--color-navy);
            font-weight: var(--font-weight-bold);
            padding: var(--spacing-sm) var(--spacing-lg);
            border-radius: var(--border-radius-full);
            box-shadow: var(--shadow-md);
        }

        .nav-cta:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Mobile Menu */
        .mobile-menu-toggle {
            display: none;
            background: transparent;
            border: none;
            padding: var(--spacing-md);
            cursor: pointer;
            border-radius: var(--border-radius-sm);
            transition: background-color var(--transition-base);
            min-width: 44px;
            min-height: 44px;
            align-items: center;
            justify-content: center;
        }

        .mobile-menu-toggle:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .mobile-menu-toggle:focus {
            outline: 2px solid var(--color-primary-blue);
            outline-offset: 2px;
        }

        .hamburger {
            width: 28px;
            height: 2px;
            background: var(--color-navy);
            position: relative;
            transition: all var(--transition-base);
        }

        .hamburger::before,
        .hamburger::after {
            content: '';
            position: absolute;
            width: 28px;
            height: 2px;
            background: var(--color-navy);
            transition: all var(--transition-base);
        }

        .hamburger::before {
            top: -8px;
        }

        .hamburger::after {
            bottom: -8px;
        }

        .mobile-menu-toggle.active .hamburger {
            background: transparent;
        }

        .mobile-menu-toggle.active .hamburger::before {
            top: 0;
            transform: rotate(45deg);
        }

        .mobile-menu-toggle.active .hamburger::after {
            bottom: 0;
            transform: rotate(-45deg);
        }

        /* ===== Hero Section ===== */
        .hero {
            position: relative;
            background: linear-gradient(135deg, var(--color-bg-light) 0%, var(--color-white) 100%);
            padding: var(--spacing-3xl) 0;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 800px;
            height: 800px;
            background: radial-gradient(circle, rgba(255, 159, 77, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
        }

        .hero-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-2xl);
            align-items: center;
            position: relative;
            z-index: 1;
        }

        .hero-text h1 {
            font-size: var(--font-size-3xl);
            font-weight: var(--font-weight-bold);
            line-height: var(--line-height-tight);
            color: var(--color-navy);
            margin-bottom: var(--spacing-md);
            line-height: 1.2;
        }

        .hero-text .highlight {
            background: linear-gradient(135deg, var(--color-primary-orange), var(--color-yellow));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero-text p {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-normal);
            line-height: var(--line-height-relaxed);
            color: var(--color-text-secondary);
            margin-bottom: var(--spacing-xl);
            line-height: 1.8;
        }

        .hero-ctas {
            display: flex;
            gap: var(--spacing-md);
            flex-wrap: wrap;
        }

        .btn {
            padding: var(--spacing-md) var(--spacing-xl);
            border-radius: var(--border-radius-full);
            font-weight: var(--font-weight-bold);
            font-size: var(--font-size-sm);
            line-height: var(--line-height-normal);
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
            transition: all var(--transition-base);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--color-yellow), var(--color-primary-orange));
            color: var(--color-navy);
            box-shadow: var(--shadow-lg);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-xl);
        }

        .btn-secondary {
            background: var(--color-white);
            color: var(--color-primary-blue);
            border: 2px solid var(--color-primary-blue);
        }

        .btn-secondary:hover {
            background: var(--color-primary-blue);
            color: var(--color-white);
        }

        .hero-image {
            position: relative;
        }

        .hero-image img {
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-xl);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-20px);
            }
        }

        /* ===== Upcoming Events Carousel ===== */
        .upcoming-events-section {
            padding-bottom: var(--spacing-2xl);
            margin-bottom: var(--spacing-xl);
        }

        .upcoming-events-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
        }

        .upcoming-events-header .section-title {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            font-size: var(--font-size-2xl);
            color: var(--color-navy);
            margin-bottom: var(--spacing-sm);
        }

        .upcoming-events-header .section-subtitle {
            color: var(--color-text-secondary);
            font-size: var(--font-size-base);
        }

        /* Carousel Container */
        .events-carousel-wrapper {
            position: relative;
            max-width: 100%;
            overflow: hidden;
        }
        
        /* 在較大螢幕上，嚴格限制容器寬度，只顯示一張卡片 */
        @media (min-width: 641px) {
            .events-carousel-wrapper {
                max-width: 600px;
                margin: 0 auto;
            }
        }

        .events-carousel {
            display: flex;
            gap: var(--spacing-lg);
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
            padding: var(--spacing-sm) 0;
        }

        .events-carousel::-webkit-scrollbar {
            display: none;
        }

        /* Event Card - 16:9 ratio */
        /* 使用 max-width 限制最大寬度：手機端 100%，桌面/平板限制最大 600px */
        .event-card {
            flex: 0 0 100%;
            min-width: 0; /* 允許 flex item 縮小 */
            width: 100%;
            max-width: 600px;
            scroll-snap-align: start;
            aspect-ratio: 16 / 9;
            background: linear-gradient(135deg, var(--color-primary-blue), var(--color-primary-teal));
            border-radius: var(--border-radius-lg);
            box-shadow: none;
            overflow: hidden;
            cursor: pointer;
            transition: all var(--transition-base);
            text-decoration: none;
            color: var(--color-white);
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: var(--spacing-2xl) var(--spacing-3xl);
            position: relative;
        }
        
        /* 在較大螢幕上，調整 flex-basis 確保只顯示單一卡片 */
        @media (min-width: 641px) {
            .event-card {
                flex: 0 0 600px; /* 固定寬度，確保只顯示一張 */
            }
        }

        .event-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg, transparent 30%, rgba(0, 0, 0, 0.4) 100%);
            pointer-events: none;
        }

        .event-card:hover {
            transform: translateY(-4px);
            box-shadow: none;
            color: var(--color-white); /* 永遠維持白色 */
        }

        /* Hover 時稍微放大文字，但不改變顏色 */
        .event-card:hover .event-card-title {
            font-size: calc(var(--font-size-xl) * 1.04);
        }

        .event-card:hover .event-card-description {
            font-size: calc(var(--font-size-sm) * 1.03);
        }

        .event-card-content {
            position: relative;
            z-index: 1;
            text-align: left;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: var(--spacing-xs);
        }

        .event-card-title {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            line-height: var(--line-height-tight);
            transition: font-size var(--transition-base);
        }

        .event-card-description {
            font-size: var(--font-size-sm);
            opacity: 0.9;
            line-height: var(--line-height-normal);
            display: -webkit-box;
            line-clamp: 2;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            transition: font-size var(--transition-base);
        }

        .event-card-btn {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
            margin-top: var(--spacing-sm);
            padding: var(--spacing-xs) var(--spacing-md);
            background: rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius-full);
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-semibold);
            transition: all var(--transition-base);
        }

        .event-card:hover .event-card-btn {
            background: rgba(255, 255, 255, 0.3);
        }

        .event-card-arrow {
            display: none;
        }

        /* Carousel Navigation */
        /* 統一使用手機端樣式：所有裝置都使用較小的按鈕 */
        .carousel-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: var(--color-white);
            border: none;
            border-radius: var(--border-radius-full);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            z-index: 10;
            transition: all var(--transition-base);
            color: var(--color-navy);
        }

        .carousel-nav:hover {
            background: var(--color-navy);
            color: var(--color-white);
        }

        .carousel-nav:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* 統一使用手機端樣式：所有裝置都使用較小的間距 */
        .carousel-nav.prev {
            left: var(--spacing-xs);
        }

        .carousel-nav.next {
            right: var(--spacing-xs);
        }

        /* Carousel Dots */
        .carousel-dots {
            display: flex;
            justify-content: center;
            gap: var(--spacing-xs);
            margin-top: var(--spacing-lg);
        }

        .carousel-dot {
            width: 10px;
            height: 10px;
            border-radius: var(--border-radius-full);
            background: var(--color-border);
            border: none;
            cursor: pointer;
            transition: all var(--transition-base);
            padding: 0;
        }

        .carousel-dot.active {
            background: var(--color-primary-blue);
            width: 24px;
        }

        .carousel-dot:hover {
            background: var(--color-primary-teal);
        }

        /* 已統一使用手機端樣式，移除響應式媒體查詢 */
        /* 所有裝置都顯示單一卡片，確保標題列在所有裝置上都可見 */

        /* ===== Stats Bar ===== */
        .stats-bar {
            background: linear-gradient(135deg, var(--color-navy), var(--color-primary-blue));
            color: var(--color-white);
            padding: var(--spacing-xl) 0;
            position: relative;
        }

        .stats-bar::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--color-primary-orange), var(--color-yellow), var(--color-primary-teal), var(--color-primary-blue));
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-lg);
            text-align: center;
        }

        .stat-item h2 {
            font-size: var(--font-size-3xl);
            font-weight: var(--font-weight-bold);
            line-height: var(--line-height-tight);
            margin-bottom: var(--spacing-xs);
        }

        .stat-item p {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-normal);
            line-height: var(--line-height-normal);
            opacity: 0.9;
        }

        /* ===== Live Statistics Dashboard ===== */
        .live-stats-section {
            background: var(--color-white);
            padding: var(--spacing-3xl) 0;
            position: relative;
            overflow: hidden;
        }

        /* Stats Header with Refresh Button */
        .stats-header-wrapper {
            position: relative;
        }

        .stats-header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-md);
            flex-wrap: wrap;
        }

        .stats-meta {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin-top: 4px;
        }

        .stats-update-time {
            font-size: 0.875rem;
            color: rgba(0, 0, 0, 0.5);
            font-weight: 400;
            white-space: nowrap;
        }

        .stats-refresh-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border: none;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 0;
        }

        .stats-refresh-btn:hover {
            background: rgba(0, 0, 0, 0.1);
            transform: scale(1.05);
        }

        .stats-refresh-btn:active {
            transform: scale(0.95);
        }

        .stats-refresh-btn .material-icons {
            font-size: 18px;
            color: rgba(0, 0, 0, 0.6);
            transition: all 0.3s ease;
        }

        .stats-refresh-btn:hover .material-icons {
            color: rgba(0, 0, 0, 0.8);
        }

        /* Loading animation for refresh button */
        .stats-refresh-btn.loading .material-icons {
            animation: rotate 1s linear infinite;
        }

        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        .stats-refresh-btn:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        /* ===== Stats Controls Wrapper (at bottom of stats section) ===== */
        .stats-controls-wrapper {
            margin-top: var(--spacing-lg);
        }

        .stats-controls {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .stats-controls .stats-meta {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            opacity: 0.6;
        }

        .stats-controls .stats-refresh-btn {
            width: 28px;
            height: 28px;
            padding: 0;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .stats-controls .stats-refresh-btn:hover {
            background: rgba(0, 0, 0, 0.08);
            border-color: rgba(0, 0, 0, 0.15);
            opacity: 1;
        }

        .stats-controls .stats-refresh-btn .material-icons {
            font-size: 16px;
            color: rgba(0, 0, 0, 0.5);
        }

        @media (max-width: 768px) {
            .stats-controls .stats-refresh-btn {
                width: 24px;
                height: 24px;
            }

            .stats-controls .stats-refresh-btn .material-icons {
                font-size: 14px;
            }
        }

        /* ===== Demo Mode Indicators ===== */
        .demo-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-left: var(--spacing-sm);
            padding: 4px 8px;
            background: rgba(255, 193, 7, 0.15);
            color: #e65100;
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 12px;
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-semibold);
            line-height: 1;
        }

        .demo-badge .material-icons {
            font-size: 14px !important;
        }

        .demo-notice {
            margin: var(--spacing-md) 0;
            text-align: center;
        }

        .demo-notice-content {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-xs) var(--spacing-sm);
            background: rgba(33, 150, 243, 0.1);
            color: #1976d2;
            border: 1px solid rgba(33, 150, 243, 0.2);
            border-radius: var(--border-radius);
            font-size: var(--font-size-xs);
            opacity: 0.8;
        }

        .demo-notice-content .material-icons {
            font-size: 16px !important;
        }

        /* Demo mode visual overlay */
        .stats-dashboard.demo-mode {
            position: relative;
            opacity: 0.92;
        }

        .stats-dashboard.demo-mode::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 20px,
                rgba(255, 193, 7, 0.02) 20px,
                rgba(255, 193, 7, 0.02) 40px
            );
            pointer-events: none;
            z-index: 1;
        }

        @media (max-width: 768px) {
            .demo-badge {
                margin-left: 0;
                margin-top: var(--spacing-xs);
                font-size: 11px;
            }

            .demo-badge .material-icons {
                font-size: 12px !important;
            }
        }

        /* ===== Taiwan Global Rank Section - Redesigned ===== */
        .taiwan-global-rank-section {
            margin: var(--spacing-lg) 0 var(--spacing-xl) 0;
        }

        .taiwan-global-rank-section .stats-header-wrapper {
            margin-bottom: var(--spacing-lg);
        }

        /* Main 2-column layout */
        .global-rank-main {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
        }

        /* Left: Global Rank Highlight */
        .global-rank-highlight {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border: 2px solid var(--color-border);
            border-radius: var(--border-radius-md);
            padding: var(--spacing-lg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            transition: all var(--transition-base);
            position: relative;
            overflow: hidden;
        }

        .global-rank-highlight::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--color-primary-blue);
            transform: scaleX(0);
            transition: transform var(--transition-base);
        }

        .global-rank-highlight:hover::before {
            transform: scaleX(1);
        }

        .global-rank-highlight:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--color-primary-blue);
        }

        .rank-badge {
            margin-bottom: var(--spacing-xs);
        }

        .rank-badge .material-icons {
            font-size: 2rem;
        }

        .rank-number-large {
            font-size: 4rem;
            font-weight: var(--font-weight-bold);
            color: var(--color-navy);
            line-height: 1;
            margin: var(--spacing-xs) 0;
        }

        .rank-context {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-bottom: var(--spacing-sm);
        }

        .rank-context .material-icons {
            font-size: 16px;
        }

        .rank-percentile-large {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-semibold);
            color: var(--color-primary-teal);
            background: rgba(77, 191, 163, 0.1);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius-full);
        }

        .rank-percentile-large .material-icons {
            font-size: 20px;
        }

        /* Right: Nearby Rank Panel */
        .nearby-rank-panel {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border: 2px solid var(--color-border);
            border-radius: var(--border-radius-md);
            padding: var(--spacing-md);
            transition: all var(--transition-base);
            position: relative;
            overflow: hidden;
        }

        .nearby-rank-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--color-primary-blue);
            transform: scaleX(0);
            transition: transform var(--transition-base);
        }

        .nearby-rank-panel:hover::before {
            transform: scaleX(1);
        }

        .nearby-rank-panel:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--color-primary-blue);
        }

        .nearby-rank-title {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-semibold);
            color: var(--color-navy);
            margin: 0 0 var(--spacing-sm) 0;
            padding-bottom: var(--spacing-xs);
            border-bottom: 1px solid var(--color-border);
        }

        .nearby-rank-title .material-icons {
            font-size: 20px;
        }

        .nearby-countries-list {
            display: grid;
            gap: var(--spacing-xs);
        }

        .country-rank-item {
            display: grid;
            grid-template-columns: 45px 1fr 90px;
            align-items: center;
            padding: var(--spacing-xs) var(--spacing-sm);
            background: white;
            border-radius: var(--border-radius-sm);
            transition: background 0.2s;
            font-size: var(--font-size-sm);
        }

        .country-rank-item:hover {
            background: var(--color-bg-light);
        }

        .country-rank-item.current-country {
            background: linear-gradient(90deg, rgba(255, 159, 77, 0.15) 0%, rgba(255, 159, 77, 0.05) 100%);
            border-left: 3px solid var(--color-primary-orange);
            font-weight: var(--font-weight-semibold);
            padding-left: calc(var(--spacing-sm) - 3px);
        }

        .rank-col {
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-secondary);
        }

        .country-col {
            color: var(--color-navy);
        }

        .count-col {
            text-align: right;
            color: var(--color-text-secondary);
            font-size: var(--font-size-xs);
        }

        /* Auxiliary Info (降級視覺層次) */
        .rank-auxiliary-info {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-xs);
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--color-bg-lighter);
            border-radius: var(--border-radius-sm);
            border-left: 3px solid var(--color-border);
        }

        .rank-auxiliary-info > .material-icons {
            color: var(--color-text-secondary);
            font-size: 16px;
            margin-top: 2px;
            flex-shrink: 0;
        }

        .auxiliary-content {
            flex: 1;
        }

        .auxiliary-stats {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-xs);
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
            margin-bottom: 4px;
        }

        .auxiliary-stats strong {
            color: var(--color-text-primary);
            font-weight: var(--font-weight-semibold);
        }

        .auxiliary-stats .separator {
            color: var(--color-border);
        }

        .auxiliary-note {
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
            line-height: var(--line-height-normal);
            margin: 0;
            opacity: 0.8;
        }

        .auxiliary-link {
            color: var(--color-primary-blue);
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: all var(--transition-base);
        }

        .auxiliary-link:hover {
            color: var(--color-primary-teal);
            border-bottom-color: var(--color-primary-teal);
        }

        /* ===== Global Rank Responsive Design ===== */
        @media (max-width: 768px) {
            .global-rank-main {
                grid-template-columns: 1fr;
                gap: var(--spacing-md);
            }

            .global-rank-highlight {
                padding: var(--spacing-md);
            }

            .rank-number-large {
                font-size: 3rem;
            }

            .rank-percentile-large {
                font-size: var(--font-size-base);
            }

            .country-rank-item {
                grid-template-columns: 40px 1fr 80px;
                font-size: var(--font-size-xs);
            }

            .auxiliary-stats {
                flex-direction: column;
                gap: 4px;
            }

            .auxiliary-stats .separator {
                display: none;
            }
        }

        @media (max-width: 480px) {
            .rank-number-large {
                font-size: 2.5rem;
            }

            .rank-percentile-large {
                font-size: var(--font-size-sm);
                padding: 6px 12px;
            }
        }

        .stats-dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-xl);
            margin-top: var(--spacing-2xl);
            transition: opacity 0.3s ease;
        }

        .stats-left {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xl);
        }

        .stats-counters {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-md);
        }

        .counter-card {
            background: linear-gradient(135deg, var(--color-bg-lighter), var(--color-white));
            border: 2px solid var(--color-border);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-lg);
            text-align: center;
            transition: all var(--transition-base);
            position: relative;
            overflow: hidden;
        }

        .counter-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--color-primary-blue);
            transform: scaleX(0);
            transition: transform var(--transition-base);
        }

        .counter-card:hover::before {
            transform: scaleX(1);
        }

        .counter-card:hover {
            transform: translateY(-4px);
            border-color: var(--color-primary-blue);
            box-shadow: var(--shadow-lg);
        }

        .counter-icon {
            font-size: var(--font-size-2xl);
            margin-bottom: var(--spacing-sm);
        }

        .counter-number {
            font-size: var(--font-size-3xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-navy);
            margin-bottom: var(--spacing-xs);
            font-variant-numeric: tabular-nums;
            min-height: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: font-size var(--transition-base);
        }

        /* Responsive font sizing for very large numbers */
        @media (max-width: 1024px) and (min-width: 769px) {
            .counter-number {
                font-size: var(--font-size-2xl);
            }
        }

        @media (min-width: 1025px) {
            .counter-number {
                font-size: var(--font-size-3xl);
            }
        }

        .counter-label {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            line-height: var(--line-height-normal);
            color: var(--color-text-secondary);
        }

        .taiwan-map-container {
            background: linear-gradient(135deg, var(--color-bg-lighter), var(--color-white));
            border: 2px solid var(--color-border);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-xl);
            text-align: center;
        }

        .taiwan-map-container h3 {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            line-height: var(--line-height-tight);
            color: var(--color-navy);
            margin-bottom: var(--spacing-md);
        }

        .taiwan-map {
            width: 100%;
            height: 450px;
            margin: 0 auto;
            border-radius: var(--border-radius-md);
            overflow: hidden;
        }

        /* Leaflet popup styling */
        .leaflet-popup-content-wrapper {
            border-radius: var(--border-radius-sm);
            font-family: 'Noto Sans TC', sans-serif;
        }

        .leaflet-popup-content {
            margin: var(--spacing-sm);
            font-size: var(--font-size-sm);
        }

        .county-popup {
            text-align: center;
        }

        .county-popup-name {
            font-size: var(--font-size-md);
            font-weight: var(--font-weight-bold);
            color: var(--color-navy);
            margin-bottom: var(--spacing-xs);
        }

        .county-popup-count {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-primary-blue);
            margin-bottom: var(--spacing-xs);
        }

        .county-popup-label {
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
        }

        .map-tooltip {
            position: absolute;
            background: var(--color-navy);
            color: var(--color-white);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--border-radius-sm);
            font-size: var(--font-size-sm);
            pointer-events: none;
            opacity: 0;
            transition: opacity var(--transition-fast);
            z-index: 1000;
            white-space: nowrap;
        }

        .map-tooltip.visible {
            opacity: 1;
        }

        .stats-right {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xl);
        }

        .ranking-card,
        .activity-feed-card {
            background: linear-gradient(135deg, var(--color-bg-lighter), var(--color-white));
            border: 2px solid var(--color-border);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-xl);
        }

        .ranking-card h3,
        .activity-feed-card h3 {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            line-height: var(--line-height-tight);
            color: var(--color-navy);
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .ranking-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .ranking-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .ranking-position {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--color-primary-blue), var(--color-primary-teal));
            color: var(--color-white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: var(--font-weight-bold);
            font-size: var(--font-size-sm);
            flex-shrink: 0;
        }

        .ranking-position.top-1 {
            background: linear-gradient(135deg, #FFD700, #FFA500);
        }

        .ranking-position.top-2 {
            background: linear-gradient(135deg, #C0C0C0, #A8A8A8);
        }

        .ranking-position.top-3 {
            background: linear-gradient(135deg, #CD7F32, #B87333);
        }

        .ranking-info {
            flex: 1;
        }

        .ranking-name {
            font-weight: var(--font-weight-bold);
            color: var(--color-navy);
            margin-bottom: 4px;
        }

        .ranking-bar {
            height: 8px;
            background: var(--color-border);
            border-radius: var(--border-radius-full);
            overflow: hidden;
        }

        .ranking-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--color-primary-blue), var(--color-primary-teal));
            border-radius: var(--border-radius-full);
            transition: width 1s ease;
        }

        .ranking-count {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            font-weight: var(--font-weight-bold);
            min-width: 60px;
            text-align: right;
        }

        .activity-feed {
            max-height: 300px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .activity-feed::-webkit-scrollbar {
            width: 6px;
        }

        .activity-feed::-webkit-scrollbar-track {
            background: var(--color-bg-light);
            border-radius: var(--border-radius-full);
        }

        .activity-feed::-webkit-scrollbar-thumb {
            background: var(--color-border);
            border-radius: var(--border-radius-full);
        }

        .activity-feed::-webkit-scrollbar-thumb:hover {
            background: var(--color-primary-blue);
        }

        .activity-item {
            display: flex;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            background: var(--color-white);
            border-radius: var(--border-radius-sm);
            border-left: 3px solid var(--color-primary-teal);
            animation: slideInRight 0.5s ease;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .activity-feed .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--color-primary-teal), var(--color-primary-blue));
            color: var(--color-white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-xl);
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-text {
            font-size: var(--font-size-sm);
            color: var(--color-text-primary);
            margin-bottom: 4px;
        }

        .activity-time {
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
        }

        .pulse-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: var(--color-primary-teal);
            border-radius: 50%;
            margin-right: var(--spacing-xs);
            animation: pulse-animation 2s infinite;
        }

        @keyframes pulse-animation {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.5;
                transform: scale(1.2);
            }
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .stats-dashboard {
                grid-template-columns: 1fr;
            }

            .stats-counters {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .stats-counters {
                grid-template-columns: 1fr;
            }

            .stats-header-content {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .stats-meta {
                margin-top: var(--spacing-xs);
            }

            .stats-update-time {
                font-size: 0.8125rem;
            }

            .stats-refresh-btn {
                width: 28px;
                height: 28px;
            }

            .stats-refresh-btn .material-icons {
                font-size: 16px;
            }
        }

        /* ===== Content Sections ===== */
        .section-title {
            font-size: var(--font-size-3xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-navy);
            margin-bottom: var(--spacing-md);
            text-align: center;
        }

        .section-subtitle {
            font-size: var(--font-size-xl);
            color: var(--color-text-secondary);
            text-align: center;
            max-width: 800px;
            margin: 0 auto var(--spacing-2xl);
            line-height: 1.8;
        }

        /* ===== AI Pillars Section ===== */
        .pillars-intro {
            text-align: center;
            margin-bottom: var(--spacing-xl);
            font-size: var(--font-size-lg);
            color: var(--color-text-secondary);
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Progress Flow */
        .pillars-flow {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
            flex-wrap: wrap;
        }

        .pillars-flow-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .pillars-flow-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-white);
            cursor: pointer;
            transition: all var(--transition-base);
            border: 3px solid transparent;
        }

        .pillars-flow-icon:hover {
            transform: scale(1.1);
        }

        .pillars-flow-icon.active {
            border-color: var(--color-navy);
            box-shadow: var(--shadow-lg);
        }

        .pillars-flow-item:nth-child(1) .pillars-flow-icon { background: linear-gradient(135deg, var(--color-primary-orange), var(--color-yellow)); }
        .pillars-flow-item:nth-child(3) .pillars-flow-icon { background: linear-gradient(135deg, var(--color-primary-blue), var(--color-primary-teal)); }
        .pillars-flow-item:nth-child(5) .pillars-flow-icon { background: linear-gradient(135deg, var(--color-primary-teal), var(--color-primary-blue)); }
        .pillars-flow-item:nth-child(7) .pillars-flow-icon { background: linear-gradient(135deg, var(--color-yellow), var(--color-coral)); }

        .pillars-flow-label {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            color: var(--color-navy);
        }

        .pillars-flow-sublabel {
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
        }

        .pillars-flow-arrow {
            font-size: var(--font-size-xl);
            color: var(--color-text-tertiary);
            margin: 0 var(--spacing-xs);
        }

        .pillars-depth-bar {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-2xl);
            padding: var(--spacing-sm) var(--spacing-lg);
            background: linear-gradient(90deg, var(--color-primary-orange), var(--color-primary-blue), var(--color-primary-teal), var(--color-yellow));
            border-radius: var(--border-radius-full);
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .pillars-depth-bar span {
            color: var(--color-white);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        /* Pillar Cards Grid */
        .pillars-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-lg);
            margin-top: var(--spacing-xl);
        }

        .pillar-card {
            background: var(--color-white);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-xl);
            text-align: center;
            box-shadow: var(--shadow-md);
            transition: all var(--transition-base);
            border: 2px solid transparent;
            cursor: pointer;
            position: relative;
        }

        .pillar-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
        }

        .pillar-card.active {
            border-width: 3px;
        }

        .pillar-card:nth-child(1) { border-color: var(--color-primary-orange); }
        .pillar-card:nth-child(2) { border-color: var(--color-primary-blue); }
        .pillar-card:nth-child(3) { border-color: var(--color-primary-teal); }
        .pillar-card:nth-child(4) { border-color: var(--color-yellow); }

        .pillar-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-sm) var(--spacing-lg);
            margin: 0 auto var(--spacing-md);
            border-radius: var(--border-radius-md);
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-white);
        }

        .pillar-card:nth-child(1) .pillar-icon { background: linear-gradient(135deg, var(--color-primary-orange), var(--color-yellow)); }
        .pillar-card:nth-child(2) .pillar-icon { background: linear-gradient(135deg, var(--color-primary-blue), var(--color-primary-teal)); }
        .pillar-card:nth-child(3) .pillar-icon { background: linear-gradient(135deg, var(--color-primary-teal), var(--color-primary-blue)); }
        .pillar-card:nth-child(4) .pillar-icon { background: linear-gradient(135deg, var(--color-yellow), var(--color-coral)); }

        .pillar-english {
            font-size: var(--font-size-sm);
            color: var(--color-text-tertiary);
            margin-bottom: var(--spacing-sm);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .pillar-subtitle {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-bottom: var(--spacing-sm);
        }

        .pillar-card p.pillar-brief {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-normal);
            line-height: var(--line-height-relaxed);
            color: var(--color-text-secondary);
        }

        .pillar-details-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-xs);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            margin-top: var(--spacing-md);
            padding: var(--spacing-sm) var(--spacing-lg);
            border: 2px solid var(--color-text-tertiary);
            border-radius: var(--border-radius-full);
            background: transparent;
            color: var(--color-text-secondary);
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .pillar-details-button:hover {
            transform: translateY(-2px);
        }

        .pillar-details-button .material-icons {
            font-size: 18px;
        }

        .pillar-card:nth-child(1) .pillar-details-button {
            border-color: var(--color-primary-orange);
            color: var(--color-primary-orange);
        }
        .pillar-card:nth-child(1) .pillar-details-button:hover {
            background: var(--color-primary-orange);
            color: var(--color-white);
        }

        .pillar-card:nth-child(2) .pillar-details-button {
            border-color: var(--color-primary-blue);
            color: var(--color-primary-blue);
        }
        .pillar-card:nth-child(2) .pillar-details-button:hover {
            background: var(--color-primary-blue);
            color: var(--color-white);
        }

        .pillar-card:nth-child(3) .pillar-details-button {
            border-color: var(--color-primary-teal);
            color: var(--color-primary-teal);
        }
        .pillar-card:nth-child(3) .pillar-details-button:hover {
            background: var(--color-primary-teal);
            color: var(--color-white);
        }

        .pillar-card:nth-child(4) .pillar-details-button {
            border-color: var(--color-yellow);
            color: #b8860b;
        }
        .pillar-card:nth-child(4) .pillar-details-button:hover {
            background: var(--color-yellow);
            color: var(--color-navy);
        }

        /* Hidden Detail Panel - content is displayed in modal */
        .pillar-detail {
            display: none;
        }

        .pillar-detail-header {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
            padding-bottom: var(--spacing-lg);
            border-bottom: 2px solid var(--color-bg-light);
        }

        .pillar-detail-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-3xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-white);
            flex-shrink: 0;
        }

        .pillar-detail[data-pillar="ask"] .pillar-detail-icon { background: linear-gradient(135deg, var(--color-primary-orange), var(--color-yellow)); }
        .pillar-detail[data-pillar="use"] .pillar-detail-icon { background: linear-gradient(135deg, var(--color-primary-blue), var(--color-primary-teal)); }
        .pillar-detail[data-pillar="manage"] .pillar-detail-icon { background: linear-gradient(135deg, var(--color-primary-teal), var(--color-primary-blue)); }
        .pillar-detail[data-pillar="build"] .pillar-detail-icon { background: linear-gradient(135deg, var(--color-yellow), var(--color-coral)); }

        .pillar-detail[data-pillar="ask"] { border-top: 4px solid var(--color-primary-orange); }
        .pillar-detail[data-pillar="use"] { border-top: 4px solid var(--color-primary-blue); }
        .pillar-detail[data-pillar="manage"] { border-top: 4px solid var(--color-primary-teal); }
        .pillar-detail[data-pillar="build"] { border-top: 4px solid var(--color-yellow); }

        .pillar-detail-title-group {
            flex: 1;
        }

        .pillar-detail-english {
            font-size: var(--font-size-sm);
            color: var(--color-text-tertiary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: var(--spacing-xs);
        }

        .pillar-detail-title {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-navy);
            margin-bottom: var(--spacing-xs);
        }

        .pillar-detail-subtitle {
            font-size: var(--font-size-base);
            color: var(--color-text-secondary);
        }

        .pillar-detail-headline {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-semibold);
            color: var(--color-navy);
            margin-bottom: var(--spacing-xl);
            padding: var(--spacing-md);
            background: var(--color-bg-light);
            border-radius: var(--border-radius-md);
            border-left: 4px solid currentColor;
        }

        .pillar-detail[data-pillar="ask"] .pillar-detail-headline { border-left-color: var(--color-primary-orange); }
        .pillar-detail[data-pillar="use"] .pillar-detail-headline { border-left-color: var(--color-primary-blue); }
        .pillar-detail[data-pillar="manage"] .pillar-detail-headline { border-left-color: var(--color-primary-teal); }
        .pillar-detail[data-pillar="build"] .pillar-detail-headline { border-left-color: var(--color-yellow); }

        .pillar-detail-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-xl);
        }

        .pillar-detail-section {
            padding: var(--spacing-lg);
            border-radius: var(--border-radius-md);
        }

        .pillar-detail-section.gap-section {
            background: linear-gradient(135deg, #fff5f5, #fff);
            border: 1px solid #ffcccc;
        }

        .pillar-detail-section.goal-section {
            background: linear-gradient(135deg, #f0fff4, #fff);
            border: 1px solid #9ae6b4;
        }

        .pillar-detail-section-title {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-bold);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: var(--spacing-md);
        }

        .gap-section .pillar-detail-section-title {
            color: #c53030;
        }

        .goal-section .pillar-detail-section-title {
            color: #276749;
        }

        .pillar-detail-section p {
            font-size: var(--font-size-base);
            line-height: var(--line-height-relaxed);
            color: var(--color-text-primary);
        }

        .pillar-detail-section ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .pillar-detail-section ul li {
            font-size: var(--font-size-base);
            line-height: var(--line-height-relaxed);
            color: var(--color-text-primary);
            padding-left: var(--spacing-lg);
            position: relative;
            margin-bottom: var(--spacing-sm);
        }

        .pillar-detail-section ul li::before {
            content: '•';
            position: absolute;
            left: 0;
            color: #276749;
            font-weight: bold;
        }

        .pillar-detail-insight {
            margin-top: var(--spacing-xl);
            padding: var(--spacing-lg);
            background: linear-gradient(135deg, #fffbeb, #fff);
            border-radius: var(--border-radius-md);
            border: 1px solid #f6e05e;
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-md);
        }

        .pillar-detail-insight .insight-icon {
            font-size: var(--font-size-xl);
        }

        .pillar-detail-insight p {
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-medium);
            color: var(--color-navy);
            line-height: var(--line-height-relaxed);
            margin: 0;
        }

        /* Pillar Tabs Styles */
        .pillar-tabs {
            margin-top: var(--spacing-lg);
        }

        .pillar-tabs-nav {
            display: flex;
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--color-bg-light);
            padding-bottom: var(--spacing-xs);
        }

        .pillar-tab-btn {
            flex: 1;
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            background: transparent;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-tertiary);
            cursor: pointer;
            border-radius: var(--border-radius-md);
            transition: all var(--transition-base);
        }

        .pillar-tab-btn:hover {
            background: var(--color-bg-light);
            color: var(--color-text-secondary);
        }

        .pillar-tab-btn.active {
            background: var(--color-navy);
            color: var(--color-white);
        }

        .pillar-tabs-content {
            position: relative;
        }

        .pillar-tab-panel {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .pillar-tab-panel.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pillar-level-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        .pillar-level-icon {
            font-size: var(--font-size-2xl);
        }

        .pillar-level-title {
            display: flex;
            flex-direction: column;
        }

        .pillar-level-title strong {
            font-size: var(--font-size-lg);
            color: var(--color-navy);
        }

        .pillar-level-english {
            font-size: var(--font-size-xs);
            color: var(--color-text-tertiary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .pillar-level-desc {
            font-size: var(--font-size-base);
            color: var(--color-text-primary);
            line-height: var(--line-height-relaxed);
            margin-bottom: var(--spacing-md);
        }

        .pillar-level-example {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--color-bg-light);
            border-radius: var(--border-radius-md);
            font-size: var(--font-size-sm);
        }

        .example-label {
            font-weight: var(--font-weight-semibold);
            color: var(--color-primary-blue);
            white-space: nowrap;
        }

        .pillar-level-example > span:last-child {
            color: var(--color-text-secondary);
        }

        /* Pillar Modal Styles */
        .pillar-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-md);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .pillar-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .pillar-modal {
            background: var(--color-white);
            border-radius: var(--border-radius-lg);
            max-width: 700px;
            width: 100%;
            max-height: 85vh;
            overflow: hidden;
            position: relative;
            transform: translateY(20px) scale(0.95);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .pillar-modal-overlay.active .pillar-modal {
            transform: translateY(0) scale(1);
        }

        .pillar-modal-header {
            display: flex;
            justify-content: flex-end;
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--color-white);
            flex-shrink: 0;
            border-bottom: 1px solid var(--color-bg-light);
        }

        .pillar-modal-close {
            width: 36px;
            height: 36px;
            border: none;
            background: var(--color-bg-light);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s ease, transform 0.2s ease;
        }

        .pillar-modal-close:hover {
            background: var(--color-bg-dark);
            transform: scale(1.1);
        }

        .pillar-modal-close .material-icons {
            font-size: 22px;
            color: var(--color-text-secondary);
        }

        .pillar-modal-content {
            padding: var(--spacing-xl) var(--spacing-2xl) var(--spacing-2xl);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            flex: 1;
            overscroll-behavior: contain;
        }

        /* Modal content styles - reuse pillar-detail inner styles */
        .pillar-modal-content .pillar-detail-header {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
            padding-bottom: var(--spacing-lg);
            border-bottom: 2px solid var(--color-bg-light);
        }

        .pillar-modal-content .pillar-detail-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-3xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-white);
            flex-shrink: 0;
        }

        .pillar-modal-content[data-pillar="ask"] .pillar-detail-icon { background: linear-gradient(135deg, var(--color-primary-orange), var(--color-yellow)); }
        .pillar-modal-content[data-pillar="use"] .pillar-detail-icon { background: linear-gradient(135deg, var(--color-primary-blue), var(--color-primary-teal)); }
        .pillar-modal-content[data-pillar="manage"] .pillar-detail-icon { background: linear-gradient(135deg, var(--color-primary-teal), var(--color-primary-blue)); }
        .pillar-modal-content[data-pillar="build"] .pillar-detail-icon { background: linear-gradient(135deg, var(--color-yellow), var(--color-coral)); }

        .pillar-modal-content .pillar-detail-title-group {
            flex: 1;
        }

        .pillar-modal-content .pillar-detail-english {
            font-size: var(--font-size-sm);
            color: var(--color-text-tertiary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: var(--spacing-xs);
        }

        .pillar-modal-content .pillar-detail-title {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-navy);
            margin-bottom: var(--spacing-xs);
        }

        .pillar-modal-content .pillar-detail-subtitle {
            font-size: var(--font-size-base);
            color: var(--color-text-secondary);
        }

        .pillar-modal-content .pillar-detail-headline {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-semibold);
            color: var(--color-navy);
            margin-bottom: var(--spacing-xl);
            padding: var(--spacing-md);
            background: var(--color-bg-light);
            border-radius: var(--border-radius-md);
            border-left: 4px solid currentColor;
        }

        .pillar-modal-content[data-pillar="ask"] .pillar-detail-headline { border-left-color: var(--color-primary-orange); }
        .pillar-modal-content[data-pillar="use"] .pillar-detail-headline { border-left-color: var(--color-primary-blue); }
        .pillar-modal-content[data-pillar="manage"] .pillar-detail-headline { border-left-color: var(--color-primary-teal); }
        .pillar-modal-content[data-pillar="build"] .pillar-detail-headline { border-left-color: var(--color-yellow); }

        .pillar-modal-content .pillar-detail-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-xl);
        }

        .pillar-modal-content .pillar-detail-section {
            padding: var(--spacing-lg);
            border-radius: var(--border-radius-md);
        }

        .pillar-modal-content .pillar-detail-section.gap-section {
            background: linear-gradient(135deg, #fff5f5, #fff);
            border: 1px solid #ffcccc;
        }

        .pillar-modal-content .pillar-detail-section.goal-section {
            background: linear-gradient(135deg, #f0fff4, #fff);
            border: 1px solid #9ae6b4;
        }

        .pillar-modal-content .pillar-detail-section-title {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-bold);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: var(--spacing-md);
        }

        .pillar-modal-content .gap-section .pillar-detail-section-title {
            color: #c53030;
        }

        .pillar-modal-content .goal-section .pillar-detail-section-title {
            color: #276749;
        }

        .pillar-modal-content .pillar-detail-section p {
            font-size: var(--font-size-base);
            line-height: var(--line-height-relaxed);
            color: var(--color-text-primary);
            margin: 0;
        }

        .pillar-modal-content .pillar-detail-section ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .pillar-modal-content .pillar-detail-section ul li {
            font-size: var(--font-size-base);
            line-height: var(--line-height-relaxed);
            color: var(--color-text-primary);
            padding-left: var(--spacing-lg);
            position: relative;
            margin-bottom: var(--spacing-sm);
        }

        .pillar-modal-content .pillar-detail-section ul li::before {
            content: '\2022';
            position: absolute;
            left: 0;
            color: #276749;
            font-weight: bold;
        }

        .pillar-modal-content .pillar-detail-insight {
            margin-top: var(--spacing-xl);
            padding: var(--spacing-lg);
            background: linear-gradient(135deg, #fffbeb, #fff);
            border-radius: var(--border-radius-md);
            border: 1px solid #f6e05e;
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-md);
        }

        .pillar-modal-content .pillar-detail-insight .insight-icon {
            font-size: var(--font-size-xl);
        }

        .pillar-modal-content .pillar-detail-insight p {
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-medium);
            color: var(--color-navy);
            line-height: var(--line-height-relaxed);
            margin: 0;
        }

        /* Modal Tab Styles */
        .pillar-modal-content .pillar-tabs {
            margin-top: var(--spacing-lg);
        }

        .pillar-modal-content .pillar-tabs-nav {
            display: flex;
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--color-bg-light);
            padding-bottom: var(--spacing-xs);
        }

        .pillar-modal-content .pillar-tab-btn {
            flex: 1;
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            background: transparent;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-tertiary);
            cursor: pointer;
            border-radius: var(--border-radius-md);
            transition: all var(--transition-base);
        }

        .pillar-modal-content .pillar-tab-btn:hover {
            background: var(--color-bg-light);
            color: var(--color-text-secondary);
        }

        .pillar-modal-content .pillar-tab-btn.active {
            background: var(--color-navy);
            color: var(--color-white);
        }

        .pillar-modal-content .pillar-tab-panel {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .pillar-modal-content .pillar-tab-panel.active {
            display: block;
        }

        .pillar-modal-content .pillar-level-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        .pillar-modal-content .pillar-level-icon {
            font-size: var(--font-size-2xl);
        }

        .pillar-modal-content .pillar-level-title {
            display: flex;
            flex-direction: column;
        }

        .pillar-modal-content .pillar-level-title strong {
            font-size: var(--font-size-lg);
            color: var(--color-navy);
        }

        .pillar-modal-content .pillar-level-english {
            font-size: var(--font-size-xs);
            color: var(--color-text-tertiary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .pillar-modal-content .pillar-level-desc {
            font-size: var(--font-size-base);
            color: var(--color-text-primary);
            line-height: var(--line-height-relaxed);
            margin-bottom: var(--spacing-md);
        }

        .pillar-modal-content .pillar-level-example {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--color-bg-light);
            border-radius: var(--border-radius-md);
            font-size: var(--font-size-sm);
        }

        .pillar-modal-content .example-label {
            font-weight: var(--font-weight-semibold);
            color: var(--color-primary-blue);
            white-space: nowrap;
        }

        .pillar-modal-content .pillar-level-example > span:last-child {
            color: var(--color-text-secondary);
        }

        /* Mobile responsive for modal */
        @media (max-width: 768px) {
            .pillar-modal-overlay {
                padding: 0;
                align-items: flex-end;
            }

            .pillar-modal {
                max-height: 80vh;
                max-height: 80dvh; /* Dynamic viewport height for mobile browsers */
                border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
                margin-bottom: 0;
            }

            .pillar-modal-header {
                padding: var(--spacing-sm) var(--spacing-md);
            }

            .pillar-modal-content {
                padding: var(--spacing-md) var(--spacing-lg) var(--spacing-xl);
            }

            .pillar-modal-content .pillar-detail-header {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .pillar-modal-content .pillar-detail-icon {
                width: 60px;
                height: 60px;
                font-size: var(--font-size-2xl);
            }

            .pillar-modal-content .pillar-detail-content {
                grid-template-columns: 1fr;
            }

            .pillar-modal-content .pillar-detail-insight {
                flex-direction: column;
                text-align: center;
            }

            /* Mobile tab styles */
            .pillar-modal-content .pillar-tabs-nav {
                gap: var(--spacing-xs);
            }

            .pillar-modal-content .pillar-tab-btn {
                padding: var(--spacing-xs) var(--spacing-sm);
                font-size: var(--font-size-xs);
            }

            .pillar-modal-content .pillar-level-example {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-xs);
            }
        }

        /* Body scroll lock for modal */
        body.modal-open {
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }

        /* Footer message */
        .pillars-footer {
            text-align: center;
            margin-top: var(--spacing-2xl);
            padding: var(--spacing-xl);
            background: var(--color-white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-sm);
        }

        .pillars-footer p {
            font-size: var(--font-size-base);
            color: var(--color-text-secondary);
            line-height: var(--line-height-relaxed);
            margin: 0;
        }

        .pillars-footer p strong {
            color: var(--color-navy);
        }

        /* ===== Activities Section ===== */
        .official-selection-badge {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 193, 7, 0.1));
            border: 2px solid var(--color-yellow);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-lg) var(--spacing-xl);
            margin: var(--spacing-xl) auto;
            max-width: 600px;
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            text-align: center;
            box-shadow: 0 4px 16px rgba(255, 215, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .official-selection-badge::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .official-selection-badge p {
            margin: 0;
            font-size: var(--font-size-sm);
            color: var(--color-text-primary);
            flex: 1;
            position: relative;
            z-index: 1;
        }

        .official-selection-badge strong {
            color: var(--color-navy);
            font-weight: var(--font-weight-bold);
        }

        /* Activity Cards Layout */
        .activity-cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: var(--spacing-xl);
            margin-top: var(--spacing-2xl);
        }

        .activity-card {
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: var(--spacing-3xl) var(--spacing-xl);
            background: var(--color-white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            transition: all var(--transition-base);
            overflow: hidden;
            cursor: pointer;
            min-height: 400px;
        }

        @media (hover: hover) {
            .activity-card:hover {
                transform: translateY(-4px);
                box-shadow: var(--shadow-xl);
            }
        }

        .activity-card:first-child {
            background: linear-gradient(135deg, var(--color-primary-blue), var(--color-primary-teal));
            color: var(--color-white);
        }

        .activity-card:last-child {
            background: linear-gradient(135deg, var(--color-primary-blue), var(--color-primary-teal));
            color: var(--color-white);
        }

        .activity-card-content {
            text-align: center;
            z-index: 2;
            position: relative;
            transition: opacity var(--transition-slow);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        .activity-card .activity-icon {
            margin-bottom: var(--spacing-lg);
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: none !important;
            border: none !important;
            border-radius: 0 !important;
        }

        .activity-card .activity-icon .material-icons {
            font-size: var(--font-size-3xl);
            opacity: 0.9;
            background: none !important;
            border: none !important;
            box-shadow: none !important;
            border-radius: 0 !important;
            outline: none !important;
        }

        /* 首張卡片（半導體）icon為白色 */
        .activity-card:first-child .activity-icon .material-icons {
            color: var(--color-white) !important;
            background: transparent !important;
        }

        /* 第二張卡片（數據）icon統一為白色 */
        .activity-card:last-child .activity-icon .material-icons {
            color: var(--color-white) !important;
            background: transparent !important;
        }

        .activity-card-title {
            font-size: var(--font-size-3xl);
            font-weight: var(--font-weight-bold);
            margin-bottom: var(--spacing-lg);
            line-height: 1.1;
        }

        .activity-meta {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
            opacity: 0.9;
        }

        .activity-details-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-xs);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            margin-top: var(--spacing-md);
            padding: var(--spacing-md) var(--spacing-xl);
            border: 2px solid rgba(255, 255, 255, 0.4);
            border-radius: var(--border-radius-full);
            backdrop-filter: blur(6px);
            background: rgba(255, 255, 255, 0.15);
            color: inherit;
            cursor: pointer;
            transition: all var(--transition-base);
            animation: pulse-gentle 2s infinite;
            position: relative;
            z-index: 100;
            pointer-events: auto;
        }

        .activity-details-button:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.6);
            transform: translateY(-2px);
            animation: none;
        }

        @keyframes pulse-gentle {
            0%, 100% { transform: scale(1); opacity: 0.9; }
            50% { transform: scale(1.05); opacity: 1; }
        }

        .activity-card:first-child .activity-details-button {
            color: rgba(255, 255, 255, 0.8);
        }

        .activity-card:last-child .activity-details-button {
            color: rgba(255, 255, 255, 0.8);
        }

        .activity-info,
        .activity-provider {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-xs);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
        }

        .overlay-actions {
            display: flex;
            gap: var(--spacing-md);
            margin-top: var(--spacing-lg);
            justify-content: center;
            flex-wrap: wrap;
        }

        .overlay-cta {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
            background: var(--color-yellow);
            color: var(--color-navy);
            padding: var(--spacing-md) var(--spacing-xl);
            border-radius: var(--border-radius-full);
            font-weight: var(--font-weight-bold);
            text-decoration: none;
            transition: all var(--transition-base);
            box-shadow: var(--shadow-lg);
        }

        .overlay-cta:hover {
            background: var(--color-white);
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }

        .overlay-close {
            display: none !important;
            align-items: center;
            gap: var(--spacing-xs);
            background: rgba(255, 255, 255, 0.2);
            color: var(--color-white);
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: var(--spacing-sm) var(--spacing-lg);
            border-radius: var(--border-radius-full);
            font-weight: var(--font-weight-semibold);
            cursor: pointer;
            transition: all var(--transition-base);
            backdrop-filter: blur(1px);
            font-size: var(--font-size-sm);
        }

        .overlay-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .activity-card-image {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
            opacity: 0;
            transition: all var(--transition-slow);
            z-index: 3;
            pointer-events: none; /* 初始狀態不可點擊 */
        }

        .activity-card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
        }

        .split-hero-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.3));
            display: flex;
            align-items: flex-end;
            padding: var(--spacing-xl);
            opacity: 0;
            transition: opacity var(--transition-base);
        }

        .overlay-content {
            color: var(--color-white);
            width: 100%;
        }

        .overlay-content h4 {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            line-height: var(--line-height-normal);
            margin-bottom: var(--spacing-sm);
        }

        .overlay-content ul {
            list-style: none;
            padding: 0;
        }

        .overlay-content li {
            font-size: var(--font-size-sm);
            margin-bottom: var(--spacing-xs);
            padding-left: var(--spacing-md);
            position: relative;
        }

        .overlay-content li::before {
            content: "✓";
            position: absolute;
            left: 0;
            color: var(--color-yellow);
            font-weight: var(--font-weight-semibold);
        }

        /* 統一的 Flash-Card 翻轉效果 */
        .activity-card {
            transform-style: preserve-3d;
            transition: transform var(--transition-base);
        }

        .activity-card-content {
            transition: opacity var(--transition-base), transform var(--transition-base);
        }

        .activity-card.flipped .activity-card-content {
            opacity: 0;
            transform: rotateY(15deg) scale(0.95);
            pointer-events: none;
        }

        .activity-card.flipped .activity-card-image {
            opacity: 1;
            transform: scale(1);
            pointer-events: auto; /* 翻轉後可點擊 */
        }

        .activity-card.flipped .image-overlay {
            opacity: 1;
            backdrop-filter: blur(2px);
        }

        .activity-card.flipped .overlay-close {
            display: inline-flex !important;
        }


        /* 群體1: 圖片區域 - 預設完全隱藏 */
        .activity-image-section {
            display: none;
            width: 100%;
        }

        /* 展開時才顯示圖片 */
        .activity-card.expanded .activity-image-section {
            display: block;
        }

        .activity-image {
            width: 100%;
            height: 0;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            position: relative;
            overflow: hidden;
            border-radius: 0;
            border: none;
            box-shadow: none;
        }

        .activity-image img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--transition-base);
        }


        /* 移除 hover 圖片縮放效果 */


        /* Enhanced image scaling on expanded */
        .activity-card.expanded .activity-image img {
            transform: scale(1.05);
        }

        /* Accessibility improvements */
        .activity-card:focus-within {
            outline: 3px solid var(--color-primary-blue);
            outline-offset: 2px;
        }


        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            .activity-image::after,
            .activity-image::before {
                transition: none;
            }

            .activity-card:hover .activity-image img,
            .activity-card.expanded .activity-image img {
                transform: none;
            }
        }



        /* 群體2: 文字內容區域 - 現在是主要視覺區域 */
        .activity-content-section {
            width: 100%;
            padding: var(--spacing-2xl) var(--spacing-xl);
            background: linear-gradient(135deg, var(--color-primary-blue), var(--color-primary-teal));
            color: var(--color-white);
            text-align: center;
            position: relative;
            overflow: hidden;
            min-height: 280px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border-radius: var(--border-radius-lg);
        }

        /* 為不同卡片添加不同的漸變色 */
        .activity-card:nth-child(1) .activity-content-section {
            background: linear-gradient(135deg, var(--color-primary-blue), var(--color-primary-teal));
        }

        .activity-card:nth-child(2) .activity-content-section {
            background: linear-gradient(135deg, var(--color-primary-orange), var(--color-yellow));
        }

        /* 簡單的背景裝飾 */
        .activity-content-section::before {
            content: '';
            position: absolute;
            top: -20%;
            right: -10%;
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.05) 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
        }

        .activity-title {
            font-size: var(--font-size-3xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-white);
            margin-bottom: var(--spacing-lg);
            line-height: 1.1;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
            position: relative;
            z-index: 1;
            letter-spacing: -0.02em;
        }

        .activity-platform {
            font-size: var(--font-size-base);
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: var(--spacing-lg);
            font-weight: var(--font-weight-semibold);
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-xs);
        }

        .activity-target {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-xs);
            color: rgba(255, 255, 255, 0.95);
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-semibold);
            position: relative;
            z-index: 1;
        }

        /* 群體3: 展開提示 - 移至卡片底部中央 */
        .activity-expand-section {
            position: absolute;
            bottom: var(--spacing-md);
            left: 50%;
            transform: translateX(-50%);
            z-index: 3;
        }

        .activity-expand-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-xs);
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: var(--border-radius-full);
            padding: var(--spacing-xs) var(--spacing-md);
            cursor: pointer;
            transition: all var(--transition-base);
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
            backdrop-filter: blur(8px);
            box-shadow: var(--shadow-sm);
        }

        .activity-expand-btn:hover {
            background: var(--color-white);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            color: var(--color-primary-blue);
        }

        .expand-text {
            font-weight: var(--font-weight-semibold);
        }

        /* 群體4: 詳細資訊區域 */
        .activity-details-section {
            width: 100%;
            max-height: 0;
            overflow: hidden;
            transition: all var(--transition-base);
            border-top: 1px solid var(--color-border);
            opacity: 0;
        }

        .activity-card.expanded .activity-details-section {
            max-height: 400px;
            opacity: 1;
        }

        .activity-details {
            padding: var(--spacing-lg) var(--spacing-md) var(--spacing-md);
        }

        .activity-details h5 {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-semibold);
            line-height: var(--line-height-normal);
            color: var(--color-text-primary);
            margin-bottom: var(--spacing-md);
            text-align: center;
        }

        .activity-details ul {
            list-style: none;
            padding: 0;
            margin: 0 0 var(--spacing-lg) 0;
            text-align: left;
        }

        .activity-details li {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-bottom: var(--spacing-sm);
            padding-left: var(--spacing-lg);
            position: relative;
            line-height: 1.5;
        }

        .activity-details li::before {
            content: "✓";
            position: absolute;
            left: 0;
            color: var(--color-primary-teal);
            font-weight: var(--font-weight-semibold);
        }

        .activity-cta {
            padding: 0 var(--spacing-md) var(--spacing-lg);
        }

        .activity-cta .btn {
            width: 100%;
            max-width: 280px;
            margin: 0 auto;
            display: flex;
            justify-content: center;
        }

        /* 展開按鈕旋轉效果 */
        .activity-card.expanded .activity-expand-btn .material-icons {
            transform: rotate(180deg);
        }

        .activity-card.expanded .expand-text {
            color: var(--color-primary-blue);
        }

        .activity-platform {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-bottom: var(--spacing-xs);
        }

        .activity-target {
            display: inline-block;
            background: linear-gradient(135deg, var(--color-primary-blue), var(--color-primary-teal));
            color: var(--color-white);
            font-size: var(--font-size-xs);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius-full);
            font-weight: var(--font-weight-semibold);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.2);
            position: relative;
            overflow: hidden;
        }

        .activity-target::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        /* 移除 target hover 效果 */

        .activity-expand-btn {
            position: absolute;
            top: var(--spacing-md);
            right: var(--spacing-md);
            background: transparent;
            border: none;
            color: var(--color-text-secondary);
            cursor: pointer;
            padding: var(--spacing-xs);
            border-radius: 50%;
            transition: all var(--transition-base);
        }

        /* 移除展開按鈕 hover 效果 */

        /* Expanded state */
        .activity-details {
            max-height: 0;
            overflow: hidden;
            transition: all var(--transition-base);
            padding: 0 var(--spacing-lg);
        }

        .activity-card.expanded .activity-details {
            max-height: 200px;
            padding: 0 var(--spacing-lg) var(--spacing-md);
        }

        .activity-card.expanded .activity-expand-btn .material-icons {
            transform: rotate(180deg);
        }

        .activity-details h4 {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
            margin-bottom: var(--spacing-sm);
        }

        .activity-details ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .activity-details li {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-bottom: var(--spacing-xs);
            padding-left: var(--spacing-md);
            position: relative;
        }

        .activity-details li::before {
            content: "✓";
            position: absolute;
            left: 0;
            color: var(--color-primary-teal);
            font-weight: var(--font-weight-semibold);
        }

        /* CTA section */
        .activity-cta {
            padding: 0 var(--spacing-lg) var(--spacing-lg);
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            transition: all var(--transition-base);
        }

        .activity-card.expanded .activity-cta {
            opacity: 1;
            max-height: 100px;
        }

        .activity-cta .btn {
            width: 100%;
            justify-content: center;
        }

        /* Mobile responsive styles for activity cards */
        @media (max-width: 768px) {
            .activity-default {
                flex-direction: column;
                text-align: center;
                padding: var(--spacing-md);
            }

            .activity-image {
                width: 100%;
                height: 120px;
                margin-bottom: var(--spacing-sm);
            }

            .activity-expand-btn {
                position: static;
                margin-top: var(--spacing-sm);
            }

            .activity-details {
                padding: 0 var(--spacing-md);
            }

            .activity-card.expanded .activity-details {
                padding: 0 var(--spacing-md) var(--spacing-md);
            }

            .activity-cta {
                padding: 0 var(--spacing-md) var(--spacing-md);
            }

            /* 移動端響應式設計 */
            .activity-cards-container {
                grid-template-columns: 1fr;
                gap: var(--spacing-lg);
                margin-top: var(--spacing-xl);
            }

            .activity-card {
                padding: var(--spacing-2xl) var(--spacing-lg);
                min-height: 350px;
            }

            .activity-card-title {
                font-size: var(--font-size-2xl);
            }

            .activity-meta {
                flex-direction: column;
                align-items: center;
            }

            /* Mobile 上禁用 hover，使用 flipped 系統 */

            .overlay-content h4 {
                font-size: var(--font-size-base);
            }

            .overlay-content li {
                font-size: var(--font-size-xs);
            }

            /* 統一卡片體驗 */

            /* 移動端觸覺反饋 */
            .activity-card:active {
                transform: scale(0.98);
            }

            .activity-icon .material-icons {
                font-size: var(--font-size-3xl);
            }

            /* 已在全域定義關閉按鈕 */


            .activity-platform {
                font-size: var(--font-size-xs);
            }

            /* 移動端隱藏展開按鈕區域，讓整張卡片可點擊 */
            .activity-expand-section {
                display: none;
            }


            /* 移動端點擊反饋 */
            .activity-card:active {
                transform: translateY(-2px) scale(0.98);
                box-shadow: var(--shadow-xl);
                transition: transform 0.1s ease;
            }

            .activity-details {
                padding: var(--spacing-md) var(--spacing-sm) var(--spacing-sm);
            }

            .activity-details h4 {
                font-size: var(--font-size-sm);
                margin-bottom: var(--spacing-sm);
            }

            .activity-details li {
                font-size: var(--font-size-xs);
                margin-bottom: var(--spacing-xs);
                padding-left: var(--spacing-md);
            }

            .official-selection-badge {
                flex-direction: column;
                padding: var(--spacing-md);
                margin: var(--spacing-md) auto;
                gap: var(--spacing-sm);
            }

            .official-selection-badge .material-icons {
                font-size: var(--font-size-xl) !important;
            }

            .official-selection-badge p {
                font-size: var(--font-size-xs);
            }
        }

        .activity-badge {
            display: inline-block;
            background: var(--color-bg-secondary);
            color: var(--color-text-secondary);
            font-weight: var(--font-weight-bold);
            font-size: var(--font-size-xs);
            padding: var(--spacing-xs) var(--spacing-md);
            border-radius: var(--border-radius-full);
            margin-bottom: var(--spacing-md);
        }

        .activity-header {
            background: linear-gradient(135deg, var(--color-primary-blue), var(--color-primary-teal));
            color: var(--color-white);
            padding: var(--spacing-xl);
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .activity-card:nth-child(2) .activity-header {
            background: linear-gradient(135deg, var(--color-primary-teal), var(--color-primary-blue));
        }

        .activity-header h2 {
            font-size: var(--font-size-3xl);
            font-weight: var(--font-weight-bold);
            line-height: var(--line-height-tight);
            margin-bottom: var(--spacing-sm);
        }

        .activity-header p {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-normal);
            line-height: var(--line-height-normal);
            opacity: 0.95;
        }

        .activity-body {
            padding: var(--spacing-xl);
        }

        .activity-body h4 {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            line-height: var(--line-height-normal);
            color: var(--color-navy);
            margin-bottom: var(--spacing-sm);
        }

        .activity-body p {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-normal);
            line-height: var(--line-height-relaxed);
            color: var(--color-text-secondary);
            margin-bottom: var(--spacing-md);
        }

        .activity-body ul {
            list-style: none;
            margin-bottom: var(--spacing-lg);
        }

        .activity-body li {
            padding-left: var(--spacing-lg);
            margin-bottom: var(--spacing-sm);
            position: relative;
            color: var(--color-text-secondary);
        }

        .activity-body li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: var(--color-primary-teal);
            font-weight: var(--font-weight-bold);
        }

        /* ===== Registration Form Section ===== */
        .registration-section {
            background: linear-gradient(135deg, var(--color-bg-light), var(--color-white));
            padding: var(--spacing-3xl) 0;
        }

        .registration-hero-image {
            max-width: 900px;
            margin: var(--spacing-2xl) auto;
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-xl);
            transition: all var(--transition-base);
        }

        .registration-hero-image:hover {
            transform: translateY(-4px);
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.18);
        }

        .registration-hero-image img {
            width: 100%;
            height: auto;
            display: block;
        }

        .form-container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--color-white);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-2xl);
            box-shadow: var(--shadow-xl);
        }

        .contact-info-card {
            max-width: 800px;
            margin: var(--spacing-2xl) auto 0;
            background: linear-gradient(135deg, var(--color-primary-blue), var(--color-primary-teal));
            color: var(--color-white);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-xl);
            box-shadow: var(--shadow-lg);
            text-align: center;
        }

        .contact-info-card h3 {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            line-height: var(--line-height-tight);
            margin-bottom: var(--spacing-sm);
            color: var(--color-white);
        }

        .contact-info-card p {
            font-size: var(--font-size-base);
            margin-bottom: var(--spacing-md);
            opacity: 0.95;
        }

        .contact-email-link {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
            background: var(--color-white);
            color: var(--color-primary-blue);
            padding: var(--spacing-sm) var(--spacing-xl);
            border-radius: var(--border-radius-full);
            font-weight: var(--font-weight-bold);
            font-size: var(--font-size-base);
            text-decoration: none;
            transition: all var(--transition-base);
            box-shadow: var(--shadow-md);
        }

        .contact-email-link:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            background: var(--color-yellow);
            color: var(--color-navy);
        }

        .contact-email-icon {
            font-size: var(--font-size-xl);
        }

        .form-progress {
            display: flex;
            background: var(--color-white);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius-md);
            padding: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .progress-step {
            flex: 1;
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius-sm);
            transition: all var(--transition-base);
            position: relative;
        }

        .progress-step:not(:last-child)::after {
            content: '';
            position: absolute;
            right: calc(-1 * var(--spacing-xs));
            top: 50%;
            transform: translateY(-50%);
            width: 1px;
            height: 20px;
            background: var(--color-border);
        }

        .progress-step-circle {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--color-bg-secondary);
            border: 2px solid var(--color-border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: var(--font-weight-bold);
            color: var(--color-text-secondary);
            transition: all var(--transition-base);
            font-size: var(--font-size-xs);
            flex-shrink: 0;
        }

        .progress-step-circle::before {
            content: attr(data-step);
        }

        .progress-step.active {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(20, 184, 166, 0.1));
        }

        .progress-step.active .progress-step-circle {
            background: linear-gradient(135deg, var(--color-primary-blue), var(--color-primary-teal));
            border-color: var(--color-primary-blue);
            color: var(--color-white);
        }

        .progress-step.completed {
            background: linear-gradient(135deg, rgba(20, 184, 166, 0.08), rgba(20, 184, 166, 0.12));
        }

        .progress-step.completed .progress-step-circle {
            background: var(--color-primary-teal);
            border-color: var(--color-primary-teal);
            color: var(--color-white);
        }

        .progress-step-label {
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-semibold);
            line-height: var(--line-height-normal);
            color: var(--color-text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .progress-step.active .progress-step-label {
            color: var(--color-primary-blue);
        }

        .progress-step.completed .progress-step-label {
            color: var(--color-primary-teal);
        }

        .form-page {
            display: none;
        }

        .form-page.active {
            display: block;
            animation: slideIn 0.4s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .form-page h2 {
            font-size: var(--font-size-3xl);
            font-weight: var(--font-weight-bold);
            line-height: var(--line-height-tight);
            color: var(--color-navy);
            margin-bottom: var(--spacing-sm);
        }

        .form-page-subtitle {
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-normal);
            line-height: var(--line-height-normal);
            color: var(--color-text-secondary);
            margin-bottom: var(--spacing-xl);
        }

        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        .form-label {
            display: block;
            font-weight: var(--font-weight-bold);
            font-size: var(--font-size-sm);
            line-height: var(--line-height-normal);
            color: var(--color-text-primary);
            margin-bottom: var(--spacing-xs);
        }

        .form-label.required::after {
            content: ' *';
            color: var(--color-coral);
        }

        .form-hint {
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-semibold);
            line-height: var(--line-height-normal);
            color: var(--color-text-secondary);
            margin-top: var(--spacing-xs);
        }

        .example-section {
            margin-top: var(--spacing-md);
            border: 1px dashed var(--color-border);
            border-radius: var(--border-radius-sm);
            overflow: hidden;
        }

        .example-toggle {
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--color-bg-lighter) !important;
            border: none !important;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: var(--font-size-sm);
            color: var(--color-primary-blue) !important;
            font-weight: var(--font-weight-semibold);
            transition: all var(--transition-base);
            font-family: var(--font-family) !important;
            text-decoration: none !important;
            outline: none;
        }

        .example-toggle:hover {
            background: var(--color-bg-light) !important;
            color: var(--color-primary-blue) !important;
        }

        /* Fix WordPress pollution - all states */
        .example-toggle:active,
        .example-toggle:focus,
        .example-toggle.active {
            background: var(--color-bg-lighter) !important;
            color: var(--color-primary-blue) !important;
            text-decoration: none !important;
            outline: 2px solid var(--color-primary-blue);
            outline-offset: 2px;
        }

        .example-toggle:active:hover,
        .example-toggle:focus:hover,
        .example-toggle.active:hover {
            background: var(--color-bg-light) !important;
            color: var(--color-primary-blue) !important;
        }

        .example-toggle-icon {
            transition: transform var(--transition-base);
        }

        .example-toggle.active .example-toggle-icon {
            transform: rotate(180deg);
        }

        .example-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height var(--transition-base);
            background: var(--color-white) !important;
            color: var(--color-text-primary) !important;
        }

        .example-content.active {
            max-height: 1500px;
            overflow-y: auto;
            background: var(--color-white) !important;
            color: var(--color-text-primary) !important;
        }

        .example-inner {
            padding: var(--spacing-md);
        }

        .example-item {
            padding: var(--spacing-md);
            background: var(--color-bg-lighter);
            border-radius: var(--border-radius-sm);
            margin-bottom: var(--spacing-md);
        }

        .example-item:last-child {
            margin-bottom: 0;
        }

        .example-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-sm);
        }

        .example-tag {
            display: inline-block;
            background: var(--color-primary-blue);
            color: var(--color-white);
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-bold);
            padding: 4px var(--spacing-sm);
            border-radius: var(--border-radius-sm);
        }

        .example-use-btn {
            background: var(--color-primary-teal) !important;
            color: var(--color-white) !important;
            font-size: var(--font-size-xs);
            padding: 6px var(--spacing-md);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: all var(--transition-base);
            border: none !important;
            font-weight: var(--font-weight-semibold);
            font-family: var(--font-family) !important;
            text-decoration: none !important;
            outline: none;
        }

        .example-use-btn:hover {
            background: var(--color-primary-blue) !important;
            color: var(--color-white) !important;
            transform: translateY(-1px);
        }

        /* Fix WordPress pollution for example-use-btn - all states */
        .example-use-btn:active,
        .example-use-btn:focus {
            background: var(--color-primary-teal) !important;
            color: var(--color-white) !important;
            text-decoration: none !important;
            outline: 2px solid var(--color-primary-blue);
            outline-offset: 2px;
        }

        .example-use-btn:active:hover,
        .example-use-btn:focus:hover {
            background: var(--color-primary-blue) !important;
            color: var(--color-white) !important;
        }

        .example-text {
            font-size: var(--font-size-sm);
            color: var(--color-text-primary);
            line-height: 1.6;
            white-space: pre-wrap;
        }

        .form-error {
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-semibold);
            line-height: var(--line-height-normal);
            color: var(--color-coral);
            margin-top: var(--spacing-xs);
            display: none;
        }

        .form-group.error input,
        .form-group.error select,
        .form-group.error textarea {
            border-color: var(--color-coral);
        }

        .form-group.error .form-error {
            display: block;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-lg);
        }

        .radio-group, .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .radio-option, .checkbox-option {
            display: flex;
            align-items: center;
            padding: var(--spacing-sm) var(--spacing-md);
            border: 2px solid var(--color-border);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .radio-option:hover, .checkbox-option:hover {
            border-color: var(--color-primary-blue);
            background: rgba(59, 125, 214, 0.05);
        }

        .radio-option input, .checkbox-option input {
            width: auto;
            margin-right: var(--spacing-sm);
        }

        .radio-option input:checked ~ label,
        .checkbox-option input:checked ~ label {
            font-weight: var(--font-weight-bold);
            color: var(--color-primary-blue);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* Removed - replaced with .hour-of-ai .form-actions below */

        /* Old button styles removed - replaced with custom hoa-nav-button elements */

        /* Enhanced Form Navigation Layout with Better UX */
        .hoa-form-navigation-wrapper {
            display: flex !important;
            justify-content: space-between !important;
            align-items: center !important;
            width: 100% !important;
            min-height: 80px !important;
            margin-top: var(--spacing-xl) !important;
            padding: var(--spacing-xl) 0 !important;
            border-top: 2px solid var(--color-border) !important;
            position: relative !important;
            clear: both !important;
        }

        /* Apply proven working button styles to navigation buttons */
        .hoa-nav-prev,
        .hoa-nav-next,
        .hoa-nav-submit {
            /* Copy the working .btn base styles */
            padding: var(--spacing-md) var(--spacing-xl) !important;
            border-radius: var(--border-radius-full) !important;
            font-weight: var(--font-weight-bold) !important;
            font-size: var(--font-size-sm) !important;
            line-height: var(--line-height-normal) !important;
            display: inline-flex !important;
            align-items: center !important;
            gap: var(--spacing-xs) !important;
            transition: all var(--transition-base) !important;
            /* Navigation specific */
            border: none !important;
            cursor: pointer !important;
            text-decoration: none !important;
            font-family: var(--font-family) !important;
        }

        /* Previous button - always on the left */
        .hoa-nav-prev {
            order: 1 !important;
            margin-right: auto !important;
            min-width: 120px !important;
        }

        /* Next/Submit button - always on the right */
        .hoa-nav-next,
        .hoa-nav-submit {
            order: 2 !important;
            margin-left: auto !important;
            min-width: 140px !important;
            justify-content: center !important;
        }

        /* Hidden state */
        .hoa-nav-prev.hidden,
        .hoa-nav-next.hidden,
        .hoa-nav-submit.hidden {
            display: none !important;
        }

        /* Copy the successful button styling pattern from .btn-primary and .btn-secondary */

        /* Previous button - use btn-secondary style */
        .hoa-nav-prev {
            background: var(--color-white) !important;
            color: var(--color-primary-blue) !important;
            border: 2px solid var(--color-primary-blue) !important;
        }

        .hoa-nav-prev:hover {
            background: var(--color-primary-blue) !important;
            color: var(--color-white) !important;
        }

        /* Next button - use btn-primary style */
        .hoa-nav-next {
            background: linear-gradient(135deg, var(--color-yellow), var(--color-primary-orange)) !important;
            color: var(--color-navy) !important;
            box-shadow: var(--shadow-lg) !important;
        }

        .hoa-nav-next:hover {
            transform: translateY(-3px) !important;
            box-shadow: var(--shadow-xl) !important;
        }

        /* Submit button - use enhanced btn-primary style */
        .hoa-nav-submit {
            background: linear-gradient(135deg, var(--color-primary-teal), var(--color-primary-blue)) !important;
            color: var(--color-white) !important;
            box-shadow: var(--shadow-lg) !important;
        }

        .hoa-nav-submit:hover {
            transform: translateY(-3px) !important;
            box-shadow: var(--shadow-xl) !important;
        }

        /* Mobile responsive design */
        @media (max-width: 768px) {
            .hoa-form-navigation-wrapper {
                flex-direction: column !important;
                min-height: 140px !important;
                gap: var(--spacing-md) !important;
                padding: var(--spacing-lg) 0 !important;
            }

            .hoa-nav-next,
            .hoa-nav-submit {
                order: 1 !important;
                width: 100% !important;
                margin: 0 !important;
                min-width: unset !important;
            }

            .hoa-nav-prev {
                order: 2 !important;
                width: 100% !important;
                margin: 0 !important;
                justify-content: center !important;
                min-width: unset !important;
            }

            /* Mobile responsive button sizing - copy from responsive .btn */
            .hoa-nav-prev,
            .hoa-nav-next,
            .hoa-nav-submit {
                width: 100% !important;
                justify-content: center !important;
                padding: var(--spacing-md) var(--spacing-lg) !important;
            }
        }

        /* Clean focus states for accessibility */
        .hoa-nav-prev:focus,
        .hoa-nav-next:focus,
        .hoa-nav-submit:focus {
            outline: 2px solid var(--color-primary-blue) !important;
            outline-offset: 2px !important;
        }

        /* Success Message */
        .success-message {
            text-align: center;
            padding: var(--spacing-2xl);
        }

        /* Fix submitAnotherBtn to match other primary buttons */
        #submitAnotherBtn {
            background: linear-gradient(135deg, var(--color-yellow), var(--color-primary-orange)) !important;
            color: var(--color-navy) !important;
            box-shadow: var(--shadow-lg) !important;
            border: none !important;
            text-decoration: none !important;
            transition: all var(--transition-base) !important;
        }

        #submitAnotherBtn:hover {
            transform: translateY(-3px) !important;
            box-shadow: var(--shadow-xl) !important;
            background: linear-gradient(135deg, var(--color-yellow), var(--color-primary-orange)) !important;
            color: var(--color-navy) !important;
        }

        /* WordPress/Elementor form input override - exclude radio and checkbox */
        .form-group input:not([type="radio"]):not([type="checkbox"]),
        .form-group select,
        .form-group textarea {
            font-family: inherit !important;
            font-size: var(--font-size-sm) !important;
            border: 2px solid var(--color-border) !important;
            border-radius: var(--border-radius-sm) !important;
            padding: var(--spacing-sm) var(--spacing-md) !important;
            transition: all var(--transition-base) !important;
            width: 100% !important;
            background-color: var(--color-white) !important;
            box-shadow: none !important;
            outline: none !important;
            -webkit-appearance: none !important;
            -moz-appearance: none !important;
            appearance: none !important;
        }

        /* Radio and checkbox specific styling to preserve functionality */
        .form-group input[type="radio"],
        .form-group input[type="checkbox"] {
            width: auto !important;
            margin-right: var(--spacing-sm) !important;
            /* Don't remove appearance for radio/checkbox - they need it to function */
            -webkit-appearance: auto !important;
            -moz-appearance: auto !important;
            appearance: auto !important;
        }

        /* Focus states override - exclude radio and checkbox */
        .form-group input:not([type="radio"]):not([type="checkbox"]):focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--color-primary-blue) !important;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1) !important;
            background-color: var(--color-white) !important;
        }

        /* Select dropdown arrow override */
        .form-group select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e") !important;
            background-position: right var(--spacing-sm) center !important;
            background-repeat: no-repeat !important;
            background-size: 1.5em 1.5em !important;
            padding-right: calc(var(--spacing-md) + 1.5em) !important;
        }

        /* Error states override - exclude radio and checkbox */
        .form-group.error input:not([type="radio"]):not([type="checkbox"]),
        .form-group.error select,
        .form-group.error textarea {
            border-color: var(--color-coral) !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
        }

        /* WordPress specific resets - exclude radio and checkbox */
        .elementor-field-group input:not([type="radio"]):not([type="checkbox"]),
        .elementor-field-group select,
        .elementor-field-group textarea,
        .wp-block-group input:not([type="radio"]):not([type="checkbox"]),
        .wp-block-group select,
        .wp-block-group textarea {
            font-family: inherit !important;
            font-size: var(--font-size-sm) !important;
            border: 2px solid var(--color-border) !important;
            border-radius: var(--border-radius-sm) !important;
            padding: var(--spacing-sm) var(--spacing-md) !important;
            background-color: var(--color-white) !important;
            box-shadow: none !important;
        }

        /* Full-page loading overlay for form submission */
        .form-loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            cursor: not-allowed;
        }

        .form-loading-overlay.active {
            display: flex;
        }

        .loading-content {
            text-align: center;
            padding: var(--spacing-xl);
            background: var(--color-white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-xl);
            max-width: 300px;
            width: 90%;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            margin: 0 auto var(--spacing-lg);
            border: 4px solid var(--color-border);
            border-top: 4px solid var(--color-primary-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-navy);
            margin-bottom: var(--spacing-sm);
        }

        .loading-subtext {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-bottom: 0;
        }

        .success-message .icon {
            font-size: var(--font-size-3xl);
            margin-bottom: var(--spacing-md);
        }

        .success-message h2 {
            font-size: var(--font-size-3xl);
            font-weight: var(--font-weight-bold);
            line-height: var(--line-height-tight);
            color: var(--color-navy);
            margin-bottom: var(--spacing-sm);
        }

        .success-message p {
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-normal);
            line-height: var(--line-height-relaxed);
            color: var(--color-text-secondary);
            margin-bottom: var(--spacing-lg);
        }

        /* ===== Floating CTA Button ===== */
        .floating-cta {
            position: fixed;
            bottom: var(--spacing-lg);
            right: var(--spacing-lg);
            z-index: 999;
            opacity: 0;
            transform: translateY(100px);
            transition: all var(--transition-base);
        }

        .floating-cta.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .floating-cta .btn {
            box-shadow: var(--shadow-xl);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        /* ===== Footer ===== */
        .footer {
            background: var(--color-navy);
            color: var(--color-white);
            padding: var(--spacing-2xl) 0 var(--spacing-md);
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
        }

        .footer-section h4 {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            line-height: var(--line-height-normal);
            margin-bottom: var(--spacing-md);
        }

        .footer-section p,
        .footer-section a {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: var(--spacing-xs);
            display: block;
        }

        .footer-section a:hover {
            color: var(--color-primary-orange);
        }

        /* Enhanced contact information styling */
        .contact-info {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .organization-name {
            font-weight: 700 !important;
            color: rgba(255, 255, 255, 0.95) !important;
            margin-bottom: var(--spacing-md) !important;
            font-size: var(--font-size-base) !important;
        }

        .contact-item {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-xs);
            line-height: 1.6;
        }

        .contact-item .material-icons {
            color: var(--color-primary-orange);
            margin-top: 2px;
            flex-shrink: 0;
        }

        .contact-item a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: all var(--transition-base);
            margin: 0;
            display: inline;
        }

        .contact-item a:hover {
            color: var(--color-primary-orange);
            text-decoration: underline;
        }

        .contact-item span:not(.material-icons) {
            color: rgba(255, 255, 255, 0.8);
            font-size: var(--font-size-sm);
            line-height: 1.6;
        }

        /* Mobile responsive contact info */
        @media (max-width: 768px) {
            .contact-item {
                gap: var(--spacing-xs);
                margin-bottom: var(--spacing-sm);
            }

            .contact-item .material-icons {
                font-size: 18px;
            }

            .organization-name {
                font-size: var(--font-size-sm) !important;
                margin-bottom: var(--spacing-sm) !important;
            }

            .contact-item span:not(.material-icons),
            .contact-item a {
                font-size: var(--font-size-xs);
            }
        }

        /* Compact footer styling */
        .footer {
            padding: var(--spacing-xl) 0 var(--spacing-md);
        }

        /* Logo in contact section */
        .contact-logo {
            text-align: center;
            margin-bottom: var(--spacing-md);
        }

        .footer-logo-img {
            width: 100px;
            height: auto;
            opacity: 0.95;
            transition: all var(--transition-base);
        }

        .footer-logo-img:hover {
            opacity: 1;
            transform: scale(1.05);
        }

        /* Compact contact info styling */
        .contact-info-compact {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }

        .contact-info-compact .contact-item {
            margin-bottom: 0;
        }

        .contact-info-compact .organization-name {
            margin-bottom: var(--spacing-sm) !important;
        }

        /* Government compliance section - minimal and discreet */
        .footer-compliance {
            text-align: center;
            padding: var(--spacing-xs) 0;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            margin-top: var(--spacing-sm);
        }

        .compliance-info {
            color: rgba(255, 255, 255, 0.4);
            font-size: var(--font-size-xs);
            margin: 0;
            line-height: 1.4;
            font-weight: 300;
            opacity: 0.8;
        }

        /* Mobile responsive footer adjustments */
        @media (max-width: 768px) {
            .footer {
                padding: var(--spacing-lg) 0 var(--spacing-sm);
            }

            .footer-logo-img {
                width: 80px;
            }

            .contact-logo {
                margin-bottom: var(--spacing-sm);
            }

            .footer-content {
                grid-template-columns: 1fr !important;
                gap: var(--spacing-md);
                margin-bottom: var(--spacing-sm);
            }

            .compliance-info {
                font-size: 9px;
                line-height: 1.6;
                padding: 0 var(--spacing-md);
                opacity: 0.7;
            }

            .contact-item span:not(.material-icons),
            .contact-item a {
                font-size: var(--font-size-xs);
            }

            .footer-compliance {
                margin-top: var(--spacing-xs);
                padding: var(--spacing-xs) 0;
                border-top: 1px solid rgba(255, 255, 255, 0.03);
            }
        }

        /* ===== Responsive Design ===== */
        @media (max-width: 1024px) {
            :root {
                --font-size-3xl: 2rem;
                --font-size-2xl: 1.75rem;
                --font-size-xl: 1.375rem;
                --spacing-3xl: 4rem;
                --spacing-2xl: 3rem;
            }
        }

        @media (max-width: 768px) {
            .nav-links {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: var(--color-white);
                flex-direction: column;
                padding: var(--spacing-md);
                box-shadow: var(--shadow-lg);
                border: 1px solid var(--color-border);
                border-radius: 0 0 var(--border-radius-md) var(--border-radius-md);
                z-index: 1000;
                margin: 0;
                gap: var(--spacing-sm);
            }

            .nav-links.active {
                display: flex;
            }

            .nav-links li {
                width: 100%;
            }

            .nav-links a {
                display: block;
                width: 100%;
                padding: var(--spacing-sm) var(--spacing-md);
                text-align: center;
                border-radius: var(--border-radius-sm);
                transition: all var(--transition-base);
            }

            .nav-links a:hover {
                background: rgba(59, 130, 246, 0.1);
                transform: none;
            }

            .mobile-menu-toggle {
                display: flex;
            }

            .hero-content {
                grid-template-columns: 1fr;
            }

            .hero-text {
                order: 2;
            }

            .hero-image {
                order: 1;
            }

            .hero-ctas {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .stats-container {
                grid-template-columns: 1fr;
            }

            .pillars-flow {
                gap: var(--spacing-xs);
            }

            .pillars-flow-icon {
                width: 50px;
                height: 50px;
                font-size: var(--font-size-xl);
            }

            .pillars-flow-label {
                font-size: var(--font-size-xs);
            }

            .pillars-flow-sublabel {
                display: none;
            }

            .pillars-flow-arrow {
                font-size: var(--font-size-base);
                margin: 0;
            }

            .pillars-depth-bar {
                padding: var(--spacing-xs) var(--spacing-md);
                font-size: var(--font-size-xs);
            }

            .pillars-grid {
                grid-template-columns: 1fr;
            }

            /* pillar-detail mobile styles moved to modal section */

            .activities-grid {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .form-progress {
                padding: var(--spacing-xs);
                margin-bottom: var(--spacing-md);
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }

            .form-progress::-webkit-scrollbar {
                display: none;
            }

            .progress-step {
                flex-shrink: 0;
                min-width: 80px;
                padding: var(--spacing-xs);
            }

            .progress-step:not(:last-child)::after {
                display: none;
            }

            .progress-step-circle {
                width: 20px;
                height: 20px;
                font-size: var(--font-size-xs);
                border-width: 1px;
            }

            .progress-step-label {
                font-size: var(--font-size-xs);
                font-weight: var(--font-weight-normal);
            }

            .registration-hero-image {
                margin: var(--spacing-lg) 0;
                border-radius: var(--border-radius-md);
            }

            .floating-cta {
                bottom: var(--spacing-md);
                right: var(--spacing-md);
                left: var(--spacing-md);
            }

            .floating-cta .btn {
                width: 100%;
                justify-content: center;
            }

            .contact-info-card {
                margin: var(--spacing-lg) 0 0;
                padding: var(--spacing-lg);
            }

            .contact-info-card h3 {
                font-size: var(--font-size-xl);
            }

            .contact-info-card p {
                font-size: var(--font-size-sm);
            }

            .contact-email-link {
                font-size: var(--font-size-sm);
                padding: var(--spacing-sm) var(--spacing-lg);
            }
        }

        @media (max-width: 480px) {
            :root {
                --font-size-3xl: 1.75rem;
                --font-size-2xl: 1.5rem;
                --font-size-xl: 1.25rem;
                --spacing-3xl: 2.5rem;
                --spacing-2xl: 2rem;
                --spacing-xl: 1.5rem;
            }

            .section {
                padding: var(--spacing-2xl) 0;
            }

            .form-container {
                padding: var(--spacing-md);
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav" id="nav">
        <div class="container nav-container">
            <div class="nav-logo">
                均一 x Hour of <span>AI</span>
            </div>
            <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle menu">
                <span class="hamburger"></span>
            </button>
            <ul class="nav-links" id="navLinks">
                <li><a href="#about">關於活動</a></li>
                <li><a href="#pillars">AI 素養</a></li>
                <li><a href="#activities">活動內容</a></li>
                <li><a href="#register" class="nav-cta">舉辦活動</a></li>
            </ul>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <div class="hero-content">
                <div class="hero-text fade-in">
                    <h1>
                        <span class="highlight">AI 素養起步走</span><br>
                        擁抱 AI,讓學習力再進化
                    </h1>
                    <p>
                        均一平台教育基金會提供免費 AI 教育資源與平台，邀請您成為台灣 AI 素養教育推手！在您的機構舉辦 Hour of AI，我們提供完整教材支援。
                    </p>
                    <div class="hero-ctas">
                        <a href="#register" class="btn btn-primary">
                            <span class="material-icons small">campaign</span>
                            我要舉辦活動
                        </a>
                        <a href="#activities" class="btn btn-secondary">
                            <span class="material-icons small">info</span>
                            了解活動內容
                        </a>
                    </div>
                </div>
                <div class="hero-image fade-in">
                    <img src="https://storage.googleapis.com/wpassets.junyiacademy.org/1/2025/11/均一首頁最新消息Hour-of-AI＿25Q3＿V1.jpg"
                         alt="均一 x Hour of AI - AI 素養教育活動">
                </div>
            </div>
        </div>
    </section>

    <!-- Stats Bar -->
    <section class="stats-bar">
        <div class="container">
            <div class="stats-container">
                <div class="stat-item fade-in">
                    <h2>AI 不是特權</h2>
                    <p>是每位孩子的學習權利</p>
                </div>
                <div class="stat-item fade-in">
                    <h2>培養自學與思考力</h2>
                    <p>孩子可以和 AI 共學</p>
                </div>
                <div class="stat-item fade-in">
                    <h2>學會善用 AI</h2>
                    <p>而不是被 AI 取代</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Live Statistics Dashboard -->
    <section class="live-stats-section" id="live-stats">
        <div class="container">
            <!-- Upcoming Events Carousel Section -->
            <div class="upcoming-events-section" id="upcoming-events">
                <div class="upcoming-events-header">
                    <h2 class="section-title fade-in">
                        <span class="material-icons medium" style="color: var(--color-primary-orange);">campaign</span>
                        近期推廣活動
                    </h2>
                    <p class="section-subtitle fade-in">
                        探索我們主辦的精彩活動，一起參與 AI 素養教育推廣
                    </p>
                </div>
                <div class="events-carousel-wrapper">
                    <button class="carousel-nav prev" id="carouselPrev" aria-label="上一個">
                        <span class="material-icons">chevron_left</span>
                    </button>
                    <div class="events-carousel" id="eventsCarousel">
                        <!-- Event cards will be rendered by JavaScript -->
                    </div>
                    <button class="carousel-nav next" id="carouselNext" aria-label="下一個">
                        <span class="material-icons">chevron_right</span>
                    </button>
                </div>
                <div class="carousel-dots" id="carouselDots">
                    <!-- Dots will be rendered by JavaScript -->
                </div>
            </div>

            <!-- Taiwan Global Ranking Section -->
            <div class="taiwan-global-rank-section fade-in" id="globalRankSection">
                <div class="stats-header-wrapper">
                    <div class="stats-header-content">
                        <h2 class="section-title">
                            <span class="material-icons medium" style="color: var(--color-primary-teal);">public</span>
                            台灣全球排名
                        </h2>
                    </div>
                </div>

                <!-- Main Rank Display: 2 columns -->
                <div class="global-rank-main">
                    <!-- Left: Global Rank Number + TOP% -->
                    <div class="global-rank-highlight">
                        <div class="rank-badge">
                            <span class="material-icons" style="color: var(--color-primary-orange);">workspace_premium</span>
                        </div>
                        <div class="rank-number-large" id="globalRankNumber">--</div>
                        <div class="rank-context">
                            <span class="material-icons tiny">language</span>
                            <span id="globalRankTotal">--</span> 個國家中
                        </div>
                        <div class="rank-percentile-large">
                            <span class="material-icons small">trending_up</span>
                            Top <span id="globalPercentile">--</span>%
                        </div>
                    </div>

                    <!-- Right: Nearby Countries Ranking -->
                    <div class="nearby-rank-panel">
                        <h3 class="nearby-rank-title">
                            <span class="material-icons small" style="color: var(--color-navy);">leaderboard</span>
                            鄰近排名
                        </h3>
                        <div class="nearby-countries-list" id="nearbyCountriesList">
                            <!-- Dynamically populated -->
                        </div>
                    </div>
                </div>

                <!-- Auxiliary Info: Local vs Global (降級為說明文字) -->
                <div class="rank-auxiliary-info">
                    <span class="material-icons tiny">info_outline</span>
                    <div class="auxiliary-content">
                        <div class="auxiliary-stats">
                            <span>本地統計：<strong id="localEventCount">--</strong> 場</span>
                            <span class="separator">|</span>
                            <span>全球統計：<strong id="globalEventCount">--</strong> 場</span>
                        </div>
                        <p class="auxiliary-note">
                            本地統計來自均一平台台灣報名表單；全球統計來自 <a href="https://csforall.org/zh-Hant/hour-of-ai/how-to/global" target="_blank" rel="noopener noreferrer" class="auxiliary-link">CSforAll 全球報名系統</a>。兩系統獨立運作，資料差異為正常現象。
                        </p>
                    </div>
                </div>
            </div>

            <div class="stats-header-wrapper">
                <div class="stats-header-content">
                    <h2 class="section-title fade-in">
                        <span class="material-icons medium" style="color: var(--color-primary-teal);">trending_up</span>
                        台灣活動舉辦狀況
                        <span id="demoIndicator" class="demo-badge" style="display: none;">
                            <span class="material-icons tiny">science</span>
                            展示資料
                        </span>
                    </h2>
                </div>
                <p class="section-subtitle fade-in">
                    全台教育單位正在熱烈響應！一起成為 AI 素養教育推手
                </p>
            </div>

            <div class="stats-dashboard" id="statsDashboard">
                <!-- Left Column: Counters & Map -->
                <div class="stats-left">
                    <!-- Counters -->
                    <div class="stats-counters">
                        <div class="counter-card fade-in">
                            <div class="counter-icon">
                                <span class="material-icons large" style="color: var(--color-primary-orange);">event</span>
                            </div>
                            <div class="counter-number" id="totalEvents">0</div>
                            <div class="counter-label">規劃場次</div>
                        </div>
                        <div class="counter-card fade-in">
                            <div class="counter-icon">
                                <span class="material-icons large" style="color: var(--color-primary-blue);">groups</span>
                            </div>
                            <div class="counter-number" id="totalParticipants">0</div>
                            <div class="counter-label">預估參與人數</div>
                        </div>
                        <div class="counter-card fade-in">
                            <div class="counter-icon">
                                <span class="material-icons large" style="color: var(--color-primary-teal);">location_on</span>
                            </div>
                            <div class="counter-number" id="totalCounties">0</div>
                            <div class="counter-label">參與縣市</div>
                        </div>
                    </div>

                    <!-- Taiwan Map -->
                    <div class="taiwan-map-container fade-in">
                        <h3>
                            <span class="material-icons medium" style="color: var(--color-navy);">map</span>
                            台灣活動分布圖
                        </h3>
                        <div id="taiwanMap" class="taiwan-map"></div>
                    </div>
                </div>

                <!-- Right Column: Rankings & Activity Feed -->
                <div class="stats-right">
                    <!-- Top Counties Ranking -->
                    <div class="ranking-card fade-in">
                        <h3>
                            <span class="material-icons medium" style="color: var(--color-yellow);">emoji_events</span>
                            縣市排行榜
                        </h3>
                        <div class="ranking-list" id="rankingList">
                            <!-- Will be populated by JavaScript -->
                            <div class="ranking-item">
                                <div class="ranking-position top-1">1</div>
                                <div class="ranking-info">
                                    <div class="ranking-name">台北市</div>
                                    <div class="ranking-bar">
                                        <div class="ranking-bar-fill" style="width: 0%"></div>
                                    </div>
                                </div>
                                <div class="ranking-count">0 場</div>
                            </div>
                        </div>
                    </div>

                    <!-- Latest Activity Feed -->
                    <div class="activity-feed-card fade-in">
                        <h3>
                            <span class="material-icons medium" style="color: var(--color-primary-blue);">campaign</span>
                            最新活動規劃
                        </h3>
                        <div class="activity-feed" id="activityFeed">
                            <!-- Will be populated by JavaScript -->
                            <div class="activity-item">
                                <div class="activity-icon">
                                    <span class="material-icons medium" style="color: var(--color-white);">auto_awesome</span>
                                </div>
                                <div class="activity-content">
                                    <div class="activity-text">載入中...</div>
                                    <div class="activity-time">即時更新</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Demo Mode Notice (only shown in demo mode) -->
            <div id="demoNotice" class="demo-notice" style="display: none;">
                <div class="demo-notice-content">
                    <span class="material-icons small">info</span>
                    <span>以上為展示資料，僅供介面預覽參考</span>
                </div>
            </div>

            <!-- Stats Update Controls -->
            <div class="stats-controls-wrapper">
                <div class="stats-controls">
                    <div class="stats-meta">
                        <span id="statsCacheIndicator" class="stats-update-time">載入中...</span>
                        <button id="statsRefreshBtn" class="stats-refresh-btn" onclick="refreshStatistics()" title="重新整理統計資料" aria-label="重新整理統計資料">
                            <span class="material-icons">refresh</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section class="section" id="about">
        <div class="container">
            <h2 class="section-title fade-in">什麼是 Hour of AI?</h2>
            <p class="section-subtitle fade-in">
                Hour of AI，活動靈感來自全球最大公益學習運動 Hour of Code，由國際教育平台 Code.org 發起的年度活動，由全球教育社群推動，在每年指定時段，透過免費開放的教材與工具，讓學生、教師與社區成員在 60 分鐘內或延伸課程中學習 AI 素養，以推廣 AI 教育成為全民基礎能力。主要場域為教室與社區，目標讓每位孩子都能用一小時親身體驗 AI、理解 AI、善用 AI。
            </p>
        </div>
    </section>

    <!-- AI Pillars Section -->
    <section class="section" id="pillars" style="background: var(--color-bg-light);">
        <div class="container">
            <h2 class="section-title fade-in">AI 素養四大支柱</h2>
            <p class="pillars-intro fade-in">
                AI 素養不是一次到位，而是一段由淺入深的學習歷程
            </p>

            <!-- Pillar Cards -->
            <div class="pillars-grid">
                <div class="pillar-card fade-in" data-pillar="ask" onclick="togglePillarDetail('ask')">
                    <div class="pillar-icon">問 AI</div>
                    <div class="pillar-english">Engage</div>
                    <div class="pillar-subtitle">精準提問與人機協作</div>
                    <p class="pillar-brief">學會跟 AI 對話，而不是丟一句話給它</p>
                    <button class="pillar-details-button">
                        <span class="material-icons">visibility</span>
                        <span>查看詳細</span>
                    </button>
                </div>
                <div class="pillar-card fade-in" data-pillar="use" onclick="togglePillarDetail('use')">
                    <div class="pillar-icon">用 AI</div>
                    <div class="pillar-english">Create</div>
                    <div class="pillar-subtitle">工具掌握與效率提升</div>
                    <p class="pillar-brief">把 AI 放進流程，而不是多開一個工具</p>
                    <button class="pillar-details-button">
                        <span class="material-icons">visibility</span>
                        <span>查看詳細</span>
                    </button>
                </div>
                <div class="pillar-card fade-in" data-pillar="manage" onclick="togglePillarDetail('manage')">
                    <div class="pillar-icon">管 AI</div>
                    <div class="pillar-english">Manage</div>
                    <div class="pillar-subtitle">批判思考與倫理素養</div>
                    <p class="pillar-brief">確保「人仍然在駕駛座上」</p>
                    <button class="pillar-details-button">
                        <span class="material-icons">visibility</span>
                        <span>查看詳細</span>
                    </button>
                </div>
                <div class="pillar-card fade-in" data-pillar="build" onclick="togglePillarDetail('build')">
                    <div class="pillar-icon">造 AI</div>
                    <div class="pillar-english">Design</div>
                    <div class="pillar-subtitle">原理理解與創新應用</div>
                    <p class="pillar-brief">從使用者，走向能創造價值的人</p>
                    <button class="pillar-details-button">
                        <span class="material-icons">visibility</span>
                        <span>查看詳細</span>
                    </button>
                </div>
            </div>

            <!-- Expandable Detail Panels -->
            <div class="pillar-detail" id="pillar-detail-ask" data-pillar="ask">
                <div class="pillar-detail-header">
                    <div class="pillar-detail-icon">問</div>
                    <div class="pillar-detail-title-group">
                        <div class="pillar-detail-english">Engaging with AI</div>
                        <h3 class="pillar-detail-title">問 AI</h3>
                        <div class="pillar-detail-subtitle">精準提問與人機協作</div>
                    </div>
                </div>
                <div class="pillar-detail-headline">學會跟 AI 對話，而不是丟一句話給它</div>

                <!-- Progression Tabs -->
                <div class="pillar-tabs">
                    <div class="pillar-tabs-nav">
                        <button class="pillar-tab-btn active" data-tab="basic">基礎</button>
                        <button class="pillar-tab-btn" data-tab="proficient">精熟</button>
                        <button class="pillar-tab-btn" data-tab="advanced">進階</button>
                    </div>
                    <div class="pillar-tabs-content">
                        <div class="pillar-tab-panel active" data-tab="basic">
                            <div class="pillar-level-header">
                                <span class="pillar-level-icon">🎯</span>
                                <div class="pillar-level-title">
                                    <strong>精準提問</strong>
                                    <span class="pillar-level-english">Precision</span>
                                </div>
                            </div>
                            <p class="pillar-level-desc">能清楚描述人、事、時、地、物與目標。不再問模糊問題。</p>
                            <div class="pillar-level-example">
                                <span class="example-label">關鍵能力</span>
                                <span>將模糊需求轉成明確指令</span>
                            </div>
                        </div>
                        <div class="pillar-tab-panel" data-tab="proficient">
                            <div class="pillar-level-header">
                                <span class="pillar-level-icon">🔄</span>
                                <div class="pillar-level-title">
                                    <strong>迭代追問</strong>
                                    <span class="pillar-level-english">Iteration</span>
                                </div>
                            </div>
                            <p class="pillar-level-desc">透過連續對話、反問與收斂，引導 AI 修正方向。像蘇格拉底式的對話。</p>
                            <div class="pillar-level-example">
                                <span class="example-label">關鍵能力</span>
                                <span>追問、修正、深化對話品質</span>
                            </div>
                        </div>
                        <div class="pillar-tab-panel" data-tab="advanced">
                            <div class="pillar-level-header">
                                <span class="pillar-level-icon">🧠</span>
                                <div class="pillar-level-title">
                                    <strong>框架思維</strong>
                                    <span class="pillar-level-english">Framework</span>
                                </div>
                            </div>
                            <p class="pillar-level-desc">要求 AI 提供解決問題的思維模型與系統性分析。問的不是答案，是方法論。</p>
                            <div class="pillar-level-example">
                                <span class="example-label">關鍵能力</span>
                                <span>用 AI 做資訊輔助與結構化思考</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="pillar-detail-insight">
                    <span class="insight-icon">💡</span>
                    <p>「問」是一種思考訓練：你知不知道自己真正要什麼？</p>
                </div>
            </div>

            <div class="pillar-detail" id="pillar-detail-use" data-pillar="use">
                <div class="pillar-detail-header">
                    <div class="pillar-detail-icon">用</div>
                    <div class="pillar-detail-title-group">
                        <div class="pillar-detail-english">Creating with AI</div>
                        <h3 class="pillar-detail-title">用 AI</h3>
                        <div class="pillar-detail-subtitle">工具掌握與效率提升</div>
                    </div>
                </div>
                <div class="pillar-detail-headline">把 AI 放進流程，而不是多開一個工具</div>

                <!-- Progression Tabs -->
                <div class="pillar-tabs">
                    <div class="pillar-tabs-nav">
                        <button class="pillar-tab-btn active" data-tab="basic">基礎</button>
                        <button class="pillar-tab-btn" data-tab="proficient">精熟</button>
                        <button class="pillar-tab-btn" data-tab="advanced">進階</button>
                    </div>
                    <div class="pillar-tabs-content">
                        <div class="pillar-tab-panel active" data-tab="basic">
                            <div class="pillar-level-header">
                                <span class="pillar-level-icon">✏️</span>
                                <div class="pillar-level-title">
                                    <strong>生活單點</strong>
                                    <span class="pillar-level-english">Task</span>
                                </div>
                            </div>
                            <p class="pillar-level-desc">解決單一需求。例如：規劃旅遊、寫信、摘要文章。</p>
                            <div class="pillar-level-example">
                                <span class="example-label">關鍵能力</span>
                                <span>理解不同 AI 工具的強項</span>
                            </div>
                        </div>
                        <div class="pillar-tab-panel" data-tab="proficient">
                            <div class="pillar-level-header">
                                <span class="pillar-level-icon">🔗</span>
                                <div class="pillar-level-title">
                                    <strong>專業串聯</strong>
                                    <span class="pillar-level-english">Workflow</span>
                                </div>
                            </div>
                            <p class="pillar-level-desc">建立自動化工作流，串接產出。例如：行銷文案→自動製圖→排程發布。</p>
                            <div class="pillar-level-example">
                                <span class="example-label">關鍵能力</span>
                                <span>組合多個工具提升效率</span>
                            </div>
                        </div>
                        <div class="pillar-tab-panel" data-tab="advanced">
                            <div class="pillar-level-header">
                                <span class="pillar-level-icon">🤖</span>
                                <div class="pillar-level-title">
                                    <strong>自主代理</strong>
                                    <span class="pillar-level-english">Agents</span>
                                </div>
                            </div>
                            <p class="pillar-level-desc">指揮 AI 跨域調用工具去「執行」任務。例如：給模糊目標，讓 Agent 自行比價下單。</p>
                            <div class="pillar-level-example">
                                <span class="example-label">關鍵能力</span>
                                <span>設計 AI 代理執行複雜任務</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="pillar-detail-insight">
                    <span class="insight-icon">💡</span>
                    <p>關鍵判準：用完之後，學習有沒有變好？</p>
                </div>
            </div>

            <div class="pillar-detail" id="pillar-detail-manage" data-pillar="manage">
                <div class="pillar-detail-header">
                    <div class="pillar-detail-icon">管</div>
                    <div class="pillar-detail-title-group">
                        <div class="pillar-detail-english">Managing with AI</div>
                        <h3 class="pillar-detail-title">管 AI</h3>
                        <div class="pillar-detail-subtitle">批判思考與倫理素養</div>
                    </div>
                </div>
                <div class="pillar-detail-headline">確保「人仍然在駕駛座上」</div>

                <!-- Progression Tabs -->
                <div class="pillar-tabs">
                    <div class="pillar-tabs-nav">
                        <button class="pillar-tab-btn active" data-tab="basic">基礎</button>
                        <button class="pillar-tab-btn" data-tab="proficient">精熟</button>
                        <button class="pillar-tab-btn" data-tab="advanced">進階</button>
                    </div>
                    <div class="pillar-tabs-content">
                        <div class="pillar-tab-panel active" data-tab="basic">
                            <div class="pillar-level-header">
                                <span class="pillar-level-icon">👁️</span>
                                <div class="pillar-level-title">
                                    <strong>管好一 AI</strong>
                                    <span class="pillar-level-english">Supervision</span>
                                </div>
                            </div>
                            <p class="pillar-level-desc">具備識讀能力，能查核事實，避免單一 AI 幻覺。（指導員層級）</p>
                            <div class="pillar-level-example">
                                <span class="example-label">關鍵能力</span>
                                <span>不盲信 AI 產出，能驗證資訊</span>
                            </div>
                        </div>
                        <div class="pillar-tab-panel" data-tab="proficient">
                            <div class="pillar-level-header">
                                <span class="pillar-level-icon">🎛️</span>
                                <div class="pillar-level-title">
                                    <strong>管好群 AI</strong>
                                    <span class="pillar-level-english">Orchestration</span>
                                </div>
                            </div>
                            <p class="pillar-level-desc">同時調度多個不同功能的 Agents 協作。（調度員層級）</p>
                            <div class="pillar-level-example">
                                <span class="example-label">關鍵能力</span>
                                <span>協調多個 AI 系統的輸出</span>
                            </div>
                        </div>
                        <div class="pillar-tab-panel" data-tab="advanced">
                            <div class="pillar-level-header">
                                <span class="pillar-level-icon">👔</span>
                                <div class="pillar-level-title">
                                    <strong>管好人機協作</strong>
                                    <span class="pillar-level-english">Leadership</span>
                                </div>
                            </div>
                            <p class="pillar-level-desc">領導「人+AI」混合團隊，劃分權責與倫理邊界。（指揮官層級）</p>
                            <div class="pillar-level-example">
                                <span class="example-label">關鍵能力</span>
                                <span>定義人與 AI 的責任邊界</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="pillar-detail-insight">
                    <span class="insight-icon">💡</span>
                    <p>定義責任：哪些判斷絕不能外包？哪些後果必須由人承擔？</p>
                </div>
            </div>

            <div class="pillar-detail" id="pillar-detail-build" data-pillar="build">
                <div class="pillar-detail-header">
                    <div class="pillar-detail-icon">造</div>
                    <div class="pillar-detail-title-group">
                        <div class="pillar-detail-english">Designing with AI</div>
                        <h3 class="pillar-detail-title">造 AI</h3>
                        <div class="pillar-detail-subtitle">原理理解與創新應用</div>
                    </div>
                </div>
                <div class="pillar-detail-headline">從使用者，走向能創造價值的人</div>

                <!-- Progression Tabs -->
                <div class="pillar-tabs">
                    <div class="pillar-tabs-nav">
                        <button class="pillar-tab-btn active" data-tab="basic">基礎</button>
                        <button class="pillar-tab-btn" data-tab="proficient">精熟</button>
                        <button class="pillar-tab-btn" data-tab="advanced">進階</button>
                    </div>
                    <div class="pillar-tabs-content">
                        <div class="pillar-tab-panel active" data-tab="basic">
                            <div class="pillar-level-header">
                                <span class="pillar-level-icon">📦</span>
                                <div class="pillar-level-title">
                                    <strong>封裝經驗</strong>
                                    <span class="pillar-level-english">Prompting</span>
                                </div>
                            </div>
                            <p class="pillar-level-desc">將個人成功的指令存成模板 (Template)。（造工具）</p>
                            <div class="pillar-level-example">
                                <span class="example-label">關鍵能力</span>
                                <span>理解 AI 的基本原理</span>
                            </div>
                        </div>
                        <div class="pillar-tab-panel" data-tab="proficient">
                            <div class="pillar-level-header">
                                <span class="pillar-level-icon">🧩</span>
                                <div class="pillar-level-title">
                                    <strong>連結知識</strong>
                                    <span class="pillar-level-english">RAG</span>
                                </div>
                            </div>
                            <p class="pillar-level-desc">餵養特定資料，造出懂團隊語言的知識庫。（造大腦）</p>
                            <div class="pillar-level-example">
                                <span class="example-label">關鍵能力</span>
                                <span>組合工具與流程設計</span>
                            </div>
                        </div>
                        <div class="pillar-tab-panel" data-tab="advanced">
                            <div class="pillar-level-header">
                                <span class="pillar-level-icon">🏗️</span>
                                <div class="pillar-level-title">
                                    <strong>深入場景</strong>
                                    <span class="pillar-level-english">Product</span>
                                </div>
                            </div>
                            <p class="pillar-level-desc">針對具體痛點，開發出可重複使用的服務/產品。（造護城河）</p>
                            <div class="pillar-level-example">
                                <span class="example-label">關鍵能力</span>
                                <span>用 AI 解決真實問題</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="pillar-detail-insight">
                    <span class="insight-icon">💡</span>
                    <p>培養主體性：知道 AI 為何這樣判斷，並決定用它解決什麼問題。</p>
                </div>
            </div>

            <!-- Footer Message -->
            <div class="pillars-footer fade-in">
                <p>
                    <strong>這不是四個要一次教完的能力，而是一條可以慢慢累積的學習進程。</strong><br>
                    這不只是學生的學習目標，也是未來所有人的基本能力。
                </p>
            </div>
        </div>
    </section>

    <!-- Activities Section -->
    <section class="section" id="activities">
        <div class="container">
            <h2 class="section-title fade-in">精選活動內容</h2>

            <!-- Official Selection Badge -->
            <div class="official-selection-badge fade-in">
                <span class="material-icons medium" style="color: var(--color-yellow);">star</span>
                <p>
                    <strong>均一榮幸獲選 Hour of AI 官方合作學習資源！</strong><br>
                    兩大 AI 活動已正式上架 Hour of AI 全球目錄
                </p>
                <span class="material-icons medium" style="color: var(--color-yellow);">star</span>
            </div>

            <p class="section-subtitle fade-in">
                我們精心設計兩個活動,適合不同年齡層的學習者
            </p>
            <!-- Activity Cards Layout -->
            <div class="activity-cards-container">
                <!-- Activity Card 1 - Active AI (主推) -->
                <div class="activity-card fade-in" data-activity="data-world">
                    <div class="activity-card-content">
                        <div class="activity-icon">
                            <span class="material-icons large">analytics</span>
                        </div>
                        <h3 class="activity-card-title">數據世界：AI 原來如此</h3>
                        <div class="activity-meta">
                            <div class="activity-info">
                                <span class="material-icons small">school</span>
                                <span>國小高年級以上學生</span>
                            </div>
                            <div class="activity-provider">
                                <span class="material-icons small">business</span>
                                <span>Active AI</span>
                            </div>
                        </div>
                        <button class="activity-details-button">
                            <span class="material-icons small">visibility</span>
                            <span>查看詳細</span>
                        </button>
                    </div>
                    <div class="activity-card-image">
                        <img src="https://storage.googleapis.com/wpassets.junyiacademy.org/1/2025/11/Hour-of-AI＿V1_活動連結圖片-Active-AI.jpg" alt="Active AI 數據世界">
                        <div class="image-overlay">
                            <div class="overlay-content">
                                <h5>活動亮點</h5>
                                <ul>
                                    <li>認識 AI 如何處理數據</li>
                                    <li>輕鬆理解 AI 運作原理</li>
                                    <li>動手實作 AI 應用</li>
                                    <li>完成後可獲得學習證書</li>
                                </ul>
                                <div class="overlay-actions">
                                    <a href="https://link.junyiacademy.org/8c2slp" class="overlay-cta">
                                        <span>開始學習</span>
                                        <span class="material-icons">arrow_forward</span>
                                    </a>
                                    <button class="overlay-close">
                                        <span class="material-icons small">close</span>
                                        <span>關閉</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Activity Card 2 -->
                <div class="activity-card fade-in" data-activity="semiconductor">
                    <div class="activity-card-content">
                        <div class="activity-icon">
                            <span class="material-icons large">memory</span>
                        </div>
                        <h3 class="activity-card-title">我的半導體冒險</h3>
                        <div class="activity-meta">
                            <div class="activity-info">
                                <span class="material-icons small">group</span>
                                <span>國中以上學生</span>
                            </div>
                            <div class="activity-provider">
                                <span class="material-icons small">business</span>
                                <span>AI Square</span>
                            </div>
                        </div>
                        <button class="activity-details-button">
                            <span class="material-icons small">visibility</span>
                            <span>查看詳細</span>
                        </button>
                    </div>
                    <div class="activity-card-image">
                        <img src="https://storage.googleapis.com/wpassets.junyiacademy.org/1/2025/11/Hour-of-AI＿V1_活動連結圖片-AI-Square.jpg" alt="AI Square 我的半導體冒險">
                        <div class="image-overlay">
                            <div class="overlay-content">
                                <h5>活動亮點</h5>
                                <ul>
                                    <li>探索半導體產業與 AI 的關係</li>
                                    <li>互動式學習體驗</li>
                                    <li>實際案例分析</li>
                                    <li>完成後可獲得學習證書</li>
                                </ul>
                                <div class="overlay-actions">
                                    <a href="https://link.junyiacademy.org/8c2s2q" class="overlay-cta">
                                        <span>開始學習</span>
                                        <span class="material-icons">arrow_forward</span>
                                    </a>
                                    <button class="overlay-close">
                                        <span class="material-icons small">close</span>
                                        <span>關閉</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <!-- Registration Form Section -->
    <section class="registration-section section" id="register">
        <div class="container">
            <h2 class="section-title fade-in">
                <span class="material-icons medium" style="color: var(--color-primary-orange);">event_note</span>
                舉辦 Hour of AI 活動
            </h2>
            <p class="section-subtitle fade-in">
                <strong>成為台灣 AI 教育推手！</strong><br>
                填寫您的活動規劃，我們提供免費教材與平台支援，讓您輕鬆在機構內推動 AI 素養教育
            </p>

            <!-- Registration Hero Image -->
            <div class="registration-hero-image fade-in">
                <img src="https://lh7-rt.googleusercontent.com/formsz/AN7BsVAJFCDCUzLCepHmJzQnV-qrFDsINMh2abP9wpSlV2hy3Sv26Nr-ABZc1PlMKbSq5pl7pplX0VwixIZ9sci39eoVQcH_514burvXQFnas5vYamR0ONIKY1_61xxoQXEL3c8EJWZJNKyu7TRKLIFxjOSoM-5605GWNyrlruL1Oy73kcQQliF-uKqV0KeeH9zGqldI8KBSWG1zzaQR=w1584?key=Vs-9A6ZlpC8-4tjtDIg6PQ"
                     alt="Hour of AI - 台灣官方報名表 | 均一平台教育基金會主辦 - Get Ready to Shift What's Next">
            </div>

            <div class="form-container fade-in">
                <!-- Important Information Banner -->
                <div class="form-info-banner" style="background: linear-gradient(135deg, var(--color-primary-blue), var(--color-primary-teal)); color: white; padding: var(--spacing-xl); border-radius: var(--border-radius-lg); margin-bottom: var(--spacing-xl); box-shadow: var(--shadow-lg);">
                    <h3 style="margin-bottom: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm);">
                        <span class="material-icons medium">info</span>
                        重要說明
                    </h3>
                    <ul style="list-style: none; padding-left: 0;">
                        <li style="margin-bottom: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm);">
                            <span class="material-icons small" style="color: var(--color-yellow);">check_circle</span>
                            <span><strong>您將自主舉辦活動</strong> - 均一提供教材與平台，您在自己的機構進行</span>
                        </li>
                        <li style="margin-bottom: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-sm);">
                            <span class="material-icons small" style="color: var(--color-yellow);">check_circle</span>
                            <span><strong>完全免費資源</strong> - 獲得兩個精選 Hour of AI 課程平台使用權</span>
                        </li>
                        <li style="display: flex; align-items: center; gap: var(--spacing-sm);">
                            <span class="material-icons small" style="color: var(--color-yellow);">check_circle</span>
                            <span><strong>彈性安排</strong> - 活動時間、方式、對象完全由您決定</span>
                        </li>
                    </ul>
                </div>

                <form id="registrationForm" novalidate>
                    <!-- Progress Bar -->
                    <div class="form-progress">
                        <div class="progress-step active" data-step="1">
                            <div class="progress-step-circle" data-step="1"></div>
                            <span class="progress-step-label">主辦人資訊</span>
                        </div>
                        <div class="progress-step" data-step="2">
                            <div class="progress-step-circle" data-step="2"></div>
                            <span class="progress-step-label">機構資料</span>
                        </div>
                        <div class="progress-step" data-step="3">
                            <div class="progress-step-circle" data-step="3"></div>
                            <span class="progress-step-label">活動規劃</span>
                        </div>
                        <div class="progress-step" data-step="4">
                            <div class="progress-step-circle" data-step="4"></div>
                            <span class="progress-step-label">確認提交</span>
                        </div>
                    </div>

                    <!-- Page 1: Contact Information -->
                    <div class="form-page active" data-page="1">
                        <h2>主辦人資訊</h2>
                        <p class="form-page-subtitle">請填寫活動主辦人的基本聯絡資料</p>

                        <div class="form-group">
                            <label class="form-label required">Email</label>
                            <input type="email" name="email" required>
                            <span class="form-error">請輸入有效的 Email 地址</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">聯絡人姓名</label>
                            <input type="text" name="contactName" required>
                            <span class="form-error">此欄位為必填</span>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label required">職稱</label>
                                <input type="text" name="jobTitle" required>
                                <span class="form-error">此欄位為必填</span>
                            </div>

                            <div class="form-group">
                                <label class="form-label required">連絡電話</label>
                                <input type="tel" name="phone" required>
                                <span class="form-error">此欄位為必填</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">縣市</label>
                            <select name="county" required>
                                <option value="">請選擇</option>
                                <option value="台北市">台北市</option>
                                <option value="新北市">新北市</option>
                                <option value="桃園市">桃園市</option>
                                <option value="台中市">台中市</option>
                                <option value="台南市">台南市</option>
                                <option value="高雄市">高雄市</option>
                                <option value="基隆市">基隆市</option>
                                <option value="新竹市">新竹市</option>
                                <option value="嘉義市">嘉義市</option>
                                <option value="新竹縣">新竹縣</option>
                                <option value="苗栗縣">苗栗縣</option>
                                <option value="彰化縣">彰化縣</option>
                                <option value="南投縣">南投縣</option>
                                <option value="雲林縣">雲林縣</option>
                                <option value="嘉義縣">嘉義縣</option>
                                <option value="屏東縣">屏東縣</option>
                                <option value="宜蘭縣">宜蘭縣</option>
                                <option value="花蓮縣">花蓮縣</option>
                                <option value="台東縣">台東縣</option>
                                <option value="澎湖縣">澎湖縣</option>
                                <option value="金門縣">金門縣</option>
                                <option value="連江縣">連江縣</option>
                            </select>
                            <span class="form-error">請選擇縣市</span>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label required">地址</label>
                                <input type="text" name="address" placeholder="例:台北市寶慶路 25 號 2 樓" required>
                                <span class="form-error">此欄位為必填</span>
                            </div>

                            <div class="form-group">
                                <label class="form-label required">郵遞區號</label>
                                <input type="text" name="postalCode" placeholder="例:10005" pattern="[0-9]{3,5}" required>
                                <span class="form-error">請輸入有效的郵遞區號</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">活動預計參與人數</label>
                            <input type="number" name="participants" min="1" placeholder="估計值即可" required>
                            <span class="form-hint">估計值即可</span>
                            <span class="form-error">請輸入有效的人數</span>
                        </div>
                    </div>

                    <!-- Page 2: Organization Details -->
                    <div class="form-page" data-page="2">
                        <h2>機構資料</h2>
                        <p class="form-page-subtitle">請提供您所屬機構的相關資訊</p>

                        <div class="form-group">
                            <label class="form-label required">您的機構屬於</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="institutionType" value="學校" required>
                                    <span>學校</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="institutionType" value="企業" required>
                                    <span>企業</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="institutionType" value="社區" required>
                                    <span>社區</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="institutionType" value="自學團體" required>
                                    <span>自學團體</span>
                                </label>
                            </div>
                            <span class="form-error">請選擇機構類型</span>
                        </div>

                        <!-- School Fields (conditionally shown) -->
                        <div id="schoolFields" class="hidden">
                            <div class="form-group">
                                <label class="form-label required">學校名稱</label>
                                <input type="text" name="schoolName" placeholder="例:北一女中">
                                <span class="form-error">此欄位為必填</span>
                            </div>

                            <div class="form-group">
                                <label class="form-label required">年級</label>
                                <div class="radio-group">
                                    <label class="radio-option">
                                        <input type="radio" name="gradeLevel" value="國小低年級">
                                        <span>國小低年級</span>
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="gradeLevel" value="國小中年級">
                                        <span>國小中年級</span>
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="gradeLevel" value="國小高年級">
                                        <span>國小高年級</span>
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="gradeLevel" value="國中">
                                        <span>國中</span>
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="gradeLevel" value="高中">
                                        <span>高中</span>
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="gradeLevel" value="大學">
                                        <span>大學</span>
                                    </label>
                                </div>
                                <span class="form-error">請選擇年級</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">活動類型</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="activityType" value="教室活動" required>
                                    <span>教室活動</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="activityType" value="全校活動" required>
                                    <span>全校活動</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="activityType" value="區域活動" required>
                                    <span>區域活動</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="activityType" value="全國活動" required>
                                    <span>全國活動</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="activityType" value="專業發展" required>
                                    <span>專業發展</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="activityType" value="社區活動" required>
                                    <span>社區活動</span>
                                </label>
                            </div>
                            <span class="form-error">請選擇活動類型</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">活動會包含使用電子設備</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="deviceUsage" value="有使用設備" required>
                                    <span>有使用設備</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="deviceUsage" value="不插電活動" required>
                                    <span>不插電活動</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="deviceUsage" value="尚未決定" required>
                                    <span>尚未決定</span>
                                </label>
                            </div>
                            <span class="form-error">請選擇設備使用情況</span>
                        </div>
                    </div>

                    <!-- Page 3: Activity Details -->
                    <div class="form-page" data-page="3">
                        <h2>活動規劃</h2>
                        <p class="form-page-subtitle">請描述您計劃在機構內舉辦的 Hour of AI 活動</p>

                        <div class="form-group">
                            <label class="form-label required">請簡要介紹您的活動</label>
                            <textarea id="activityDescription" name="activityDescription" required placeholder="點擊下方「查看填寫範例」可快速選用範本"></textarea>
                            <span class="form-hint">請說明活動對象、時間、內容、進行方式等</span>
                            <span class="form-error">此欄位為必填</span>

                            <!-- Example Section -->
                            <div class="example-section">
                                <button type="button" class="example-toggle" id="exampleToggle">
                                    <span>
                                        <span class="material-icons small">lightbulb</span>
                                        查看填寫範例（點擊展開）
                                    </span>
                                    <span class="example-toggle-icon material-icons small">expand_more</span>
                                </button>
                                <div class="example-content" id="exampleContent">
                                    <div class="example-inner">
                                        <!-- Example 1: 國中 -->
                                        <div class="example-item">
                                            <div class="example-item-header">
                                                <span class="example-tag">國中範例</span>
                                                <button type="button" class="example-use-btn" data-example="1">使用此範例</button>
                                            </div>
                                            <div class="example-text">本校將於 2025 年 3 月舉辦「AI 素養起步走」活動，針對國中七年級學生（約 120 人），透過「數據世界：AI 原來如此」課程，讓學生認識 AI 基本概念與實際應用。活動將在電腦教室進行，每位學生使用一台電腦，預計 2 小時完成課程並取得證書。</div>
                                        </div>

                                        <!-- Example 2: 國小 -->
                                        <div class="example-item">
                                            <div class="example-item-header">
                                                <span class="example-tag">國小範例</span>
                                                <button type="button" class="example-use-btn" data-example="2">使用此範例</button>
                                            </div>
                                            <div class="example-text">本校計畫於 2025 年 4 月為五、六年級學生（約 80 人）舉辦「我的 AI 初體驗」活動。透過「數據世界：AI 原來如此」課程，以互動式教學讓孩子們初步了解 AI 技術。活動採分組進行，每 2-3 人共用一台平板或電腦，預計利用兩堂課（共 80 分鐘）完成，並於課後頒發參與證書。</div>
                                        </div>

                                        <!-- Example 3: 高中/全校 -->
                                        <div class="example-item">
                                            <div class="example-item-header">
                                                <span class="example-tag">高中/全校範例</span>
                                                <button type="button" class="example-use-btn" data-example="3">使用此範例</button>
                                            </div>
                                            <div class="example-text">本校將於 2025 年 5 月舉辦全校性「Hour of AI 週」活動，開放高一至高三學生自由報名參加（預計 200 人）。活動包含「我的半導體冒險」及「數據世界：AI 原來如此」兩個課程，學生可依興趣選擇。將於電腦教室及圖書館進行，採線上自主學習搭配教師引導討論的混成模式，預計每位學生投入 2-3 小時完成學習。</div>
                                        </div>

                                        <!-- Example 4: 社區/企業 -->
                                        <div class="example-item">
                                            <div class="example-item-header">
                                                <span class="example-tag">社區/企業範例</span>
                                                <button type="button" class="example-use-btn" data-example="4">使用此範例</button>
                                            </div>
                                            <div class="example-text">本機構將於 2025 年 6 月舉辦「社區 AI 素養推廣活動」，邀請社區居民及在職人士參與（預計 50 人）。透過「數據世界：AI 原來如此」課程，協助民眾建立 AI 基本認知，提升數位素養。活動採實體工作坊形式，於社區活動中心進行，每位參與者配備筆電或平板，預計 3 小時完成課程與交流討論。</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">此活動將以實體或線上方式進行</label>
                            <div class="checkbox-group">
                                <label class="checkbox-option">
                                    <input type="checkbox" name="deliveryFormat" value="實體">
                                    <span>實體</span>
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="deliveryFormat" value="線上">
                                    <span>線上</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-group" id="onlineRegistrationField" class="hidden">
                            <label class="form-label">若您的活動是線上且向公眾開放,請提供報名連結</label>
                            <input type="url" name="onlineRegistrationLink" placeholder="https://">
                            <span class="form-hint">選填</span>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label required">活動開始日期</label>
                                <input type="date" name="startDate" required>
                                <span class="form-error">請選擇日期</span>
                            </div>

                            <div class="form-group">
                                <label class="form-label">活動結束日期</label>
                                <input type="date" name="endDate">
                                <span class="form-hint">若活動為多日舉行</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">請提供任何宣傳活動的圖片連結</label>
                            <input type="url" name="promotionalImage" placeholder="https://">
                            <span class="form-hint">選填</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">還有其他想補充的內容嗎?</label>
                            <textarea name="additionalComments"></textarea>
                            <span class="form-hint">選填</span>
                        </div>
                    </div>

                    <!-- Page 4: Consent & Submit -->
                    <div class="form-page" data-page="4">
                        <h2>確認與提交</h2>
                        <p class="form-page-subtitle">最後確認您的活動規劃並同意相關條款</p>

                        <div class="form-group">
                            <label class="form-label required">若美國主辦方 Code.org 有相關問題,是否同意聯繫您?</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="codeOrgContact" value="是" required>
                                    <span>是,同意</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="codeOrgContact" value="否" required>
                                    <span>否,不同意</span>
                                </label>
                            </div>
                            <span class="form-error">請選擇一項</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">資料蒐集與運用同意聲明</label>
                            <div style="background: var(--color-bg-light); padding: var(--spacing-md); border-radius: var(--border-radius-sm); margin-bottom: var(--spacing-md); max-height: 300px; overflow-y: auto; font-size: var(--font-size-xs); line-height: 1.6;">
                                <p style="margin-bottom: var(--spacing-md);">均一平台教育基金會（以下簡稱本基金會）為履行本項「一小時玩 AI 」活動的推廣與聯繫目的，需蒐集您所填寫的個人資料。請詳細閱讀以下說明並勾選同意：</p>

                                <p style="margin-bottom: var(--spacing-sm);"><strong>目的與用途</strong></p>
                                <p style="margin-bottom: var(--spacing-xs);"><strong>資料蒐集目的：</strong> 本基金會依據《個人資料保護法》及相關法令規定，僅為以下特定目的蒐集您的個人資料：活動報名、活動執行、成果統計分析，以及後續的教育推廣資訊聯繫。</p>
                                <p style="margin-bottom: var(--spacing-xs);"><strong>資料類別：</strong> 包含您在表單中填寫的姓名、電子郵件、職稱、所屬機構/學校名稱及聯絡地址等資訊。</p>
                                <p style="margin-bottom: var(--spacing-md);"><strong>資料運用：</strong>本基金會將利用您提供的電子郵件，主動聯繫您有關「一小時玩 AI 」活動的最新資訊、資源更新或相關教育推廣活動。本基金會絕不會將您的個人資料提供給任何第三方或用於上述目的以外的其他用途（例如：商業銷售或廣告行銷）。</p>

                                <p style="margin-bottom: var(--spacing-sm);"><strong>資料保存</strong></p>
                                <p style="margin-bottom: var(--spacing-md);">本基金會將自活動報名日開始，妥善保管您的個人資料，直至本基金會評估已完成上述特定目的為止。</p>

                                <p style="margin-bottom: var(--spacing-sm);"><strong>您的權益</strong></p>
                                <p style="margin-bottom: var(--spacing-md);">您可隨時聯繫本基金會，行使查詢、閱覽、複製、補充、更正、停止蒐集/處理/利用，或請求刪除您個人資料的權利。</p>

                                <p style="margin-bottom: var(--spacing-sm);"><strong>【同意選項】</strong></p>
                                <p>本人已詳細閱讀並瞭解上述聲明，同意均一平台教育基金會得於前述目的及範圍內，蒐集、處理及利用本人所提供的個人資料。</p>
                            </div>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="dataConsent" value="同意" required>
                                    <span>本人已詳細閱讀並瞭解上述聲明，同意均一平台教育基金會得於前述目的及範圍內，蒐集、處理及利用本人所提供的個人資料。</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="dataConsent" value="不同意" required>
                                    <span>不同意</span>
                                </label>
                            </div>
                            <span class="form-error">您必須同意條款才能繼續</span>
                        </div>
                    </div>

                    <!-- Success Message (hidden initially) -->
                    <div class="form-page" data-page="success">
                        <div class="success-message">
                            <div class="icon">
                                <span class="material-icons" style="font-size: 4rem; color: var(--color-primary-teal);">check_circle</span>
                            </div>
                            <h2>感謝您成為 AI 教育推手！</h2>
                            <p style="margin: var(--spacing-lg) 0; color: var(--color-text-secondary);">
                                我們已收到您的活動規劃。<br>
                                讓我們一起推動台灣的 AI 素養教育！
                            </p>
                            <button type="button" class="btn btn-primary" id="submitAnotherBtn" style="margin-top: var(--spacing-xl);">
                                <span class="material-icons small">add</span>
                                規劃另一個活動
                            </button>
                        </div>
                    </div>

                    <!-- Form Navigation Buttons -->
                    <div class="hoa-form-navigation-wrapper" id="formActions">
                        <button type="button" class="btn btn-secondary hoa-nav-prev hidden" id="prevBtn">
                            <span class="material-icons small">arrow_back</span>
                            上一步
                        </button>
                        <button type="button" class="btn btn-primary hoa-nav-next" id="nextBtn">
                            下一步
                            <span class="material-icons small">arrow_forward</span>
                        </button>
                        <button type="submit" class="btn btn-primary hoa-nav-submit hidden" id="submitBtn">
                            提交活動規劃
                            <span class="material-icons small">send</span>
                        </button>
                    </div>

                    <!-- Honeypot fields for spam protection -->
                    <div style="position: absolute; left: -5000px;" aria-hidden="true">
                        <input type="text" name="website" tabindex="-1" autocomplete="off">
                        <input type="email" name="contact" tabindex="-1" autocomplete="off">
                        <input type="tel" name="phone_number" tabindex="-1" autocomplete="off">
                    </div>
                </form>
            </div>

            <!-- Full-page loading overlay -->
            <div class="form-loading-overlay" id="loadingOverlay">
                <div class="loading-content">
                    <div class="loading-spinner"></div>
                    <p class="loading-text">正在提交您的活動規劃</p>
                    <p class="loading-subtext">請稍候，請勿關閉頁面或點擊其他地方</p>
                </div>
            </div>

            <!-- Contact Information Card -->
            <div class="contact-info-card fade-in">
                <h3>有疑問嗎？我們隨時為您服務</h3>
                <p>如果您在填寫報名表時有任何疑問，或需要更多活動資訊，歡迎隨時與我們聯繫</p>
                <a href="mailto:support@junyiacademy.org" class="contact-email-link">
                    <span class="contact-email-icon material-icons medium">email</span>
                    <span>support@junyiacademy.org</span>
                </a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <!-- Main footer content -->
            <div class="footer-content">
                <!-- About Section -->
                <div class="footer-section">
                    <h4>均一 x Hour of AI</h4>
                    <p>由均一平台教育基金會主辦<br>與 Code.org 全球同步推動 AI 素養教育</p>
                </div>

                <!-- Links Section -->
                <div class="footer-section">
                    <h4>相關連結</h4>
                    <a href="https://www.junyiacademy.org/event/2025-hour-of-ai/">台灣活動官網</a>
                    <a href="https://hourofai.org/" target="_blank">Hour of AI 全球官網</a>
                    <a href="https://code.org/" target="_blank">Code.org</a>
                </div>

                <!-- Contact Section with Logo -->
                <div class="footer-section">
                    <h4>聯絡我們</h4>

                    <!-- Logo in contact section -->
                    <div class="contact-logo">
                        <img src="https://storage.googleapis.com/wpassets.junyiacademy.org/1/2020/02/LOGO_WHITE.png"
                             alt="均一平台教育基金會" class="footer-logo-img">
                    </div>

                    <div class="contact-info-compact">
                        <p class="organization-name">均一平台教育基金會</p>

                        <div class="contact-item">
                            <span class="material-icons small">email</span>
                            <a href="mailto:support@junyiacademy.org">support@junyiacademy.org</a>
                        </div>

                        <div class="contact-item">
                            <span class="material-icons small">phone</span>
                            <a href="tel:+886223931231">(02) 2393-1231</a>
                        </div>

                        <div class="contact-item">
                            <span class="material-icons small">schedule</span>
                            <span>營業時間：10:00 ~ 18:00 <small style="opacity: 0.7;">(13:00 ~ 14:00 為午休時段)</small></span>
                        </div>

                        <div class="contact-item">
                            <span class="material-icons small">place</span>
                            <span>台北市中正區寶慶路 25 號 2 樓</span>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </footer>

    <!-- Floating CTA Button -->
    <div class="floating-cta" id="floatingCta">
        <a href="#register" class="btn btn-primary">
            <span class="material-icons small">add_circle</span>
            規劃我的活動
        </a>
    </div>

    <script>
        // ===== 統一的 Flash-Card 系統 =====
        function toggleCard(button, event) {
            event.stopPropagation();

            const cardElement = button.closest('.activity-card');

            if (cardElement) {
                cardElement.classList.add('flipped');

                // 直接使用內聯樣式強制顯示背面
                const cardImage = cardElement.querySelector('.activity-card-image');
                const cardContent = cardElement.querySelector('.activity-card-content');
                const overlay = cardElement.querySelector('.image-overlay');
                const closeBtn = cardElement.querySelector('.overlay-close');

                if (cardImage) {
                    cardImage.style.opacity = '1';
                    cardImage.style.zIndex = '10';
                    cardImage.style.pointerEvents = 'auto';
                }
                if (cardContent) {
                    cardContent.style.opacity = '0.1';
                }
                if (overlay) {
                    overlay.style.opacity = '1';
                }
                if (closeBtn) {
                    closeBtn.style.display = 'inline-flex';
                }

                // 停止按鈕的動畫
                button.style.animation = 'none';
            } else {
                console.error('找不到 .activity-card 元素!');
            }
        }

        function closeCard(button, event) {
            event.stopPropagation();

            const cardElement = button.closest('.activity-card');
            if (cardElement) {
                cardElement.classList.remove('flipped');

                // 直接重置內聯樣式
                const cardImage = cardElement.querySelector('.activity-card-image');
                const cardContent = cardElement.querySelector('.activity-card-content');
                const overlay = cardElement.querySelector('.image-overlay');
                const closeBtn = cardElement.querySelector('.overlay-close');

                if (cardImage) {
                    cardImage.style.opacity = '0';
                    cardImage.style.zIndex = '';
                    cardImage.style.pointerEvents = 'none';
                }
                if (cardContent) {
                    cardContent.style.opacity = '1';
                }
                if (overlay) {
                    overlay.style.opacity = '0';
                }
                if (closeBtn) {
                    closeBtn.style.display = 'none';
                }

                // 重新啟動查看詳細按鈕的動畫
                const detailsButton = cardElement.querySelector('.activity-details-button');
                if (detailsButton) {
                    detailsButton.style.animation = 'pulse-gentle 2s infinite';
                }
            }
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {



            // 為所有查看詳細按鈕添加事件監聽器
            const detailButtons = document.querySelectorAll('.activity-details-button');

            detailButtons.forEach((button, index) => {

                // 添加多種事件
                button.addEventListener('click', function(event) {
                    event.preventDefault();
                    event.stopPropagation();
                    event.stopImmediatePropagation();

                    toggleCard(this, event);
                    return false;
                }, true);

                button.addEventListener('mousedown', function(event) {
                }, true);

                button.addEventListener('touchstart', function(event) {
                }, true);
            });

            // 為所有關閉按鈕添加事件監聽器
            const closeButtons = document.querySelectorAll('.overlay-close');

            closeButtons.forEach((button, index) => {

                button.addEventListener('click', function(event) {
                    event.preventDefault();
                    event.stopPropagation();
                    event.stopImmediatePropagation();

                    closeCard(this, event);
                    return false;
                }, true);
            });

            // 為整個activity-card添加點擊事件作為後備
            const activityCards = document.querySelectorAll('.activity-card');
            activityCards.forEach((card, index) => {

                card.addEventListener('click', function(event) {

                    // 檢查是否點擊了詳細按鈕區域
                    if (event.target.closest('.activity-details-button')) {
                        const button = event.target.closest('.activity-details-button');
                        event.preventDefault();
                        event.stopPropagation();
                        toggleCard(button, event);
                    }
                });
            });
        });

        // ===== Smart Configuration System =====

        // 智慧配置函數 - 自動偵測部署環境
        function getFormSubmitUrl() {
            // 1. 檢查 URL 參數 (用於測試)
            const urlParams = new URLSearchParams(window.location.search);
            const apiUrl = urlParams.get('apiUrl');
            if (apiUrl) {
                console.log('🔧 Using URL parameter API:', apiUrl);
                return apiUrl;
            }

            // 2. 檢查 WordPress 環境變數 (用於生產)
            if (window.HOA_CONFIG && window.HOA_CONFIG.FORM_SUBMIT_URL) {
                console.log('🏢 Using WordPress config API');
                return window.HOA_CONFIG.FORM_SUBMIT_URL;
            }

            // 3. 偵測域名環境
            const hostname = window.location.hostname;
            if (hostname.includes('junyiacademy.org')) {
                console.log('🌐 Detected Junyiacademy domain - using production fallback');
                // WordPress 部署時需要設定 window.HOA_CONFIG
                return 'PLEASE_SET_HOA_CONFIG_IN_WORDPRESS';
            }

            // 4. Firebase Hosting 環境
            if (hostname.includes('hour-of-ai-landing-junyi.web.app') ||
                hostname.includes('hour-of-ai-landing-junyi.firebaseapp.com')) {
                console.log('🔥 Detected Firebase Hosting - using production API');
                return 'https://script.google.com/macros/s/AKfycbwZ1VRm8MxtqLms24V3Q4sJ5Jklu9o9V14q-B9QHTlw1e45Q2GcrzGA6E1RrxbMybRTFw/exec';
            }

            // 5. GitHub Pages 或本地測試環境
            console.log('🧪 Using demo mode - statistics will show sample data');
            return 'DEMO_MODE';
        }

        const CONFIG = {
            // 智慧 API URL 配置
            FORM_SUBMIT_URL: getFormSubmitUrl(),
            ENABLE_ANALYTICS: true,
            ANIMATION_DURATION: 300,
            CSRF_TOKEN_KEY: 'csrf_token',
            MAX_REQUESTS_PER_HOUR: 3,

            // Demo mode 配置
            IS_DEMO_MODE: function() {
                return this.FORM_SUBMIT_URL === 'DEMO_MODE';
            },

            // WordPress 配置檢查
            isWordPressConfigValid: function() {
                return this.FORM_SUBMIT_URL !== 'PLEASE_SET_HOA_CONFIG_IN_WORDPRESS';
            }
        };

        // Generate secure CSRF token
        function generateCSRFToken() {
            const array = new Uint8Array(16);
            crypto.getRandomValues(array);
            return Array.from(array, byte => byte.toString(16).padStart(2, '0')).join('');
        }

        // Initialize CSRF token on page load
        function initializeCSRFToken() {
            const csrfToken = generateCSRFToken();
            sessionStorage.setItem(CONFIG.CSRF_TOKEN_KEY, csrfToken);
            return csrfToken;
        }

        // Initialize token
        let currentToken = initializeCSRFToken();

        // Refresh token periodically (every 30 minutes)
        setInterval(() => {
            currentToken = initializeCSRFToken();
        }, 30 * 60 * 1000);

        // ===== DEVELOPMENT TESTING UTILITIES =====

        // Auto-fill form for testing (call fillTestData() in console)
        window.fillTestData = function() {
            const testData = {
                'email': 'test@example.com',
                'contactName': '測試使用者',
                'jobTitle': '教師',
                'phone': '0912345678',
                'county': '台北市',
                'address': '台北市信義區市府路1號',
                'postalCode': '11008',
                'participants': '30',
                'institutionType': '學校',
                'schoolName': '測試國小',
                'gradeLevel': '國小',
                'activityType': '教室活動',
                'deviceUsage': '有使用設備',
                'activityDescription': '這是一個AI教育測試活動，將教授學生基本的人工智慧概念和程式設計技能。',
                'deliveryFormat': '實體',
                'onlineRegistrationLink': 'https://example.com/register',
                'startDate': '2025-03-01',
                'endDate': '2025-03-01',
                'promotionalImage': 'https://example.com/image.jpg',
                'additionalComments': '測試用備註',
                'codeOrgContact': '是',
                'dataConsent': '同意'
            };

            Object.entries(testData).forEach(([name, value]) => {
                const input = document.querySelector(`[name="${name}"]`);
                if (input) {
                    if (input.type === 'radio') {
                        const radio = document.querySelector(`[name="${name}"][value="${value}"]`);
                        if (radio) radio.checked = true;
                    } else if (input.type === 'checkbox') {
                        if (value === '同意') input.checked = true;
                    } else {
                        input.value = value;
                    }
                    input.dispatchEvent(new Event('input', { bubbles: true }));
                }
            });

            console.log('✅ 測試資料已自動填入');
        };

        // Quick navigation to any page (call goToPage(4) in console)
        window.goToPage = function(page) {
            currentPage = page;
            showPage(currentPage);
            updateProgress();
            console.log(`✅ 已跳轉到第 ${page} 頁`);
        };

        // CORS test function
        window.testCORS = function() {
            console.log('🧪 Testing CORS...');

            const testPayload = {
                timestamp: Date.now(),
                csrf_token: sessionStorage.getItem(CONFIG.CSRF_TOKEN_KEY),
                origin: window.location.origin,
                email: 'cors-test@example.com',
                contactName: 'CORS Test',
                honeypot_website: '',
                honeypot_contact: '',
                honeypot_phone: ''
            };

            fetch(CONFIG.FORM_SUBMIT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(testPayload)
            })
            .then(() => {
                console.log('✅ CORS test completed - no errors thrown');
            })
            .catch(error => {
                console.error('❌ CORS test failed:', error);
            });
        };

        // Rate limit test function
        window.testRateLimit = function(testEmail = 'rate-limit-test@example.com', count = 6) {
            console.log(`🚦 Testing rate limit with ${count} requests for ${testEmail}...`);

            const promises = [];

            for (let i = 1; i <= count; i++) {
                const testPayload = {
                    timestamp: Date.now(),
                    csrf_token: sessionStorage.getItem(CONFIG.CSRF_TOKEN_KEY),
                    origin: window.location.origin,
                    email: testEmail,
                    contactName: `Rate Test ${i}`,
                    honeypot_website: '',
                    honeypot_contact: '',
                    honeypot_phone: ''
                };

                const promise = fetch(CONFIG.FORM_SUBMIT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testPayload)
                })
                .then(() => {
                    console.log(`📤 Request ${i} sent successfully`);
                    return { success: true, index: i };
                })
                .catch(error => {
                    console.error(`❌ Request ${i} failed:`, error);
                    return { success: false, index: i, error };
                });

                promises.push(promise);

                // Small delay between requests
                if (i < count) {
                    setTimeout(() => {}, 200);
                }
            }

            Promise.all(promises).then(results => {
                const successful = results.filter(r => r.success).length;
                const failed = results.filter(r => !r.success).length;

                console.log(`
🚦 Rate Limit Test Results:
• Total requests: ${count}
• Successful: ${successful}
• Failed: ${failed}
• Test email: ${testEmail}

📝 Note: Due to no-cors mode, we can't see server-side rate limiting.
Check Google Apps Script logs to verify rate limiting is working.
Check Google Sheets to see how many entries were actually created.
                `);
            });
        };

        // Honeypot test function
        window.testHoneypot = function() {
            console.log('🍯 Testing honeypot detection...');

            const testPayload = {
                timestamp: Date.now(),
                csrf_token: sessionStorage.getItem(CONFIG.CSRF_TOKEN_KEY),
                origin: window.location.origin,
                email: 'honeypot-test@example.com',
                contactName: 'Honeypot Test',
                // Trigger honeypot detection
                honeypot_website: 'http://spam-website.com',
                honeypot_contact: 'spam@spam.com',
                honeypot_phone: '123456789'
            };

            fetch(CONFIG.FORM_SUBMIT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(testPayload)
            })
            .then(() => {
                console.log(`
🍯 Honeypot test completed.

📝 Expected behavior:
• Server should detect honeypot fields are filled
• Server should block this request
• No entry should appear in Google Sheets
• Check Google Apps Script logs for 'Honeypot triggered' messages

⚠️ Due to no-cors mode, we can't see the server rejection.
                `);
            })
            .catch(error => {
                console.error('❌ Honeypot test failed:', error);
            });
        };

        // Security test suite
        window.runSecurityTests = function() {
            console.log('🔒 Running complete security test suite...');

            console.log('\n1️⃣ Testing CORS...');
            testCORS();

            setTimeout(() => {
                console.log('\n2️⃣ Testing Honeypot...');
                testHoneypot();
            }, 1000);

            setTimeout(() => {
                console.log('\n3️⃣ Testing Rate Limit...');
                testRateLimit();
            }, 2000);

            console.log(`
🔒 Security Test Suite Started

⏱️ Tests running in sequence:
1. CORS connectivity test
2. Honeypot detection test
3. Rate limit test (6 requests)

📊 Check results above and verify in:
• Browser console for client-side results
• Google Apps Script logs for server-side validation
• Google Sheets for actual data written

⏰ All tests will complete in ~10 seconds
            `);
        };

        // Dev shortcuts (only available in staging)
        if (window.location.hostname.includes('staging') || window.location.hostname.includes('localhost')) {
            console.log(`
🔧 開發測試工具已載入:
• fillTestData() - 自動填入測試資料
• goToPage(n) - 跳轉到指定頁面 (1-4)

🧪 安全測試功能:
• testCORS() - 測試CORS連線
• testRateLimit() - 測試頻率限制 (預設6次請求)
• testHoneypot() - 測試蜜罐防護
• runSecurityTests() - 執行完整安全測試套件

            `);
        }

        // ===== Activity Card Progressive Disclosure =====
        document.addEventListener('DOMContentLoaded', function() {
            const activityCards = document.querySelectorAll('[data-expandable]');

            function isDesktop() {
                return window.innerWidth > 768;
            }

            // Simple, bulletproof approach
            activityCards.forEach((card, index) => {
                const expandBtn = card.querySelector('.activity-expand-btn');

                // Desktop: hover to expand
                card.addEventListener('mouseenter', () => {
                    if (isDesktop()) {
                        // First: remove expanded from ALL cards
                        activityCards.forEach(c => c.classList.remove('expanded'));

                        // Then: add expanded ONLY to this card
                        card.classList.add('expanded');
                    }
                });

                // Desktop: leave to collapse
                card.addEventListener('mouseleave', () => {
                    if (isDesktop()) {
                        card.classList.remove('expanded');
                    }
                });

                // Desktop: click expand button to toggle
                if (expandBtn) {
                    expandBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();

                        if (isDesktop()) {
                            const isExpanded = card.classList.contains('expanded');

                            // Always close all first
                            activityCards.forEach(c => c.classList.remove('expanded'));

                            // If it wasn't expanded, expand it
                            if (!isExpanded) {
                                card.classList.add('expanded');
                            }
                        }
                    });
                }

                // Mobile: entire card click to toggle
                card.addEventListener('click', (e) => {
                    if (!isDesktop()) {
                        // Prevent if clicking on CTA button
                        if (e.target.closest('.btn')) {
                            return;
                        }

                        e.preventDefault();
                        const isExpanded = card.classList.contains('expanded');

                        // Always close all first
                        activityCards.forEach(c => c.classList.remove('expanded'));

                        // If it wasn't expanded, expand it
                        if (!isExpanded) {
                            card.classList.add('expanded');
                        }
                    }
                });
            });

            // Click outside to close all
            document.addEventListener('click', (e) => {
                if (!e.target.closest('[data-expandable]')) {
                    activityCards.forEach(card => card.classList.remove('expanded'));
                }
            });
        });

        // ===== Mobile Navigation =====
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const navLinks = document.getElementById('navLinks');

        mobileMenuToggle.addEventListener('click', () => {
            mobileMenuToggle.classList.toggle('active');
            navLinks.classList.toggle('active');
        });

        // Close mobile menu when clicking on a link
        navLinks.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', () => {
                mobileMenuToggle.classList.remove('active');
                navLinks.classList.remove('active');
            });
        });

        // ===== Sticky Navigation =====
        const nav = document.getElementById('nav');
        let lastScroll = 0;

        window.addEventListener('scroll', () => {
            const currentScroll = window.pageYOffset;

            if (currentScroll > 100) {
                nav.classList.add('scrolled');
            } else {
                nav.classList.remove('scrolled');
            }

            lastScroll = currentScroll;
        });

        // ===== Fade-in Animation on Scroll =====
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, observerOptions);

        document.querySelectorAll('.fade-in').forEach(el => {
            observer.observe(el);
        });

        // ===== Floating CTA =====
        const floatingCta = document.getElementById('floatingCta');
        const registrationSection = document.getElementById('register');

        window.addEventListener('scroll', () => {
            const registrationTop = registrationSection.offsetTop;
            const scrollPosition = window.pageYOffset + window.innerHeight;

            if (window.pageYOffset > 800 && scrollPosition < registrationTop + 200) {
                floatingCta.classList.add('visible');
            } else {
                floatingCta.classList.remove('visible');
            }
        });

        // ===== Activity Description Example Section =====
        const exampleToggle = document.getElementById('exampleToggle');
        const exampleContent = document.getElementById('exampleContent');
        const activityDescriptionTextarea = document.getElementById('activityDescription');
        const exampleUseBtns = document.querySelectorAll('.example-use-btn');

        // Example templates
        const exampleTemplates = {
            '1': '本校將於 2025 年 3 月舉辦「AI 素養起步走」活動，針對國中七年級學生（約 120 人），透過「數據世界：AI 原來如此」課程，讓學生認識 AI 基本概念與實際應用。活動將在電腦教室進行，每位學生使用一台電腦，預計 2 小時完成課程並取得證書。',
            '2': '本校計畫於 2025 年 4 月為五、六年級學生（約 80 人）舉辦「我的 AI 初體驗」活動。透過「數據世界：AI 原來如此」課程，以互動式教學讓孩子們初步了解 AI 技術。活動採分組進行，每 2-3 人共用一台平板或電腦，預計利用兩堂課（共 80 分鐘）完成，並於課後頒發參與證書。',
            '3': '本校將於 2025 年 5 月舉辦全校性「Hour of AI 週」活動，開放高一至高三學生自由報名參加（預計 200 人）。活動包含「我的半導體冒險」及「數據世界：AI 原來如此」兩個課程，學生可依興趣選擇。將於電腦教室及圖書館進行，採線上自主學習搭配教師引導討論的混成模式，預計每位學生投入 2-3 小時完成學習。',
            '4': '本機構將於 2025 年 6 月舉辦「社區 AI 素養推廣活動」，邀請社區居民及在職人士參與（預計 50 人）。透過「數據世界：AI 原來如此」課程，協助民眾建立 AI 基本認知，提升數位素養。活動採實體工作坊形式，於社區活動中心進行，每位參與者配備筆電或平板，預計 3 小時完成課程與交流討論。'
        };

        // Toggle example section
        if (exampleToggle) {
            exampleToggle.addEventListener('click', () => {
                exampleToggle.classList.toggle('active');
                exampleContent.classList.toggle('active');
            });
        }

        // Use example buttons
        exampleUseBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const exampleId = btn.getAttribute('data-example');
                const exampleText = exampleTemplates[exampleId];

                if (exampleText && activityDescriptionTextarea) {
                    activityDescriptionTextarea.value = exampleText;
                    activityDescriptionTextarea.focus();

                    // Collapse example section after selection
                    exampleToggle.classList.remove('active');
                    exampleContent.classList.remove('active');

                    // Remove error state if present
                    const formGroup = activityDescriptionTextarea.closest('.form-group');
                    if (formGroup) {
                        formGroup.classList.remove('error');
                    }

                    // Show brief success feedback
                    btn.innerHTML = '<span class="material-icons small">check</span> 已填入';
                    btn.style.background = 'var(--color-primary-teal)';
                    setTimeout(() => {
                        btn.textContent = '使用此範例';
                        btn.style.background = '';
                    }, 1500);
                }
            });
        });

        // ===== Multi-Step Form Logic =====
        const form = document.getElementById('registrationForm');
        const formPages = document.querySelectorAll('.form-page');
        const progressSteps = document.querySelectorAll('.progress-step');
        // Progress line removed for mobile-friendly design
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');
        const formActions = document.getElementById('formActions');

        let currentPage = 1;
        const totalPages = 4;

        // Update progress bar
        function updateProgress() {
            // Progress line removed for mobile-friendly design

            progressSteps.forEach((step, index) => {
                const stepNumber = index + 1;
                if (stepNumber < currentPage) {
                    step.classList.add('completed');
                    step.classList.remove('active');
                } else if (stepNumber === currentPage) {
                    step.classList.add('active');
                    step.classList.remove('completed');
                } else {
                    step.classList.remove('active', 'completed');
                }
            });
        }

        // Show specific page
        function showPage(pageNumber) {
            formPages.forEach(page => {
                page.classList.remove('active');
            });

            const targetPage = document.querySelector(`[data-page="${pageNumber}"]`);
            if (targetPage) {
                targetPage.classList.add('active');
            }

            // Update button visibility
            if (pageNumber === 1) {
                prevBtn.classList.add('hidden');
            } else {
                prevBtn.classList.remove('hidden');
            }

            if (pageNumber === totalPages) {
                nextBtn.classList.add('hidden');
                submitBtn.classList.remove('hidden');
            } else {
                nextBtn.classList.remove('hidden');
                submitBtn.classList.add('hidden');
            }

            // Scroll to form
            document.querySelector('.form-progress').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // Validate current page
        function validatePage(pageNumber) {
            const currentPageEl = document.querySelector(`[data-page="${pageNumber}"]`);
            const inputs = currentPageEl.querySelectorAll('input[required], select[required], textarea[required]');
            let isValid = true;

            inputs.forEach(input => {
                const formGroup = input.closest('.form-group');

                // Check if input is visible (for conditional fields)
                if (formGroup && formGroup.classList.contains('hidden')) {
                    return;
                }

                // For radio buttons
                if (input.type === 'radio') {
                    const radioGroup = currentPageEl.querySelectorAll(`input[name="${input.name}"]`);
                    const isChecked = Array.from(radioGroup).some(radio => radio.checked);
                    if (!isChecked) {
                        formGroup.classList.add('error');
                        isValid = false;
                    } else {
                        formGroup.classList.remove('error');
                    }
                }
                // For other inputs
                else if (!input.value.trim()) {
                    formGroup.classList.add('error');
                    isValid = false;
                } else if (input.hasAttribute('pattern')) {
                    // Validate pattern
                    const pattern = new RegExp(input.getAttribute('pattern'));
                    if (!pattern.test(input.value)) {
                        formGroup.classList.add('error');
                        isValid = false;
                    } else {
                        formGroup.classList.remove('error');
                    }
                } else {
                    formGroup.classList.remove('error');
                }
            });

            // Custom validation for page 4
            if (pageNumber === 4) {
                const dataConsent = document.querySelector('input[name="dataConsent"]:checked');
                if (dataConsent && dataConsent.value === '不同意') {
                    alert('您必須同意資料蒐集與運用聲明才能完成報名');
                    isValid = false;
                }
            }

            return isValid;
        }

        // Next button
        nextBtn.addEventListener('click', () => {
            if (validatePage(currentPage)) {
                currentPage++;
                showPage(currentPage);
                updateProgress();
            }
        });

        // Previous button
        prevBtn.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                showPage(currentPage);
                updateProgress();
            }
        });

        // Standard button elements - no extra keyboard handling needed

        // Conditional Fields Logic

        // Show/hide school fields based on institution type
        const institutionTypeRadios = document.querySelectorAll('input[name="institutionType"]');
        const schoolFields = document.getElementById('schoolFields');

        institutionTypeRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                if (e.target.value === '學校') {
                    schoolFields.classList.remove('hidden');
                    schoolFields.querySelectorAll('input[name="schoolName"], input[name="gradeLevel"]').forEach(input => {
                        input.setAttribute('required', 'required');
                    });
                } else {
                    schoolFields.classList.add('hidden');
                    schoolFields.querySelectorAll('input').forEach(input => {
                        input.removeAttribute('required');
                        input.value = '';
                    });
                }
            });
        });

        // Show/hide online registration field
        const deliveryFormatCheckboxes = document.querySelectorAll('input[name="deliveryFormat"]');
        const onlineRegistrationField = document.getElementById('onlineRegistrationField');

        deliveryFormatCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                const onlineChecked = Array.from(deliveryFormatCheckboxes).some(cb =>
                    cb.value === '線上' && cb.checked
                );

                if (onlineChecked) {
                    onlineRegistrationField.classList.remove('hidden');
                } else {
                    onlineRegistrationField.classList.add('hidden');
                }
            });
        });

        // ===== Form Submission =====
        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            if (!validatePage(currentPage)) {
                return;
            }

            // Show loading overlay
            const loadingOverlay = document.getElementById('loadingOverlay');
            loadingOverlay.classList.add('active');

            // Collect form data
            const formData = new FormData(form);
            const data = {};

            // Convert FormData to object
            for (let [key, value] of formData.entries()) {
                // Handle checkboxes (multiple values)
                if (key === 'deliveryFormat') {
                    if (!data[key]) {
                        data[key] = [];
                    }
                    data[key].push(value);
                } else {
                    data[key] = value;
                }
            }

            // Convert deliveryFormat array to string
            if (Array.isArray(data.deliveryFormat)) {
                data.deliveryFormat = data.deliveryFormat.join(', ');
            }

            // Add timestamp and security data
            data.timestamp = Date.now();
            data.csrf_token = sessionStorage.getItem(CONFIG.CSRF_TOKEN_KEY);
            data.origin = window.location.origin;

            // Add honeypot data (should be empty)
            data.honeypot_website = formData.get('website') || '';
            data.honeypot_contact = formData.get('contact') || '';
            data.honeypot_phone = formData.get('phone_number') || '';

            // Disable submit button
            submitBtn.disabled = true;
            submitBtn.textContent = '送出中...';

            try {
                // 檢查是否為 Demo Mode
                if (CONFIG.IS_DEMO_MODE()) {
                    console.log('🧪 Demo Mode: Simulating form submission');
                    console.log('📝 Form data would be:', data);

                    // 模擬 API 延遲
                    await new Promise(resolve => setTimeout(resolve, 1500));

                    // Demo mode 不實際提交，直接顯示成功
                } else if (!CONFIG.isWordPressConfigValid()) {
                    // WordPress 環境但未正確設定
                    throw new Error('請在 WordPress 中設定 window.HOA_CONFIG.FORM_SUBMIT_URL');
                } else {
                    // 正常提交到 Google Apps Script
                    console.log('🚀 Submitting to:', CONFIG.FORM_SUBMIT_URL);
                    await fetch(CONFIG.FORM_SUBMIT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });
                }

                // Since we can't read the response in no-cors mode,
                // we assume success if no error was thrown

                // Hide loading overlay
                loadingOverlay.classList.remove('active');

                // Reset submit button state
                submitBtn.disabled = false;
                submitBtn.innerHTML = '提交活動規劃 <span class="material-icons small">send</span>';

                // Show success page
                formActions.classList.add('hidden');

                // Ensure all navigation buttons are hidden
                prevBtn.classList.add('hidden');
                nextBtn.classList.add('hidden');
                submitBtn.classList.add('hidden');

                formPages.forEach(page => page.classList.remove('active'));
                document.querySelector('[data-page="success"]').classList.add('active');

                // Track conversion
                if (CONFIG.ENABLE_ANALYTICS && typeof gtag !== 'undefined') {
                    gtag('event', 'form_submission', {
                        'event_category': 'registration',
                        'event_label': '均一 x Hour of AI'
                    });
                }

                // Reset form
                form.reset();
                currentPage = 1;

            } catch (error) {
                console.error('Form submission error:', error);

                // Hide loading overlay on error
                loadingOverlay.classList.remove('active');

                // Simple error handling for no-cors mode
                let errorMessage = '送出時發生錯誤,請稍後再試或直接聯繫我們。';

                if (error.message && error.message.includes('Failed to fetch')) {
                    errorMessage = '網路連線問題，請檢查您的網路連線後再試';
                }

                alert(errorMessage);
                submitBtn.disabled = false;
                submitBtn.innerHTML = '提交活動規劃 <span class="material-icons small">send</span>';
            }
        });

        // ===== Upcoming Events Carousel =====

        // Event data (Phase 2: will be replaced with Google Sheets data)
        const upcomingEventsConfig = {
            AUTOPLAY_INTERVAL: 5000, // 5 seconds
            events: [
                {
                    title: 'AI 素養起步走｜學生體驗場',
                    description: '1/22（四）由均一老師全程線上帶領，讓孩子在學期最後一週趣味體驗 AI',
                    url: 'https://link.junyiacademy.org/8k8ckh'
                },
                {
                    title: 'AI 素養起步走｜教師增能場',
                    description: '1/27（二）陪老師一起學習如何在課堂中引導孩子培養 AI 素養，線上免費參加',
                    url: 'https://link.junyiacademy.org/8k8ckh'
                }
            ]
        };

        // Carousel state
        let carouselAutoplayTimer = null;
        let carouselCurrentIndex = 0;

        /**
         * Render event cards in the carousel
         */
        function renderEventCards(events) {
            const carousel = document.getElementById('eventsCarousel');
            if (!carousel || !events || events.length === 0) return;

            carousel.innerHTML = events.map((event, index) => `
                <a href="${event.url}"
                   class="event-card fade-in"
                   target="_blank"
                   rel="noopener noreferrer"
                   data-event-index="${index}">
                    <div class="event-card-arrow">
                        <span class="material-icons">arrow_forward</span>
                    </div>
                    <div class="event-card-content">
                        <h3 class="event-card-title">${event.title}</h3>
                        <p class="event-card-description">${event.description}</p>
                        <span class="event-card-btn">
                            <span class="material-icons small">open_in_new</span>
                            前往活動
                        </span>
                    </div>
                </a>
            `).join('');

            // Trigger fade-in animation
            setTimeout(() => {
                carousel.querySelectorAll('.fade-in').forEach(el => el.classList.add('visible'));
            }, 100);
        }

        /**
         * Render carousel dots
         */
        function renderCarouselDots(totalPages) {
            const dotsContainer = document.getElementById('carouselDots');
            if (!dotsContainer || totalPages <= 1) {
                if (dotsContainer) dotsContainer.innerHTML = '';
                return;
            }

            dotsContainer.innerHTML = Array.from({ length: totalPages }, (_, i) => `
                <button class="carousel-dot ${i === 0 ? 'active' : ''}"
                        data-page="${i}"
                        aria-label="前往第 ${i + 1} 頁"></button>
            `).join('');

            // Add click handlers
            dotsContainer.querySelectorAll('.carousel-dot').forEach(dot => {
                dot.addEventListener('click', () => {
                    const page = parseInt(dot.dataset.page);
                    scrollToPage(page);
                    resetAutoplay();
                });
            });
        }

        /**
         * Get visible cards count based on viewport
         * 統一使用手機端樣式：所有裝置都只顯示單一卡片
         */
        function getVisibleCardsCount() {
            return 1; // 所有裝置統一顯示單一卡片
        }

        /**
         * Get total pages
         */
        function getTotalPages() {
            const events = upcomingEventsConfig.events;
            const visibleCards = getVisibleCardsCount();
            return Math.ceil(events.length / visibleCards);
        }

        /**
         * Scroll carousel to specific page
         */
        function scrollToPage(page) {
            const carousel = document.getElementById('eventsCarousel');
            if (!carousel) return;

            const cards = carousel.querySelectorAll('.event-card');
            if (cards.length === 0) return;

            const visibleCards = getVisibleCardsCount();
            const targetIndex = Math.min(page * visibleCards, cards.length - 1);
            const targetCard = cards[targetIndex];

            if (targetCard) {
                carousel.scrollTo({
                    left: targetCard.offsetLeft - carousel.offsetLeft,
                    behavior: 'smooth'
                });
            }

            carouselCurrentIndex = page;
            updateCarouselDots(page);
            updateNavButtons();
        }

        /**
         * Update active dot
         */
        function updateCarouselDots(activePage) {
            const dots = document.querySelectorAll('.carousel-dot');
            dots.forEach((dot, i) => {
                dot.classList.toggle('active', i === activePage);
            });
        }

        /**
         * Update navigation buttons state
         */
        function updateNavButtons() {
            const prevBtn = document.getElementById('carouselPrev');
            const nextBtn = document.getElementById('carouselNext');
            const totalPages = getTotalPages();

            if (prevBtn) prevBtn.disabled = carouselCurrentIndex === 0;
            if (nextBtn) nextBtn.disabled = carouselCurrentIndex >= totalPages - 1;
        }

        /**
         * Start autoplay
         */
        function startAutoplay() {
            stopAutoplay();
            carouselAutoplayTimer = setInterval(() => {
                const totalPages = getTotalPages();
                const nextPage = (carouselCurrentIndex + 1) % totalPages;
                scrollToPage(nextPage);
            }, upcomingEventsConfig.AUTOPLAY_INTERVAL);
        }

        /**
         * Stop autoplay
         */
        function stopAutoplay() {
            if (carouselAutoplayTimer) {
                clearInterval(carouselAutoplayTimer);
                carouselAutoplayTimer = null;
            }
        }

        /**
         * Reset autoplay (restart timer)
         */
        function resetAutoplay() {
            startAutoplay();
        }

        /**
         * Initialize events carousel
         */
        function initEventsCarousel() {
            const carousel = document.getElementById('eventsCarousel');
            const prevBtn = document.getElementById('carouselPrev');
            const nextBtn = document.getElementById('carouselNext');

            if (!carousel) return;

            // Render cards and dots
            renderEventCards(upcomingEventsConfig.events);
            renderCarouselDots(getTotalPages());
            updateNavButtons();

            // Navigation button handlers
            if (prevBtn) {
                prevBtn.addEventListener('click', () => {
                    if (carouselCurrentIndex > 0) {
                        scrollToPage(carouselCurrentIndex - 1);
                        resetAutoplay();
                    }
                });
            }

            if (nextBtn) {
                nextBtn.addEventListener('click', () => {
                    const totalPages = getTotalPages();
                    if (carouselCurrentIndex < totalPages - 1) {
                        scrollToPage(carouselCurrentIndex + 1);
                        resetAutoplay();
                    }
                });
            }

            // Pause autoplay on hover/touch
            carousel.addEventListener('mouseenter', stopAutoplay);
            carousel.addEventListener('mouseleave', startAutoplay);
            carousel.addEventListener('touchstart', stopAutoplay, { passive: true });
            carousel.addEventListener('touchend', () => {
                // Delay restart to allow scroll to complete
                setTimeout(startAutoplay, 1000);
            }, { passive: true });

            // Handle scroll events for dot sync
            let scrollTimeout;
            carousel.addEventListener('scroll', () => {
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => {
                    const scrollLeft = carousel.scrollLeft;
                    const cardWidth = carousel.querySelector('.event-card')?.offsetWidth || 0;
                    const gap = parseFloat(getComputedStyle(carousel).gap) || 0;
                    const visibleCards = getVisibleCardsCount();
                    const pageWidth = (cardWidth + gap) * visibleCards;
                    const newPage = Math.round(scrollLeft / pageWidth);

                    if (newPage !== carouselCurrentIndex) {
                        carouselCurrentIndex = newPage;
                        updateCarouselDots(newPage);
                        updateNavButtons();
                    }
                }, 100);
            });

            // Handle window resize
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    renderCarouselDots(getTotalPages());
                    scrollToPage(0);
                    updateNavButtons();
                }, 250);
            });

            // Start autoplay
            startAutoplay();

            console.log('✅ Events carousel initialized');
        }

        // ===== Live Statistics Dashboard =====

        // 智慧統計 API URL 配置
        function getStatsApiUrl() {
            if (CONFIG.IS_DEMO_MODE()) {
                return 'DEMO_MODE';
            } else if (!CONFIG.isWordPressConfigValid()) {
                return 'WORDPRESS_CONFIG_NEEDED';
            } else {
                return CONFIG.FORM_SUBMIT_URL.replace('/exec', '/exec?action=getStats');
            }
        }

        const liveStatsConfig = {
            // 智慧統計 API endpoint
            STATS_API_URL: getStatsApiUrl(),
            UPDATE_INTERVAL: 5 * 60 * 1000, // 5 minutes
            // Cache configuration
            CACHE_KEY: 'hourOfAI_stats_cache',
            CACHE_TIMESTAMP_KEY: 'hourOfAI_stats_timestamp',
            CACHE_VERSION_KEY: 'hourOfAI_stats_version',
            CACHE_DURATION: 6 * 60 * 60 * 1000, // 6 hours
            CACHE_VERSION: 'v1', // Update this to force cache refresh
            // Initial/fallback data
            fallbackData: {
                totalEvents: 15,
                totalParticipants: 1850,
                counties: {
                    '台北市': 5,
                    '新北市': 3,
                    '台中市': 2,
                    '高雄市': 2,
                    '桃園市': 1,
                    '台南市': 1,
                    '新竹市': 1
                },
                recentActivities: [
                    { county: '台北市', type: '學校', time: '5 分鐘前', participants: 120 },
                    { county: '新北市', type: '學校', time: '15 分鐘前', participants: 80 },
                    { county: '台中市', type: '企業', time: '30 分鐘前', participants: 50 }
                ]
            }
        };

        // ===== Mock Data Generator for Demo Mode =====

        function generateMockStats() {
            const baseTime = Date.now();
            const counties = [
                '台北市', '新北市', '台中市', '台南市', '高雄市', '桃園市',
                '新竹縣', '新竹市', '苗栗縣', '彰化縣', '南投縣', '雲林縣',
                '嘉義縣', '嘉義市', '屏東縣', '宜蘭縣', '花蓮縣', '台東縣'
            ];

            const institutionTypes = ['學校', '企業', '政府機關', '非營利組織', '其他'];
            const activities = ['AI 程式體驗', 'AI 藝術創作', '機器學習入門', 'AI 倫理討論', 'AI 工具應用'];

            // 生成動態統計 (每次稍有變化)
            const mockCounties = {};
            const totalCounties = Math.floor(Math.random() * 6) + 12; // 12-18 個縣市

            for (let i = 0; i < totalCounties; i++) {
                const county = counties[Math.floor(Math.random() * counties.length)];
                if (!mockCounties[county]) {
                    mockCounties[county] = Math.floor(Math.random() * 8) + 1; // 1-8 場活動
                }
            }

            // 生成最近活動
            const recentActivities = [];
            for (let i = 0; i < 5; i++) {
                const county = counties[Math.floor(Math.random() * counties.length)];
                const type = institutionTypes[Math.floor(Math.random() * institutionTypes.length)];
                const participants = Math.floor(Math.random() * 150) + 20; // 20-170 人
                const timeAgo = ['剛剛', '5 分鐘前', '15 分鐘前', '30 分鐘前', '1 小時前'][i];

                recentActivities.push({ county, type, participants, time: timeAgo });
            }

            // 計算總計
            const totalEvents = Object.values(mockCounties).reduce((sum, count) => sum + count, 0);
            const totalParticipants = totalEvents * (Math.floor(Math.random() * 50) + 50); // 平均 50-100 人/活動

            return {
                status: 'success',
                totalEvents: totalEvents + Math.floor(Math.random() * 5), // 加一點隨機性
                totalParticipants: totalParticipants + Math.floor(Math.random() * 200),
                counties: mockCounties,
                institutionTypes: {
                    '學校': Math.floor(totalEvents * 0.6),
                    '企業': Math.floor(totalEvents * 0.2),
                    '政府機關': Math.floor(totalEvents * 0.1),
                    '非營利組織': Math.floor(totalEvents * 0.07),
                    '其他': Math.floor(totalEvents * 0.03)
                },
                recentActivities
            };
        }

        // ===== Cache Management Utilities =====

        /**
         * Save statistics data to localStorage cache
         */
        function saveToCache(data) {
            try {
                localStorage.setItem(liveStatsConfig.CACHE_KEY, JSON.stringify(data));
                localStorage.setItem(liveStatsConfig.CACHE_TIMESTAMP_KEY, Date.now().toString());
                localStorage.setItem(liveStatsConfig.CACHE_VERSION_KEY, liveStatsConfig.CACHE_VERSION);
                console.log('✅ 統計資料已儲存至快取');
            } catch (e) {
                console.warn('⚠️ localStorage 寫入失敗:', e);
                // If quota exceeded, try to clear old cache
                if (e.name === 'QuotaExceededError') {
                    clearCache();
                    try {
                        localStorage.setItem(liveStatsConfig.CACHE_KEY, JSON.stringify(data));
                        localStorage.setItem(liveStatsConfig.CACHE_TIMESTAMP_KEY, Date.now().toString());
                        localStorage.setItem(liveStatsConfig.CACHE_VERSION_KEY, liveStatsConfig.CACHE_VERSION);
                    } catch (e2) {
                        console.error('❌ 清除快取後仍無法寫入');
                    }
                }
            }
        }

        /**
         * Load statistics data from localStorage cache
         */
        function loadFromCache() {
            try {
                const cachedData = localStorage.getItem(liveStatsConfig.CACHE_KEY);
                if (cachedData) {
                    return JSON.parse(cachedData);
                }
            } catch (e) {
                console.warn('⚠️ localStorage 讀取失敗:', e);
                clearCache();
            }
            return null;
        }

        /**
         * Check if cache is still valid
         */
        function isCacheValid() {
            try {
                // Check version first
                const cachedVersion = localStorage.getItem(liveStatsConfig.CACHE_VERSION_KEY);
                if (cachedVersion !== liveStatsConfig.CACHE_VERSION) {
                    console.log('🔄 快取版本不符，需要更新');
                    return false;
                }

                const timestamp = localStorage.getItem(liveStatsConfig.CACHE_TIMESTAMP_KEY);
                if (!timestamp) {
                    return false;
                }

                const cacheAge = Date.now() - parseInt(timestamp);
                const isValid = cacheAge < liveStatsConfig.CACHE_DURATION;

                if (!isValid) {
                    console.log('⏰ 快取已過期');
                }

                return isValid;
            } catch (e) {
                console.warn('⚠️ 快取驗證失敗:', e);
                return false;
            }
        }

        /**
         * Clear cache
         */
        function clearCache() {
            try {
                localStorage.removeItem(liveStatsConfig.CACHE_KEY);
                localStorage.removeItem(liveStatsConfig.CACHE_TIMESTAMP_KEY);
                localStorage.removeItem(liveStatsConfig.CACHE_VERSION_KEY);
                console.log('🗑️ 快取已清除');
            } catch (e) {
                console.warn('⚠️ 清除快取失敗:', e);
            }
        }

        /**
         * Get cache age in milliseconds
         */
        function getCacheAge() {
            try {
                const timestamp = localStorage.getItem(liveStatsConfig.CACHE_TIMESTAMP_KEY);
                if (!timestamp) {
                    return null;
                }
                return Date.now() - parseInt(timestamp);
            } catch (e) {
                return null;
            }
        }

        /**
         * Format cache age for display
         */
        function formatCacheAge(ageMs) {
            if (!ageMs) {
                return '剛剛更新';
            }

            const minutes = Math.floor(ageMs / 60000);
            const hours = Math.floor(minutes / 60);

            if (minutes < 1) return '剛剛更新';
            if (minutes < 60) return `${minutes} 分鐘前更新`;
            if (hours < 24) return `${hours} 小時前更新`;

            const days = Math.floor(hours / 24);
            return `${days} 天前更新`;
        }

        /**
         * Update cache indicator in UI
         */
        function updateCacheIndicator(ageMs) {
            const indicator = document.getElementById('statsCacheIndicator');
            if (indicator) {
                indicator.textContent = formatCacheAge(ageMs);
            }
        }

        // ===== Global Rank Configuration =====

        /**
         * Global Rank Configuration
         */
        const globalRankConfig = {
            CSV_URL: 'https://docs.google.com/spreadsheets/d/1QDTmNNP3i6Nfhg6y7qp5V_cSL6ciNsMyF3bEjyKXTsY/export?format=csv',
            CACHE_KEY: 'hourOfAI_global_rank_cache',
            CACHE_TIMESTAMP_KEY: 'hourOfAI_global_rank_timestamp',
            CACHE_DURATION: 3600000, // 1 hour
            TARGET_COUNTRY: 'Taiwan',
            CONTEXT_RANGE: 2  // Show 2 countries above and below
        };

        /**
         * Fetch and analyze Taiwan's global rank
         */
        async function fetchTaiwanGlobalRank() {
            try {
                // Check cache first
                const cached = getGlobalRankCache();
                if (cached) {
                    console.log('Using cached global rank data');
                    return cached;
                }

                // Fetch fresh data
                const response = await fetch(globalRankConfig.CSV_URL);
                const csvText = await response.text();
                const data = parseCSV(csvText);
                const analysis = analyzeTaiwanGlobalRank(data);

                // Save to cache
                saveGlobalRankCache(analysis);

                return analysis;
            } catch (error) {
                console.error('Error fetching global rank:', error);
                return null;
            }
        }

        /**
         * Parse CSV data
         */
        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const data = [];

            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;

                const [country, count] = line.split(',');
                if (country && count) {
                    data.push({
                        country: country.trim().replace(/^"|"$/g, ''),
                        count: parseInt(count.trim())
                    });
                }
            }

            return data;
        }

        /**
         * Analyze Taiwan's global rank
         */
        function analyzeTaiwanGlobalRank(data) {
            // Sort by count descending
            const sorted = data
                .filter(item => item.count > 0)
                .sort((a, b) => b.count - a.count);

            // Find Taiwan
            const taiwanIndex = sorted.findIndex(item =>
                item.country === globalRankConfig.TARGET_COUNTRY
            );

            if (taiwanIndex === -1) {
                throw new Error('Taiwan not found in data');
            }

            const taiwan = sorted[taiwanIndex];
            const rank = taiwanIndex + 1;
            const totalCountries = sorted.length;

            // Get nearby countries
            const contextRange = globalRankConfig.CONTEXT_RANGE;
            const nearbyCountries = [
                ...sorted.slice(Math.max(0, taiwanIndex - contextRange), taiwanIndex)
                    .map((country, idx) => ({
                        ...country,
                        rank: taiwanIndex - contextRange + idx + 1,
                        position: 'above'
                    })),
                {
                    ...taiwan,
                    rank: rank,
                    position: 'current'
                },
                ...sorted.slice(taiwanIndex + 1, taiwanIndex + contextRange + 1)
                    .map((country, idx) => ({
                        ...country,
                        rank: rank + idx + 1,
                        position: 'below'
                    }))
            ];

            return {
                globalRank: rank,
                totalCountries: totalCountries,
                percentile: ((totalCountries - rank + 1) / totalCountries * 100).toFixed(1),
                taiwanCount: taiwan.count,
                nearbyCountries: nearbyCountries,
                topCountry: sorted[0],
                lastUpdated: new Date().toISOString()
            };
        }

        /**
         * Cache management for global rank
         */
        function saveGlobalRankCache(data) {
            try {
                localStorage.setItem(globalRankConfig.CACHE_KEY, JSON.stringify(data));
                localStorage.setItem(globalRankConfig.CACHE_TIMESTAMP_KEY, Date.now().toString());
            } catch (e) {
                console.warn('Failed to save global rank cache:', e);
            }
        }

        function getGlobalRankCache() {
            try {
                const timestamp = localStorage.getItem(globalRankConfig.CACHE_TIMESTAMP_KEY);
                if (!timestamp) return null;

                const age = Date.now() - parseInt(timestamp);
                if (age > globalRankConfig.CACHE_DURATION) return null;

                const cached = localStorage.getItem(globalRankConfig.CACHE_KEY);
                return cached ? JSON.parse(cached) : null;
            } catch (e) {
                console.warn('Failed to get global rank cache:', e);
                return null;
            }
        }

        /**
         * Update UI with global rank data
         */
        function updateGlobalRankUI(rankData, localStats) {
            if (!rankData) return;

            // Update global rank card
            animateCounter(
                document.getElementById('globalRankNumber'),
                0,
                rankData.globalRank,
                1000
            );
            document.getElementById('globalRankTotal').textContent = rankData.totalCountries;
            document.getElementById('globalPercentile').textContent = rankData.percentile;

            // Update comparison card
            document.getElementById('localEventCount').textContent =
                formatNumberResponsively(localStats.totalEvents || 0);
            document.getElementById('globalEventCount').textContent =
                formatNumberResponsively(rankData.taiwanCount);

            // Update nearby countries list
            const listContainer = document.getElementById('nearbyCountriesList');
            listContainer.innerHTML = rankData.nearbyCountries.map(country => `
                <div class="country-rank-item ${country.position === 'current' ? 'current-country' : ''}">
                    <span class="rank-col">#${country.rank}</span>
                    <span class="country-col">${country.country}</span>
                    <span class="count-col">${formatNumberResponsively(country.count)} 場活動</span>
                </div>
            `).join('');
        }

        /**
         * Initialize global rank section
         */
        async function initGlobalRankSection() {
            try {
                const localStats = loadFromCache() || liveStatsConfig.fallbackData;
                const rankData = await fetchTaiwanGlobalRank();
                updateGlobalRankUI(rankData, localStats);
            } catch (error) {
                console.error('Error initializing global rank section:', error);
            }
        }

        /**
         * Refresh global rank data
         */
        async function refreshGlobalRank() {
            try {
                const rankData = await fetchTaiwanGlobalRank();
                const localStats = loadFromCache() || liveStatsConfig.fallbackData;
                updateGlobalRankUI(rankData, localStats);
            } catch (error) {
                console.error('Error refreshing global rank:', error);
            }
        }

        // Responsive number formatting
        function formatNumberResponsively(number) {
            const screenWidth = window.innerWidth;

            // Mobile: show full number (up to 6 digits comfortably)
            if (screenWidth <= 768) {
                return number.toLocaleString();
            }

            // Tablet: medium abbreviation
            if (screenWidth <= 1024) {
                if (number >= 1000000) {
                    return (number / 1000000).toFixed(1).replace('.0', '') + 'M';
                }
                if (number >= 1000) {
                    return (number / 1000).toFixed(1).replace('.0', '') + 'K';
                }
                return number.toLocaleString();
            }

            // Desktop: short abbreviation
            if (number >= 1000000) {
                return Math.floor(number / 1000000) + 'M+';
            }
            if (number >= 1000) {
                return Math.floor(number / 1000) + 'K+';
            }
            return number.toString();
        }

        // Enhanced animated counter with responsive formatting
        function animateCounter(element, start, end, duration) {
            if (!element) return;

            const range = end - start;
            const startTime = performance.now();

            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);

                // Ease out cubic
                const easeProgress = 1 - Math.pow(1 - progress, 3);
                const current = Math.floor(start + range * easeProgress);

                // Use responsive formatting
                element.textContent = formatNumberResponsively(current);

                if (progress < 1) {
                    requestAnimationFrame(update);
                }
            }

            requestAnimationFrame(update);
        }

        // Update counters on window resize to refresh number format
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                // Re-format existing counter values
                const totalEventsEl = document.getElementById('totalEvents');
                const totalParticipantsEl = document.getElementById('totalParticipants');
                const totalCountiesEl = document.getElementById('totalCounties');

                if (totalEventsEl && totalEventsEl.dataset.value) {
                    totalEventsEl.textContent = formatNumberResponsively(parseInt(totalEventsEl.dataset.value));
                }
                if (totalParticipantsEl && totalParticipantsEl.dataset.value) {
                    totalParticipantsEl.textContent = formatNumberResponsively(parseInt(totalParticipantsEl.dataset.value));
                }
                if (totalCountiesEl && totalCountiesEl.dataset.value) {
                    totalCountiesEl.textContent = formatNumberResponsively(parseInt(totalCountiesEl.dataset.value));
                }
            }, 250);
        });

        // Update counters
        function updateCounters(data) {
            const totalEvents = data.totalEvents || liveStatsConfig.fallbackData.totalEvents;
            const totalParticipants = data.totalParticipants || liveStatsConfig.fallbackData.totalParticipants;
            const totalCounties = Object.keys(data.counties || liveStatsConfig.fallbackData.counties).length;

            // Store original values for resize handling
            const totalEventsEl = document.getElementById('totalEvents');
            const totalParticipantsEl = document.getElementById('totalParticipants');
            const totalCountiesEl = document.getElementById('totalCounties');

            if (totalEventsEl) totalEventsEl.dataset.value = totalEvents;
            if (totalParticipantsEl) totalParticipantsEl.dataset.value = totalParticipants;
            if (totalCountiesEl) totalCountiesEl.dataset.value = totalCounties;

            animateCounter(totalEventsEl, 0, totalEvents, 2000);
            animateCounter(totalParticipantsEl, 0, totalParticipants, 2500);
            animateCounter(totalCountiesEl, 0, totalCounties, 1500);
        }

        // Initialize Leaflet map
        let taiwanMap = null;
        let geoJsonLayer = null;
        let currentCountyData = {};
        let taiwanGeoJSON = null; // Will be loaded from external source

        async function loadTaiwanGeoJSON() {
            try {
                // Load real Taiwan county boundaries from GitHub (g0v open data)
                const response = await fetch('https://raw.githubusercontent.com/g0v/twgeojson/master/json/twCounty2010.geo.json');

                if (!response.ok) {
                    throw new Error('Failed to load GeoJSON');
                }

                const geoData = await response.json();
                taiwanGeoJSON = geoData;

                // Map county codes/names to Traditional Chinese
                const nameMapping = {
                    'TPE': '台北市',
                    'TPH': '新北市',
                    'TYC': '桃園市',
                    'HSC': '新竹市',
                    'HSH': '新竹縣',
                    'MAL': '苗栗縣',
                    'TXG': '台中市',
                    'CWH': '彰化縣',
                    'NTO': '南投縣',
                    'YLH': '雲林縣',
                    'CHY': '嘉義市',
                    'CYI': '嘉義縣',
                    'TNN': '台南市',
                    'KHH': '高雄市',
                    'ILA': '宜蘭縣',
                    'HWA': '花蓮縣',
                    'TTT': '台東縣',
                    'PEH': '澎湖縣',
                    'KMN': '金門縣',
                    'LNN': '連江縣',
                    'PIF': '屏東縣',
                    'KEE': '基隆市',
                    // Also handle Chinese names
                    '台北市': '台北市',
                    '新北市': '新北市',
                    '桃園市': '桃園市',
                    '桃園縣': '桃園市',
                    '台中市': '台中市',
                    '台中縣': '台中市',
                    '台南市': '台南市',
                    '台南縣': '台南市',
                    '高雄市': '高雄市',
                    '高雄縣': '高雄市',
                    '基隆市': '基隆市',
                    '新竹市': '新竹市',
                    '新竹縣': '新竹縣',
                    '苗栗縣': '苗栗縣',
                    '彰化縣': '彰化縣',
                    '南投縣': '南投縣',
                    '雲林縣': '雲林縣',
                    '嘉義市': '嘉義市',
                    '嘉義縣': '嘉義縣',
                    '屏東縣': '屏東縣',
                    '宜蘭縣': '宜蘭縣',
                    '花蓮縣': '花蓮縣',
                    '台東縣': '台東縣',
                    '澎湖縣': '澎湖縣',
                    '金門縣': '金門縣',
                    '連江縣': '連江縣'
                };

                // Update feature properties with Chinese names
                taiwanGeoJSON.features.forEach(feature => {
                    const props = feature.properties;
                    const countyId = props.COUNTYID || props.COUNTYCODE || props.id;
                    const countyName = props.COUNTYNAME || props.name || props.NAME;

                    // Try to map to Chinese name
                    feature.properties.name = nameMapping[countyId] || nameMapping[countyName] || countyName;
                });

                return taiwanGeoJSON;
            } catch (error) {
                console.error('Error loading Taiwan GeoJSON, using fallback:', error);
                // Return a minimal fallback if CDN fails
                return createFallbackGeoJSON();
            }
        }

        function createFallbackGeoJSON() {
            // Fallback: just show a simple rectangle for Taiwan
            return {
                "type": "FeatureCollection",
                "features": [{
                    "type": "Feature",
                    "properties": {"name": "台灣"},
                    "geometry": {
                        "type": "Polygon",
                        "coordinates": [[[120, 22], [122, 22], [122, 26], [120, 26], [120, 22]]]
                    }
                }]
            };
        }

        async function initTaiwanMap() {
            // Load GeoJSON data
            if (!taiwanGeoJSON) {
                await loadTaiwanGeoJSON();
            }

            // Initialize map centered on Taiwan
            taiwanMap = L.map('taiwanMap', {
                center: [23.8, 121],
                zoom: 7,
                minZoom: 7,
                maxZoom: 10,
                zoomControl: true,
                scrollWheelZoom: false
            });

            // Add base tile layer (OpenStreetMap)
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(taiwanMap);

            // Add GeoJSON layer with real Taiwan boundaries
            geoJsonLayer = L.geoJSON(taiwanGeoJSON, {
                style: function(feature) {
                    return {
                        fillColor: '#E8E8E8',
                        weight: 2,
                        opacity: 1,
                        color: '#999',
                        fillOpacity: 0.6
                    };
                },
                onEachFeature: function(feature, layer) {
                    const countyName = feature.properties.name;

                    // Bind popup
                    layer.bindPopup(`
                        <div class="county-popup">
                            <div class="county-popup-name">${countyName}</div>
                            <div class="county-popup-count" id="popup-${countyName}">0</div>
                            <div class="county-popup-label">場活動</div>
                        </div>
                    `);

                    // Hover effects
                    layer.on({
                        mouseover: function(e) {
                            const layer = e.target;
                            layer.setStyle({
                                weight: 3,
                                color: '#3B7DD6',
                                fillOpacity: 0.8
                            });
                        },
                        mouseout: function(e) {
                            geoJsonLayer.resetStyle(e.target);
                        }
                    });
                }
            }).addTo(taiwanMap);
        }

        // Update Taiwan map with heat map colors
        async function updateTaiwanMap(countyData) {
            const counties = countyData || liveStatsConfig.fallbackData.counties;
            currentCountyData = counties;

            if (!taiwanMap) {
                await initTaiwanMap();
            }

            const maxCount = Math.max(...Object.values(counties), 1);

            // Update layer styling based on data
            if (geoJsonLayer) {
                geoJsonLayer.eachLayer(function(layer) {
                    const countyName = layer.feature.properties.name;
                    const count = counties[countyName] || 0;

                    // Calculate heat level
                    const percentage = count / maxCount;
                    let color = '#E8E8E8'; // Default gray

                    if (count > 0) {
                        if (percentage > 0.8) {
                            color = 'rgba(59, 125, 214, 1)'; // Deep blue
                        } else if (percentage > 0.6) {
                            color = 'rgba(59, 125, 214, 0.8)';
                        } else if (percentage > 0.4) {
                            color = 'rgba(59, 125, 214, 0.6)';
                        } else if (percentage > 0.2) {
                            color = 'rgba(59, 125, 214, 0.4)';
                        } else {
                            color = 'rgba(59, 125, 214, 0.2)';
                        }
                    }

                    // Update layer style
                    layer.setStyle({
                        fillColor: color,
                        weight: 2,
                        opacity: 1,
                        color: '#999',
                        fillOpacity: 0.7
                    });

                    // Update popup content
                    layer.bindPopup(`
                        <div class="county-popup">
                            <div class="county-popup-name">${countyName}</div>
                            <div class="county-popup-count">${count}</div>
                            <div class="county-popup-label">場活動</div>
                        </div>
                    `);
                });
            }
        }

        // Update rankings
        function updateRankings(countyData) {
            const counties = countyData || liveStatsConfig.fallbackData.counties;
            const sorted = Object.entries(counties)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);

            const maxCount = sorted[0]?.[1] || 1;
            const rankingList = document.getElementById('rankingList');

            rankingList.innerHTML = sorted.map(([county, count], index) => {
                const percentage = (count / maxCount * 100).toFixed(0);
                const positionClass = index === 0 ? 'top-1' : index === 1 ? 'top-2' : index === 2 ? 'top-3' : '';

                return `
                    <div class="ranking-item">
                        <div class="ranking-position ${positionClass}">${index + 1}</div>
                        <div class="ranking-info">
                            <div class="ranking-name">${county}</div>
                            <div class="ranking-bar">
                                <div class="ranking-bar-fill" style="width: ${percentage}%"></div>
                            </div>
                        </div>
                        <div class="ranking-count">${count} 場</div>
                    </div>
                `;
            }).join('');
        }

        // Update activity feed
        function updateActivityFeed(activities) {
            const feed = activities || liveStatsConfig.fallbackData.recentActivities;
            const activityFeed = document.getElementById('activityFeed');

            activityFeed.innerHTML = feed.map(activity => {
                const icons = ['school', 'business', 'apartment', 'person', 'work'];
                const randomIcon = icons[Math.floor(Math.random() * icons.length)];

                return `
                    <div class="activity-item">
                        <div class="activity-icon">
                            <span class="material-icons medium" style="color: var(--color-white);">${randomIcon}</span>
                        </div>
                        <div class="activity-content">
                            <div class="activity-text">
                                <strong>${activity.county}</strong> 新增${activity.type}活動規劃，預計 <strong>${activity.participants}</strong> 人參與
                            </div>
                            <div class="activity-time">${activity.time}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Fetch statistics from API with cache support
        async function fetchStatistics(forceRefresh = false) {
            // 1. If not forcing refresh, check cache first
            if (!forceRefresh) {
                const cachedData = loadFromCache();
                if (cachedData && isCacheValid()) {
                    console.log('✅ 使用快取資料');
                    updateCacheIndicator(getCacheAge());
                    return cachedData;
                }
            }

            // 2. Cache invalid or forced refresh - fetch from API
            console.log(forceRefresh ? '🔄 強制重新載入資料...' : '📡 從 API 載入資料...');

            try {
                // 檢查統計 API 模式
                if (liveStatsConfig.STATS_API_URL === 'DEMO_MODE') {
                    console.log('🧪 Demo Mode: 使用模擬統計資料');

                    // 模擬 API 延遲
                    await new Promise(resolve => setTimeout(resolve, 800));

                    // 回傳模擬資料，每次稍有不同
                    const mockData = generateMockStats();
                    console.log('📊 Mock stats generated:', mockData);

                    saveToCache(mockData);
                    updateCacheIndicator(0); // Fresh data
                    return mockData;

                } else if (liveStatsConfig.STATS_API_URL === 'WORDPRESS_CONFIG_NEEDED') {
                    console.log('⚠️ WordPress 環境需要設定 API URL');
                    throw new Error('WordPress 環境需要設定統計 API');
                }

                const response = await fetch(liveStatsConfig.STATS_API_URL, {
                    method: 'GET',
                    mode: 'cors',
                    cache: 'no-cache' // Force fresh data when calling API
                });

                if (response.ok) {
                    const data = await response.json();

                    // Save to cache
                    saveToCache(data);
                    updateCacheIndicator(0); // Just updated

                    return data;
                }
            } catch (error) {
                console.warn('⚠️ API 呼叫失敗:', error);

                // 3. API failed - try to use expired cache as fallback
                const cachedData = loadFromCache();
                if (cachedData) {
                    console.log('📦 API 失敗，使用過期快取資料');
                    updateCacheIndicator(getCacheAge());
                    return cachedData;
                }
            }

            // 4. Everything failed - use hardcoded fallback
            console.log('⚠️ 使用預設資料');
            return liveStatsConfig.fallbackData;
        }

        // Manual refresh function (called by refresh button)
        async function refreshStatistics() {
            const refreshBtn = document.getElementById('statsRefreshBtn');

            // Show loading state
            if (refreshBtn) {
                refreshBtn.classList.add('loading');
                refreshBtn.disabled = true;
            }

            try {
                // Force refresh from API
                const data = await fetchStatistics(true);

                // Update all UI components
                updateCounters(data);
                await updateTaiwanMap(data.counties);
                updateRankings(data.counties);
                updateActivityFeed(data.recentActivities);

                // Update global rank
                await refreshGlobalRank();

                console.log('✅ 統計資料已更新');
            } catch (error) {
                console.error('❌ 更新統計資料失敗:', error);
            } finally {
                // Remove loading state
                if (refreshBtn) {
                    refreshBtn.classList.remove('loading');
                    refreshBtn.disabled = false;
                }
            }
        }

        // Initialize and update statistics
        async function initStatistics() {
            // Initial load (will use cache if valid)
            const data = await fetchStatistics();

            updateCounters(data);
            await updateTaiwanMap(data.counties);
            updateRankings(data.counties);
            updateActivityFeed(data.recentActivities);

            // Initialize global rank section
            await initGlobalRankSection();

            // Check cache periodically and only refresh if expired
            // This is more efficient than unconditional refreshes
            setInterval(async () => {
                // Only fetch if cache is invalid
                if (!isCacheValid()) {
                    console.log('⏰ 快取過期，自動更新統計資料');
                    const newData = await fetchStatistics();
                    updateCounters(newData);
                    await updateTaiwanMap(newData.counties);
                    updateRankings(newData.counties);
                    updateActivityFeed(newData.recentActivities);
                    await refreshGlobalRank();
                } else {
                    console.log('✅ 快取仍有效，跳過更新');
                }
            }, liveStatsConfig.UPDATE_INTERVAL);
        }

        // ===== Submit Another Registration =====
        const submitAnotherBtn = document.getElementById('submitAnotherBtn');
        if (submitAnotherBtn) {
            submitAnotherBtn.addEventListener('click', () => {
                // Reset form
                form.reset();

                // Clear all error states
                document.querySelectorAll('.form-group.error').forEach(group => {
                    group.classList.remove('error');
                });

                // Go back to page 1
                currentPage = 1;
                showPage(currentPage);
                updateProgress();

                // Show form actions again
                formActions.classList.remove('hidden');

                // Re-enable submit button
                submitBtn.disabled = false;
                submitBtn.innerHTML = '提交活動規劃 <span class="material-icons small">send</span>';

                // Scroll to progress steps
                document.querySelector('.form-progress').scrollIntoView({
                    behavior: 'smooth',
                    block: 'center'
                });
            });
        }

        // ===== Smooth Scrolling for Anchor Links =====
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // ===== Demo Mode Indicators Control =====
        function setupDemoModeIndicators() {
            // Check if we're in demo mode
            if (CONFIG.IS_DEMO_MODE()) {
                console.log('🧪 Demo Mode: 顯示 Demo 標示元素');

                // Show demo badge in title
                const demoIndicator = document.getElementById('demoIndicator');
                if (demoIndicator) {
                    demoIndicator.style.display = 'inline-flex';
                }

                // Show demo notice
                const demoNotice = document.getElementById('demoNotice');
                if (demoNotice) {
                    demoNotice.style.display = 'block';
                }

                // Add demo mode class to stats dashboard
                const statsDashboard = document.getElementById('statsDashboard');
                if (statsDashboard) {
                    statsDashboard.classList.add('demo-mode');
                }
            } else {
                console.log('🌐 Production Mode: 隱藏 Demo 標示元素');
                // Ensure demo indicators are hidden in production
                const demoElements = ['demoIndicator', 'demoNotice'];
                demoElements.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.style.display = 'none';
                    }
                });

                // Remove demo mode class
                const statsDashboard = document.getElementById('statsDashboard');
                if (statsDashboard) {
                    statsDashboard.classList.remove('demo-mode');
                }
            }
        }

        // ===== AI Pillars Modal =====
        function togglePillarDetail(pillarId) {
            const detailPanel = document.getElementById(`pillar-detail-${pillarId}`);
            const pillarCard = document.querySelector(`.pillar-card[data-pillar="${pillarId}"]`);
            const allCards = document.querySelectorAll('.pillar-card');

            // Reset all cards
            allCards.forEach(card => card.classList.remove('active'));

            // Mark the clicked card as active
            if (pillarCard) pillarCard.classList.add('active');

            // Open modal with content
            openPillarModal(pillarId, detailPanel);
        }

        // Store scroll position for iOS scroll lock
        let scrollPosition = 0;

        function openPillarModal(pillarId, detailPanel) {
            const modal = document.getElementById('pillarModal');
            const modalContent = document.getElementById('pillarModalContent');

            // Clone the content from the detail panel
            modalContent.innerHTML = detailPanel.innerHTML;
            modalContent.setAttribute('data-pillar', pillarId);

            // Lock body scroll (iOS compatible)
            scrollPosition = window.pageYOffset;
            document.body.classList.add('modal-open');
            document.body.style.top = `-${scrollPosition}px`;

            // Show modal
            modal.classList.add('active');

            // Focus trap for accessibility
            const closeBtn = modal.querySelector('.pillar-modal-close');
            if (closeBtn) closeBtn.focus();
        }

        function closePillarModal() {
            const modal = document.getElementById('pillarModal');
            const allCards = document.querySelectorAll('.pillar-card');

            modal.classList.remove('active');

            // Unlock body scroll and restore position instantly (no animation)
            document.body.classList.remove('modal-open');
            document.body.style.top = '';
            window.scrollTo({ top: scrollPosition, left: 0, behavior: 'instant' });

            // Reset card active states
            allCards.forEach(card => card.classList.remove('active'));
        }

        // Setup modal event listeners on DOMContentLoaded
        function setupPillarModal() {
            const modal = document.getElementById('pillarModal');
            const closeBtn = modal.querySelector('.pillar-modal-close');
            const modalContent = document.getElementById('pillarModalContent');

            // Close on close button click
            closeBtn.addEventListener('click', closePillarModal);

            // Close on overlay click (outside modal)
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closePillarModal();
                }
            });

            // Close on Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && modal.classList.contains('active')) {
                    closePillarModal();
                }
            });

            // Prevent touchmove on overlay (iOS scroll fix)
            modal.addEventListener('touchmove', (e) => {
                // Only allow scrolling inside modal content
                if (!modalContent.contains(e.target)) {
                    e.preventDefault();
                }
            }, { passive: false });

            // Tab switching (event delegation for dynamically injected content)
            modalContent.addEventListener('click', (e) => {
                const tabBtn = e.target.closest('.pillar-tab-btn');
                if (!tabBtn) return;

                const tabsContainer = tabBtn.closest('.pillar-tabs');
                const tabName = tabBtn.dataset.tab;

                // Update active tab button
                tabsContainer.querySelectorAll('.pillar-tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                tabBtn.classList.add('active');

                // Update active tab panel
                tabsContainer.querySelectorAll('.pillar-tab-panel').forEach(panel => {
                    panel.classList.remove('active');
                });
                tabsContainer.querySelector(`.pillar-tab-panel[data-tab="${tabName}"]`).classList.add('active');
            });
        }

        // ===== Initialize =====
        document.addEventListener('DOMContentLoaded', () => {
            updateProgress();

            // Setup demo mode indicators based on environment
            setupDemoModeIndicators();

            // Initialize upcoming events carousel
            initEventsCarousel();

            // Initialize live statistics dashboard
            initStatistics();

            // Setup pillar modal event listeners
            setupPillarModal();

            // Trigger fade-in for elements already in viewport
            document.querySelectorAll('.fade-in').forEach(el => {
                const rect = el.getBoundingClientRect();
                if (rect.top < window.innerHeight) {
                    el.classList.add('visible');
                }
            });
        });

        // ===== Google Apps Script Setup Instructions =====
        /*
        To enable form submission to Google Sheets:

        1. Create a new Google Spreadsheet
        2. Go to Extensions > Apps Script
        3. Replace the Code.gs content with:

        ```javascript
        function doPost(e) {
          try {
            const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
            const data = JSON.parse(e.postData.contents);

            // Headers (create these in row 1 of your sheet first)
            const headers = [
              'timestamp', 'email', 'contactName', 'jobTitle', 'phone',
              'county', 'address', 'postalCode', 'participants',
              'institutionType', 'schoolName', 'gradeLevel', 'activityType',
              'deviceUsage', 'activityDescription', 'deliveryFormat',
              'onlineRegistrationLink', 'startDate', 'endDate',
              'promotionalImage', 'additionalComments', 'codeOrgContact', 'dataConsent'
            ];

            // If sheet is empty, add headers
            if (sheet.getLastRow() === 0) {
              sheet.appendRow(headers);
            }

            // Prepare row data
            const rowData = headers.map(header => data[header] || '');

            // Append data
            sheet.appendRow(rowData);

            return ContentService.createTextOutput(JSON.stringify({
              'status': 'success'
            })).setMimeType(ContentService.MimeType.JSON);

          } catch (error) {
            return ContentService.createTextOutput(JSON.stringify({
              'status': 'error',
              'message': error.toString()
            })).setMimeType(ContentService.MimeType.JSON);
          }
        }
        ```

        4. Click "Deploy" > "New deployment"
        5. Choose "Web app"
        6. Set "Execute as" to "Me"
        7. Set "Who has access" to "Anyone"
        8. Click "Deploy" and copy the Web App URL
        9. Paste the URL in the CONFIG.FORM_SUBMIT_URL above
        10. Test the form!
        */
    </script>

    <!-- Pillar Detail Modal -->
    <div class="pillar-modal-overlay" id="pillarModal">
        <div class="pillar-modal" role="dialog" aria-modal="true">
            <div class="pillar-modal-header">
                <button class="pillar-modal-close" aria-label="關閉">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="pillar-modal-content" id="pillarModalContent">
                <!-- Content will be injected here -->
            </div>
        </div>
    </div>
</body>
</html>